      SUBROUTINE ARFSYS
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
      IMPLICIT REAL*8(A-H,O-Z)
       COMMON /ATMATY/XMAT4(16),XMAT3(16),XMAT2(16),XMAT1(16),TMATX(16)
       DIMENSION DEFANS(82)
       DIMENSION IDFSTO(164),IPTPP(14400),IRFSYS(2)
       DIMENSION PTPP(7200),CANON(7200)
       COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1 LOOP,IFINI
      COMMON/AVST/VST(7200)
      EQUIVALENCE(VST(1),PTPP(1),CANON(1))
      COMMON/ADFSTO/DEFSTO(85),PARTNO(11)
      EQUIVALENCE(DEFSTO(4),DEFANS(1))
       EQUIVALENCE (DEFSTO(1),IDFSTO(1)),(PTPP(1),IPTPP(1))
      COMMON/ADEBUG/IDEBUG(3),KCANDF
       EQUIVALENCE (REFSYS,IRFSYS(1))
       DATA A /8HAREFSYS /
C
C**** THIS ROUTINE PROCESSES PTPP CLASS 4 DATA(REFSYS/SMAT 0R
C     REFSYS/NOMORE)
C     THE INPUT IS THE PTPP AND ITS INDEX, INDXPT, THE VARIABLE KRFSYS,
C     AND THE CANON TABLES.
C
C     GET VST INDEX OF MATRIX
       KINDXP = 2*INDXPT - 1
       L1 = IPTPP(KINDXP+3)
C     IS THIS REFSYS/NOMORE
            IF(IPTPP(KINDXP).NE.0) GO TO 5
C     YES
      REFSYS = 0.
      GOTO 50
C
C     GET THE MATRIX
    5  CALL AGTARG(TMATX,16,N)
C...     TEST FOR SURFACE
            IF(N.EQ.2) GO TO 6
C...     NO - SEE IF AN ERROR HAS ALREADY BEEN DIAGNOSED
            IF(N-7)  8, 70, 8
C     THE SYMBOL IS DEFINED, GET TYPE.
C     IS THE SYMBOL A MATRIX
    6       IF(IDFSTO(1).EQ.12) GO TO 10
C
C     THE SYMBOL IS NOT A MATRIX
    8  JSUBER = 651
      GO TO 50
C
C  10 THE SYMBOL IS A MATRIX. INVERT THE MATRIX. SET KRFSYS.
   10  IRFSYS(1) = L1
       IRFSYS(2) = NAMSUB
      CALL AINVRT
       DO 20  I = 1,16
   20 XMAT4(I)=XMAT2(I)
   30 GO TO 50
C
C  50 IS DEBUG FLAG ON
   50 IF(KDBUG)60,70,60
C     DEBUG FLAG IS ON.
   60  IDEBUG(1) = 1
C     PRINT MATRIX AREAS
       CALL ADPRNT(A)
C
   70 RETURN
      END

