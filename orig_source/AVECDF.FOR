      SUBROUTINE AVECDF(N)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
C               *          *          *          *          *
      IMPLICIT REAL*8(A-H,O-Z)
       DIMENSION DEFANS(82)
       COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1 LOOP,IFINI
      COMMON/AVST/VST(7200)
      DIMENSION DEFTAB(1000)
       DIMENSION IDFTAB(2000)
      EQUIVALENCE(VST(7200),DEFTAB(1000))
       EQUIVALENCE (DEFTAB(1),IDFTAB(1))
      COMMON/ADFSTO/DEFSTO(85),PARTNO(11)
      EQUIVALENCE(DEFSTO(4),DEFANS(1))
C***********************************************************************
      COS(Q) = DCOS(Q)
      SIN(Q) = DSIN(Q)
       GO TO (100,200,320,405,510,610,710,800,900,1020,1030),N
C...
C...  DEFPRE ROUTINE FOR FOLLOWING FORMAT
C...     VECTOR/DX,DY,DZ
C...
  100  CALL APOINT(1)
       GO TO 2000
C
C...     VECTOR/X1,Y1,Z1,X2,Y2,Z2
C
  200 DO 210 J=1,3
      DEFANS(J)=DEFTAB(J+4)-DEFTAB(J+1)
  210 CONTINUE
       GO TO 2000
C
C...     VECTOR/PT1,PT2
C
  320 DO 330 J=1,3
      DEFANS(J)=DEFTAB(J+6)-DEFTAB(J+2)
  330 CONTINUE
       GO TO 2000
C
C...     VECTOR/PERPTO,PLN1,POS- OR NEGX, Y, OR Z
C
  405 DEFANS(1)=DEFTAB(4)
      DEFANS(2)=DEFTAB(5)
      DEFANS(3)=DEFTAB(6)
C
C...  CHECK FOR NEGX MODIFIER
C
            IF(IDFTAB(16)-11)  993, 430, 410
C
C...  CHECK FOR NEGY MODIFIER
C
C...  CHECK FOR NEGZ MODIFIER
C
  410       IF(IDFTAB(16)-13)  435, 440, 420
C
C...  CHECK FOR POSX MODIFIER
C
  420       IF(IDFTAB(16)-20)  993, 445, 425
C
C...  CHECK FOR POSY MODIFIER
C
C...  CHECK FOR POSZ MODIFIER
C
  425       IF(IDFTAB(16)-22)  450, 455, 993
  430 IF(DEFTAB(4)) 470,495,460
  435 IF(DEFTAB(5)) 470,495,460
  440 IF(DEFTAB(6)) 470,495,460
  445 IF(DEFTAB(4)) 460,495,470
  450 IF(DEFTAB(5)) 460,495,470
  455 IF(DEFTAB(6)) 460,495,470
  460 DEFANS(1)=-DEFANS(1)
      DEFANS(2)=-DEFANS(2)
      DEFANS(3)=-DEFANS(3)
      GO TO 470
C
  495  JSUBER = 1005
  470  GO TO 2000
C
C...     VECTOR/S,TIMES,VEC1 OR PT1
C
  510 DO 520 K=1,3
      DEFANS(K)=DEFTAB(K+4)*DEFTAB(2)
  520 CONTINUE
       GO TO 2000
C
C...     VECTOR/VEC1 OR PT1,CROSS OR PLUS OR MINUS,VEC2 OR PT2
C
  610       IF(IDFTAB(12)-3)  993, 675, 620
  620       IF(IDFTAB(12)-10)  993, 640, 630
  630       IF(IDFTAB(12)-19)  993, 650, 993
  640 D=-1.0
      GO TO 660
  650 D=1.0
  660 DO 670 K=1,3
      DEFANS(K)=DEFTAB(K+2)+(DEFTAB(K+7)*D)
  670 CONTINUE
      GO TO 680
  675 CALL ACROSS(DEFTAB(3),DEFTAB(8),DEFANS)
  680  GO TO 2000
C
C...     VECTOR/UNIT,VEC1 OR PT1
C
  710 CALL ANORM(DEFTAB(4),DEFANS)
       GO TO 2000
C
C...     VECTOR/UNIT,DX,DY,DZ
C
  800 CALL ANORM(DEFTAB(3),DEFANS)
       GO TO 2000
C
C...     VECTOR/LENGTH,A,ATANGL,B,XY-, YZ-, OR ZXPLAN
C
  900 CON1=DEFTAB(5)/57.29577951289617
      CON2=DEFTAB(3)*COS(CON1)
      CON3=DEFTAB(3)*SIN(CON1)
            IF(IDFTAB(12)-33)  993, 930, 910
  910       IF(IDFTAB(12)-37)  993, 940, 920
  920       IF(IDFTAB(12)-41)  993, 950, 993
C
C...  SET-UP VECTOR TO XYPLANE
C
  930 DEFANS(1)= CON2
      DEFANS(2)= CON3
C...  DEFANS(3)= 0.0
      GO TO 960
C
C...  SET-UP VECTOR TO YZPLANE
C
C...  DEFANS(1)= 0.0
  940 DEFANS(2)= CON2
      DEFANS(3)= CON3
      GO TO 960
C
C...  SET-UP VECTOR TO ZXPLANE
C
  950 DEFANS(1)= CON3
C...  DEFANS(2)= 0.0
      DEFANS(3)= CON2
      GO TO 960
C
  993  JSUBER = 1003
  960  GO TO 2000
C
C...     VECTOR/PARLEL,INTOF,PLN1,PLN2,POS- OR NEGX, Y, OR Z
C
C...     SET UP DEFTAB TO LOOK AS IF PERPTO A PLANE, SO TREAT IT
C
 1020 DEFTAB(3)=DEFTAB(4)
      CALL ACROSS(DEFTAB(5),DEFTAB(10),DEFTAB(18))
      CALL ANORM(DEFTAB(18),DEFTAB(4))
      DEFTAB(8)=DEFTAB(14)
      GO TO 405
C
C...     VECTOR/ATANGL,A,LN1,(POS- OR NEGX OR Y, OR X- OR
C...            YLARGE OR SMALL)
C
C...     CONVERT ANGLE FROM DEGREES TO RADIANS
 1030  A = DEFTAB(3)*.0174532925
C...     COMPUTE VECTOR FROM ANGLE
       SINA = SIN(A)
       COSA = COS(A)
       DEFANS(1) = DEFTAB(5)*SINA + DEFTAB(6)*COSA
       DEFANS(2) = DEFTAB(6)*SINA - DEFTAB(5)*COSA
C...     DETERMINE MODIFIER (POSX OR XLARGE, NEGX OR XSMALL,
C...     POSY OR YLARGE, NEGY OR YSMALL)
       M = IDFTAB(18)
       S = 1.0
            IF(M.EQ.20) GO TO 1040
            IF(M.EQ.31) GO TO 1040
            IF(M.EQ.21) GO TO 1050
            IF(M.EQ.35) GO TO 1050
       S = -1.0
            IF(M.EQ.11) GO TO 1040
            IF(M.EQ.32) GO TO 1040
            IF(M.EQ.12) GO TO 1050
            IF(M-36)  993,1050,993
C
 1040  Q = DEFANS(1)
       GO TO 1055
 1050  Q = DEFANS(2)
C
 1055       IF(Q*S)  1060,1060,1065
C...     MUST INVERT THE VECTOR
 1060  DEFANS(1) = -DEFANS(1)
       DEFANS(2) = -DEFANS(2)
 1065  DEFANS(3) = 0.0
       CALL AZVECT(DEFANS(1))
 2000  RETURN
       END

