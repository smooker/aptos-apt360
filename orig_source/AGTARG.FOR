      SUBROUTINE AGTARG(A,M,N)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
      IMPLICIT REAL*8(A-H,O-Z)
      INTEGER PUNTAP
      INTEGER*2 KNCLUS,KARGPN,KARG(2),ITYP,JK
       INTEGER IERCOD(2)/0,9/
      COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1LOOP,IFINI
      COMMON/A1PAS2/I,J,K,L,MOVLGE,KANMAX,ICANST,IOVREC,KANPTR,MDFTAB,
     1KANCNT,KAUX,KDFCNT,IDEFP,KPRCNT,MDFPRE,IPREP,KOVFLP,KSRFCT,KOVCNT,
     2LSCAN,IOVFLO,MAXCAN,IREF,ICANSC,NAMSTA,KANGO,LASPTP,ISUB,
     3LCOMP,LGEREC,IRECN,JREC,JNUM,KANCUR,KANCOT,KDFENT,KANPAR,LGELOC,
     4IDTMOV,ISPPRG,INDEXS,KPTP,KPTPCT,KLASTP,KLASCT,KPRNT
      COMMON/A1STAB/STABLE(23)
      COMMON/A2CLS7/PPSEQ1,PPSEQ2,ENAME,EINAME,IEREC,ISN
      COMMON/ADFSTO/DEFSTO(85),PARTNO(11)
      COMMON/ASCALR/SCALR(180),ISCWS,NSURF,LOCTEM,IARGTP
      COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,
     1TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
      COMMON/AVST/VST(7200)
C..
      DIMENSION PTPP(7200),IPTPP(14400),IA(2),ISTO(170)
      DIMENSION IVST(1440),A(85),IFANS(164),DEFANS(82),DEFTAB(1000)
C..
      EQUIVALENCE (DEFSTO(1),ISTO(1)),(DEFSTO(4),DEFANS(1),IFANS(1))
      EQUIVALENCE (VST(1),IVST(1),PTPP(1),IPTPP(1))
      EQUIVALENCE (VST(7200),DEFTAB(1000))
      EQUIVALENCE (IARGTP,KNCLUS,KARG(1)),(KARGPN,KARG(2))
       EQUIVALENCE (ERRCOD,IERCOD(1))
      EQUIVALENCE (AA,IA(1))
C..
C... THIS SUBROUTINE CREATED FOR VERSION 4 MODIFICATION LEVEL 0
C..
C..      ***        ***         ***     ***SJD**     ****      ***
C..
C..   A  IS AN 8-BYTE WORD WHERE DESIRED  ENTRY IS STORED
C..   M  IS THE NUMBER OF 8-BYTE WORDS MAKING UP THE RETURN ENTRY
C..   N  IS THE RETURN FLAG INDICATING THE TYPE OF ENTRY IN  'A'
C.    1    A SCALAR PLACED IN A
C..   2   SURFACE PLACED IN AN ARRAY  (DEFSTO/DEFANS)
C..   3   PUNCTUATION FOUND
C.    4   CANONICAL FORM EXCEEDS M. M NUMBER OF PARMS PLACED IN OUTPUT
C..   5   VOCABULARY WORD   (PROTAP CODES PLACED IN  A)
C..   6   STATEMENT I.D.
C.    7   ERROR
C...
C..   INITIALIZE ENTRY VAR. CODES
C.... I  IS THE PTPP CODE 1--8 ( FL.PT.NO.,VAR.SYMB.,SURF..ETC),,
C..  WHEN I = 9 AN ARGUEMENT LIST HAS BEEN ENCOUNTERED OUT OF CONTEXT.
C..   L   IS THE VST INDEX TO THE VARIABLE SYMBOL BEING PROCESSED
C..   NAMSUB   IS INITIALIZED TO THE SUBSCRIPT TYPE ,,VAL. 0--3
C..   IPT IS THE ENTRY PICK UP INDEX, POINTS TO 4-BYTE ENTRIES
C..
      ENAME = 0.
C..  SET FLAG INDICATING SIGN ASSIGNMENT IS PENDING
      ISIGN = 0
      JK = 0
   50 IPT = 2*INDXPT - 1
      I = IPTPP(IPT)
      NAMSUB = IPTPP(IPT+1)
      L = IPTPP(IPT+3)
      INDXPT = INDXPT + 1
C..
C..   BRANCH ON ENTRY TYPE CODE
C... BR. TO ASSIGN SCALAR A SIGN IF APPLICABLE
      IF (ISIGN.NE.0) GO TO 810
      GOTO (100,200,300,500,550,600,700,800,1210) ,I
C...
C...         ***                ****               ****         ****
C..
C..    FLOATING POINT NUMBER
  100 A(1) = PTPP(INDXPT)
      GO TO 405
C..
C...         ***                ****               ****         ****
C..
C..     NAMED SCALAR
  200 ENAME = VST(L)
C...   CALL AGTSUB TO PLACE VALUE OF SUBSCRIPT INTO VST
  210 CALL AGTSUB
      IF (JSUBER.NE.0) GO TO 980
C..
C.. AVS2CK  USES 'NAME' AS THE VST INDEX
C..  L  IS INDEX TO  SCALAR WORKING STORAGE WHERE SCALAR VALUE IS FOUND
      NAME = L
      CALL AVS2CK(IRET)
C..  SET UP A POINTER TO 4-BYTE WORDS
      INAME = 2*NAME-1
C..
       GO TO (501,220,230,501,501,501,920,920,985,930,900),IRET
C..
C..
C..     SCALAR VARIABLE IS NOT INERROR, OUTPUT ITS VALUE
  220 L = IVST(INAME + 1)
      A(1) = PTPP(L)
C..   AGTSUB INCREMENTS THE PICK UP INDEX ONE TOO MANY PLACES, OFFSET IT
      INDXPT = INDXPT - 1
      GO TO 400
C..
C...         ***                ****               ****         ****
C..
C..  VARIABLE IS DEFINED AS A STATEMENT I.D.
C..      RESET PICK UP INDEX TO SAVE DESIRED PICK UP LOCATION
  230 INDXPT = INDXPT - 2
      GO TO 700
C..
C..
C...         ***                ****               ****         ****
C..
C..   AN EXPRESSION IS FOUND  GET THE VALUE OF IT
  300 A(1) = SCALR(L)
      GO TO 400
C...
C...         ***                ****               ****         ****
C..
C.. ASSIGN SCALAR ITS SIGN AS FOLLOWS....
C..   NEG. SCALAR PRECEEDED BY A MINUS, CHANGE VALUE TO POSITIVE
C     POS. SCALAR PRECEEDED BY A MINUS, CHANGE VALUE TO NEGATIVE
C     A NEG. OR POS. SCALAR PRECEEDED BY A PLUS SIGN IS NOT CHANGED
C..
C.. SCALAR FOUND  IS A SIGN PENDING
  400 AA = A(1)
            IF(AA.EQ.ERRCOD) GO TO 985
  405 N = 1
      IF(ISIGN.EQ.2) GO TO 420
C..
  410 INDXPT = INDXPT + 1
      GO TO 990
C..
C..  CHANGE SIGN
  420 A(1) = -A(1)
      GO TO 410
C..
C..
C..***      ***              ***              ***                  ***
C..
C..   GET A    NAMED  SURFACE     VIA SUBROUTINE  ACANGT
C..
C..
  500  IF (M.EQ.1) GO TO 910
      ENAME = VST(L)
C... GET SUBSCRIPT VALUE INTO VST, INCREMENT INDXPT TO NEXT PARAMETER
      CALL AGTSUB
      IF(JSUBER .NE. 0) GO TO 980
C... AVS2CHK USES 'NAME' AS THE VST INDEX, L CONTAINS INDEX
C... AVS2CHK IS CALLED VIA ACANGT
      NAME = L
C...    DO NOT PROCESS IF PARAMETER IS IN ERROR - TEST FOR ERROR CODE
      IV = 2*NAME-1
      IF(IVST(IV+2).EQ.9) GO TO 985
      CALL ACANGT
      IF (JSUBER .NE. 0) GOTO 980
C.. FOR A NORMAL SURFACE
C..  THE CANONICAL FORM IN DEFSTO/DEFANS ALREADY VIA --ACANGT --
  501 LENG = ISTO(2)-3
      ITYP=ISTO(1)
            IF(ITYP.LT.50) GO TO 520
C...     SEE IF DEFINITION RETRIEVAL FROM SRFTAP WAS SUPPRESSED
  505       IF(IDTMOV.NE.0) GO TO 520
C...     NO - SEE WHETHER THERE WAS ENOUGH ROOM FOR IT - IF NOT,
C...     IT WAS NOT READ IN
            IF(ISTO(10)-M)  504, 503, 503
C
  520       IF(LENG.GT.M) JK = M
C...     MOVE THE FLOATING POINT PARAMETERS TO THE OUTPUT ARRAY
C...     FOR NORMAL SURFACES ONLY
            IF(JK.NE.0) LENG = M
       DO 525  I = 1,LENG
  525  A(I) = DEFANS(I)
            IF(JK.EQ.0) GO TO 504
C... THERE IS AN OVERFLO  ON EXPECTED CAN. LENGTH
  503 N = 4
      GO TO 990
C..
C..  A SURFACE HAS BEEN OUTPUT VIA THE SPECIFIED ARRAY 'A'
  504 N = 2
      GO TO 990
C..
C..
C..   *       *       *      NESTED UNNAMED SURFACES  *    *     *
C
C..      INCREMENT PICK-UP INDEX TO POINT TO NEXT PTPP ENTRY
  550 INDXPT = INDXPT + 1
            IF(SCALR(L).EQ.ERRCOD) GO TO 985
      IF (SCALR(L) .NE. 0.) GO TO 555
C...  SURFACE NOT DEFINED ON SRFTB
       JSUBER = 152
      GO TO 980
C..
C..
  555 DEFSTO(1) = SCALR(L)
      LENG = ISTO(2)
C.. FOR NORMAL SURFACES THE COMPLETE CANONICAL FORM IN ON SURFTB
C..  FOR  PATERN, TABCYL, RLDSRF  ........
C..     THE HEADER DATA ONLY IS ON THE SURFTB, PLACED INTO DEFSTO(1)--5
C.. THE FLOATING POINT PARAMETERS ARE ON THE SRFTAP FILE, COMMENCING
C..  AT THE LOCATION INDEX GIVEN IN THE LO-ORD 4-BYTES OF DEFSTO(4)
C..   CALL IT LCOMP
C
      L = L+1
      DO 560 I=2,LENG
      DEFSTO(I) = SCALR(L)
  560 L = L+1
C..   BRANCH TO 501 TO PLACE THE NORMAL SURF. PARMS. INTO THE OUPUT AREA
      ITYP = ISTO(1)
      IF(ITYP.LE.17) GOTO 501
C. **    **   TEST FOR NON-STANDARD /360 SURFACE CODES  **      **
            IF(ITYP.GE.50) GO TO 565
C..
C..   MUST BE A USER IMPLEMENTED SURFACE
      JSUBER=1002
      GOTO 980
C..
C
C...     SEE IF DEFINITION RETRIEVAL FROM SRFTAP WAS SUPPRESSED
  565       IF(IDTMOV.NE.0) GO TO 501
C...     NO - PICK UP THE SRFTAP RECORD NUMBER
  570 LCOMP = IFANS(2)
C... IS SURFACE ALREADY IN CORE
      IF(LGEREC.NE.LCOMP) GO TO 580
C.. YES IT IS IN CORE, IS IT IN THE PROPER LOCATION
      IF(IDEFP.EQ.LGELOC) GO TO 504
C...     NO - TEST FOR ENOUGH SPACE FOR SURFACE IN DEFTAB AREA
            IF(IFANS(4).GE.1000-IDEFP) GO TO 503
C...     YES - READ IT IN
 580  CALL ASERCH(SRFTAP,LCOMP,NAMSTA)
      IF(NAMSTA.GE.0) GO TO 585
      CALL ATAPRD(SRFTAP,NAMSTA,LCNT,6,LSR,1,LST,1,LSC,1,ENAME,1,SUB,1,
     1DEFTAB(IDEFP+1),0)
      IF (NAMSTA.GE.0) GO TO 587
C.. SET CORE LOCATION OF LARGE SURF. PARAMETERS ARE IN DEFTAB ARRAY
      LGELOC = IDEFP
       GO TO 504
C..
C..
C..    SRFTAP COULD NOT BE POSITIONED PROPERLY TO BEGIN READING
  585 JSUBER = 179
      GOTO 980
C..
C..   I/O ERROR WHILE READING UNNAMED LARGE SURFACE FROM SRFTAP
  587 JSUBER = 180
      GOTO 980
C..
C..*** ***       ***       ***      ***   END OF SURFACE PROCESSING**
C..
C..
C... VOCABULARY WORD
  600 N = 5
      A(1) = PTPP(INDXPT)
C.. A COMPUTING FUNCTION MAY BE PRECEEDED BY A + OR -
      IF(ISIGN.EQ.0) GO TO 410
      AA = A(1)
      IF(IA(2).NE.8) GO TO 940
      IF(ISIGN.NE.2) GO TO 410
C.. INDICATE TO ACLS12 THAT FUNCTION SIGN IS TO BE CHANGED
      IA(2) = ISIGN
      A(1) = AA
      GO TO 410
C..
C...         ***                ****               ****         ****
C..
C.. STATEMENT I.D.
  700 IF (ISIGN.NE.0) GO TO 960
C..
      N = 6
      A(1) = VST(L)
      GO TO 410
C..
C...         ***                ****               ****         ****
C..
C.. PUNCTUATION FOUND
C...
  800 N = 3
      INDXPT = INDXPT-1
      JSUBER = 0
      ISIGN = NAMSUB
C.. CHECK FOR PUNCTUATION ( NON-ARITHMETIC CODES)
      IF(ISIGN.LT.6) GO TO 805
C.. WE HAVE PUNCTUATION,,COMMA,PERIOD,PARENS ONLY
      A(1) = PTPP(INDXPT)
      GO TO 410
C..
C...    ONLY A PLUS OR MINUS SIGN FOLLOWED BY A SCALR IS ACCEPTABLE
  805 IF(ISIGN.GT.2) GO TO 950
C..
C..  GET THAT SCALAR
      INDXPT = INDXPT + 1
      GO TO 50
C..
C..
C..
C.. EXPECTING A SCALAR VALUE
  810 GOTO (100,200,300,970,970,600,960,950),I
C..
C..
C..   **            **        **       ***              **             *
C..
C..
C..
C..  ILLEGAL V.S. USED IN A COMPUTING EXPRESSION
  900 JSUBER = 61
      GOTO 980
C..
C..
C.. PARAMETER IS NOT A SCALAR VALUE
  910 JSUBER = 83
      GOTO 980
C..
C..
C...     UNDEFINED SYMBOL - TEST FOR OUTPUT OF DIAGNOSTIC HERE
  920       IF(NSURF.EQ.0) GO TO 925
C...     NO - SET RETURN VARIABLE, AND EXIT
       N = 8
       GO TO 990
  925  JSUBER = 101
       GO TO 980
C..
C..
C..  SUBSCRIPT EXCEEDS THE RESERV AREA
  930 JSUBER = 2004
      GO TO 980
C..
C..
C.. ILLEGAL USE OF A VOCABULARY WORD
  940 JSUBER = 76
      GO TO 980
C..
C..
C... DOUBLE PUNCTUATION
  950  JSUBER = 54
       GO TO 980
C..
C..
C..  ILLEGAL USE OF A STATEMENT I.D.
  960  JSUBER = 52
      GOTO 980
C..
C..
C..  ILLEGAL USE OF A SURFACE
  970  JSUBER = 51
      GOTO 980
C..
C..
C..C.. OUTPUT AN ERROR MESSAGE THEN RETURN FOR FURTHER PROCESSING
  980 CALL ADIAGM
  985 N = 7
C...   **      **   EXIT ROUTINE  **   **        **   **
C..         RESET VARIABLES AND FLAGS
  990 JSUBER = 0
      ISIGN = 0
C..
C.. RESET FLAG THAT ALLOWS ACCEPTANCE OF AN INCLUSIVE SUBSCRIPT
C..  IF NOT PROCESSING ONE
       IF(KNCLUS.NE.2) KNCLUS = 0
       NSURF = 0
      IF(KDBUG.NE.0) GO TO 1010
 1000 RETURN
 1010 WRITE(IOUTAP,1011)
 1011 FORMAT (1H ,' * * AGTARG PRINT * * ')
C.. BRANCH ON OUTPUT TYPE CODES
      GO TO (1020,1030,1040,1030,1040,1050,1060),N
C..
C.. SCALAR
 1020 WRITE (IOUTAP,1025) A(1)
 1025 FORMAT (T1,'+',T25,' SCALAR VALUE IS ',F14.8//)
      GO TO 1000
C..
C..  SURFACE
 1030 LENG = ISTO(2)-3
      KT = ISTO(1)
      IF (LENG.NE.2) GO TO 1032
      KT = KT-31
      LENG=IFANS(4)
 1032 TYPSRF = STABLE(KT)
      IF(N .EQ. 4) GO TO 1036
      WRITE (IOUTAP,1035) ENAME,TYPSRF,LENG,(DEFANS(I),I=1,LENG)
 1035 FORMAT (T1,'+',T25,' SURFACE NAME, TYPE AND LENGTH ',A6,3X,A8,I4,/
     1 (5X,5F14.8/))
      GO TO 1000
 1036 WRITE (IOUTAP,1037) M,LENG,ENAME,TYPSRF,(DEFANS(I),I=1,20)
 1037 FORMAT (T1 ,'+',T25,' EXPECTED CANON LENTH IS ',I4,' ACTUAL LENGTH
     1 IS ',I4,' NAME ',A8,3X,A8/(5X,5F14.8/))
      GO TO 1000
C..
C..  PUNCTUATION OR VOCABULARY WORD CODES
 1040 AA = A(1)
      WRITE (IOUTAP,1045) IA(1),IA(2)
 1045 FORMAT (T1,'+',T25,' PUNCT. OR VOC. CODES ',I4,',',I2,//)
      GO TO 1000
C..
C.. STATEMENT I.D.
 1050 WRITE(IOUTAP,1055) A(1)
 1055 FORMAT (T1,'+',T25,' STATEMENT I.D. IS ',A6//)
      GO TO 1000
C..
C.. ERROR--DIAGNOSTIC HAS BEEN OUTPUT
 1060 WRITE (IOUTAP,1065)
 1065 FORMAT (T1,'+',T25,' ERROR DIAGNOSTIC HAS BEEN OUTPUT '//)
      GO TO 1000
C...
C...
C...
C...
C...
C   NESTED PARAMETER LIST FOUND - CAN ONLY BE USED AS A POINT DEF.
C..    IS IT ACCEPTABLE
 1210 IF(KARGPN.NE.0) GOTO 1220
C.    NO ERROR
 1215 JSUBER = 253
      GO TO 980
C
C..   IT IS ACCEPTABLE - COMPUTE 4-BYTE INDEX TO REFERENCE WORD
 1220 IPT = 2*(L+ICANST-1) -1
      INDXPT = INDXPT+1
C..   TEST FOR A SCALAR LIST
      IF(IPTPP(IPT+1).NE.1) GOTO 1215
C..   IT IS - PICK UP INDEX TO ARGUMENT LIST DATA BLOCK
      L = IPTPP(IPT)
C... COMPUTE INDEX TO PICK UP NUMBER OF ARGUMENTS
      IPT = 2*L-1
C
C..  MOVE FIRST THREE SCALARS OF LIS ( THAT IS THE MAX. ACCEPTABLE) TO
C..  THE DEFANS ARRAY
      DEFANS(1) = PTPP(L+1)
      DEFANS(2) = PTPP(L+2)
      DEFANS(3) = PTPP(L+3)
C.. BRANCH ON ARGUMENT COUNT -- IF MORE THAN THREE IS AN ERROR
      IF(IPTPP(IPT+1)-3) 1230,1235, 1215
C
C..   ONLY TWO COORDINATES GIVEN  -- COMPUTE THE Z-COORDINATE
 1230 CALL AZVALU
C
C..   PUT TYPE AND LENGTH CODES FOR POINT INTO DEFSTO(1)
 1235 ISTO(1) = 1
      ISTO(2) = 6
      GO TO 501
      END

