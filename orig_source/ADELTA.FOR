      SUBROUTINE ADELTA
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*4 AB
C... A2CMMN START
      COMMON/A2CMMN/ SP(3) ,SN(3)     ,TP(3)     ,TN(3)     ,SNK(3)    ,
     1SNL(3)    ,SPK(3)    ,SPL(3)    ,TNK(3)    ,TNL(3)    ,TPK(3)    ,
     2TPL(3)    ,PLNV(3)   ,CC(3)     ,U1(3)     ,CUTH(3)   ,SFVCT(3)  ,
     3VNDIR(3)  ,VMD(3)    ,VT(3)     ,TEE(3)    ,SLX(3)    ,DPLAN(3)  ,
     4S(1)      ,RC(1)     ,PLND(1)   ,TH(1)     ,CSD(1)    ,Z(1)      ,
     5EPS1(1)   ,EPS2(1)   ,EPS3(1)   ,EPS4(1)   ,EPS6(1)   ,EPS8(1)   ,
     6TAU(1)    ,TAU1(1)   ,TAU2(1)   ,STCK(1)   ,STCKN(1)  ,STCK1(1)  ,
     7STCK2(1)  ,COS1(1)   ,DPMX1(1)  ,CPLFL(1)  ,CPTST(1)  ,PLNCS(1)  ,
     8PLND1(1)  ,PLTST(1)  ,PAST(1)   ,SPAST(1)  ,ADCS(1)   ,H(1)      ,
     9CUTR(1), AFILLR(500), KANAS(27), J24(1), IFILLR(212)
      COMMON/A2CMMN/ TE(3),
     5TEK(3)    ,TEL(3)    ,TES(3)    ,TA(3)     ,TAK(3)    ,TAL(3)    ,
     6PMOVE(3)  ,TI(3)     ,TIK(3)    ,TIL(3)    ,U2(3)     ,UVEC(3)   ,
     7VTEM(3)   ,CMOVE(3)  ,EX(3)     ,EY(3)     ,EZ(3)     ,VNUL(3)   ,
     8TM(3)     ,DIR(3)    ,AXIS(3)   ,AXIS1(3)  ,AXIS2(3)  ,AXIS3(3)  ,
     9REFPNT(3) ,RGT(3)    ,FWD(3)    ,UP(3)     ,ZLNORM(3) ,ZLPNT(3)
      COMMON/A2CMMN/TNDIR(3), VA(3)   ,TMVCMP(3) ,P1(3)     ,P2(3)     ,
     1PNT(3)    ,PNT1(3)   ,OLDU1(3)  ,OGLE(3)   ,RZERO(3)  ,TANMOT(3) ,
     2TLEND1(3) ,V(3)      ,CEND(3)   ,DELMOT(3) ,D2(3)     ,DNMOT(3)  ,
     3AX4(3)    ,A         ,B         ,C         ,RA        ,HI        ,
     4ALPHA     ,GAMMA     ,CAGL      ,SAGL      ,COM1      ,COM4      ,
     5COSTH     ,CTOCL     ,DIAM      ,DIF       ,DIFOUT    ,DINC      ,
     6DP        ,DPE       ,DPI       ,DPL       ,DPMAX     ,DP1       ,
     7DPCNT     ,DSMOV     ,D1        ,D2A       ,EL1       ,EL2       ,
     8FIPNT     ,FLIPCK    ,HAFDIA    ,HCHORD    ,OFFSET    ,PROD1     ,
     9PROD2     ,PSI       ,RADNO     ,RC1       ,RDRM      ,RDRN
      COMMON/A2CMMN/ RONE  ,RZEROL    ,SAVE1     ,SIUTH     ,TANGL     ,
     1THETA     ,ALP       ,EPS7      ,VAMAX     ,VL        ,ZDOTC     ,
     2ZGAMMA    ,ZIGN      ,ZL        ,ZL1       ,ZL2       ,ZNPTS     ,
     3TOLBND    ,CENDIS    ,CENLEN    ,CHORD     ,ABCD(2)   ,ACARD(2)  ,
     4SAVE(6)   ,CUTDAT(7) ,TEM(10)   ,TEMP(20)  ,TCDAT(260),QEQUIV(20),
     5IS        ,IIS       ,IT        ,IIT       ,IPS       ,IIPS      ,
     6IDS       ,IIDS      ,ICS       ,IICS      ,IGS       ,IIGS      ,
     7ICDEFL    ,ICDEFS    ,IAUTPS    ,IGO       ,ICRDCT    ,ICUT      ,
     8IGTFLG    ,INOPS     ,ISRCH     ,IOFSET    ,ISTRUP    ,I3DFLG    ,
     9MULOUT    ,MULTAX    ,NUMAX     ,NUMSFS    ,NUMSUR    ,IGOUG
      COMMON/A2CMMN/ IPDPL ,NUMDIM    ,IRSTRT    ,ICSCNT    ,I3        ,
     1I31       ,J         ,JA        ,JL        ,JS        ,JT        ,
     2KC        ,KND       ,KR        ,L         ,INCFS     ,NP        ,
     3IBEGIN    ,IFAR1     ,IK        ,INS1      ,ITNFLG    ,IVAMAX    ,
     4IWS       ,IIWS      ,IZ        ,NEXT1     ,NEXT2     ,NPTS      ,
     5NUMPT1    ,JAM       ,JAP       ,JTUSED    ,IFRL      ,N         ,
     6M         ,MDIC      ,JBR       ,JCKR      ,JCPR      ,JCR       ,
     7JDR       ,JGR       ,JMIN      ,JMINR     ,JPR       ,JPXR      ,
     8JTR       ,JCNT1     ,JCNT2     ,JCNT3     ,JSW       ,JTKF      ,
     9LISV      ,LSV       ,IPT       ,JFIND     ,IC        ,ICC
      COMMON/A2CMMN/  IL   ,K         ,NUMPTS    ,IAMDCT    ,IFL2      ,
     1J5        ,J6        ,JW6       ,J10       ,J12       ,J13       ,
     2J40 ,J43 ,J54 ,J103
C... A2CMMN END
      COMMON/A2FPC / Q15X01,QP9X01    ,QP6X01    ,QP5X01    ,QP4X01    ,
     1QP0001    ,QP001     ,QP01      ,QP1       ,Q1P       ,Q10P      ,
     2Q1000P    ,Q1PE5     ,Q1PE6     ,Q1PE10    ,Q1PE20    ,Q1PE30    ,
     3Q1PE36    ,Q1PE38    ,QP8X01    ,QP7X01    ,
     4QP4X09    ,QP9       ,QP99      ,QP995     ,QP997     ,QP999     ,
     5QP9999    ,QP4X95    ,QP5X95    ,QP6X9     ,QP7X9     ,
     6QP6X05    ,QP5X05    ,QP4X05    ,QP0005    ,QP005     ,QP05      ,
     7QP5       ,Q5P       ,                                 Q4X045    ,
     8QP0002    ,QP0047    ,QP017     ,Q1RAD     ,QP0349    ,QP125     ,
     9QP6       ,QP2       ,QP2499    ,QP25      ,QP3
      COMMON/A2FPC / QP7   ,QP75      ,QP8       ,QP866     ,Q1P01     ,
     1Q1P1      ,Q1P2      ,Q1P25     ,Q1P5      ,Q2P       ,Q2P5      ,
     2Q3P       ,Q3P5      ,Q4P       ,Q8P       ,Q11P      ,Q45P      ,
     3Q90P      ,Q130P     ,Q4500P    ,Q9000P    ,QP02      ,QNUL      ,
     4QPIE       ,QFIL(9)
      DIMENSION AB(22)
      DATA AB( 1),AB( 2)/4HADEL,4HTATP/,    AB(3 ),AB( 4)/4HADEL,4HTA01/
     1,    AB( 5),AB( 6)/4HADEL,4HTA02/,    AB( 7),AB( 8)/4HADEL,4HTA03/
     2,    AB( 9),AB(10)/4HADEL,4HTA04/,    AB(11),AB(12)/4HADEL,4HTA05/
     3,    AB(13),AB(14)/4HADEL,4HTA06/,    AB(15),AB(16)/4HADEL,4HTA07/
     4,    AB(17),AB(18)/4HADEL,4HTAEX/,    AB(19),AB(20)/4HADEL,4HTA08/
     5,    AB(21),AB(22)/4HADEL,4HTA09/
      CALL ADYNDP(AB( 1),3,111100)
      K22222 = 0
      IJKLMN = 0
      AAP=RC(IPS)
      BAP=RC(IDS)
      KAP=IS
      IKAP=IIS
      DPE = Q1PE10
      DPI=DP
      RC1=RC1**2
      J = 0
C  SPECIAL BRANCH FOR NORMPS OR NORMDS
      IPSF = 0
      IDSF = 0
      IF(MULTAX .NE. 1) GO TO 101
      IF(NUMAX .NE. 5) GO TO 101
      IF(ICC .EQ. 1) IPSF = 1
      IF(ICC .EQ. 2) IDSF = 1
C1.2      DO FOR PART SURFACE FIRST
  101 IS=IPS
      IIS=IIPS
C
C1.3      CALCULATE P1, P2, AND IK, CCURV INPUTS, AND ZL=DIST(P1,P2)
  103 IF(IS .EQ. IPS .AND. IPSF .EQ. 1) GO TO 1003
      IF(IS .EQ. IDS .AND. IDSF .EQ. 1) GO TO 1003
      GO TO 104
 1003 CALL AVSTO(SP(IS),P1)
      CALL AVSTO(SPK(IS),P2)
      GO TO 106
  104 CALL AVMULT (TN(IS),CUTDAT(2),VTEM)
      CALL AVSUB(TP(IS),VTEM,TEM(1))
      CALL AVMULT(TNK(IS),CUTDAT(2),VTEM)
      CALL AVSUB(TPK(IS),VTEM,TEM(4))
      CALL AVSUB(TEM(1),TE,VTEM)
      CALL AVDOT(VTEM,TA,PROD1)
      CALL AVSUB(TEM(4),TEK,VTEM)
      CALL AVDOT(VTEM,TAK,PROD2)
      ZL = QNUL
      DO 105 K=1,3
      P1(K)=TE(K)+PROD1*TA(K)
      P2(K)=TEK(K)+PROD2*TAK(K)
  105 CONTINUE
  106 CONTINUE
      CALL AVSUB(P1,P2,VTEM)
      IF(JBR.EQ.1) CALL AVSUB(TE,TEK,VTEM)
      IF(IPSF .EQ. 1 .AND. IS .EQ. IPS) CALL AVSUB(TE,TEK,VTEM)
      IF(IDSF .EQ. 1 .AND. IS .EQ. IDS) CALL AVSUB(TE,TEK,VTEM)
      CALL AVDOT(VTEM,VTEM,ZL)
      CALL ADYNDP(AB( 3),5,110000)
C***
C***
C      DELETED
C     IK=IS+J
C***
C***
C
C1.4      FIND RC=RADIUS OF CURVATURE ALONG NORMAL AT P1
      IF(J.EQ.0)   CALLACCURV(IS,IIS,P1,P2,SN(IS))
      IF(J.EQ.3)   CALLACCURV(IS,IIS,P1,P2,SNK(IS))
C
      IF(DABS(RC(IS)) - Q45P)301,302,301
  302 D1 = Q9000P
      GO TO 303
  301 D1 = Q2P*DABS(RC(IS))
C
  303 CALL ADYNDP(AB( 5),5,110000)
      IF(IS-IPS)113,112,113
C1.7      STORE RESULTS IN D2A,ZL1, AND RETURN FOR LIKE CALC. FOR DS
  112 D2A=D1
      ZL1=ZL
      IS=IDS
      IIS = IIDS
      GO TO 103
C
C1.8      USE RESULTS OF SURFACE, PS OR DS, HAVING GREATEST CURVATURE
  113 IF(D1-D2A)115,115,114
C1.9      RESTORE PS RESULTS (MOST CONSERVATIVE AFTER ALL)
  114 D1=D2A
      ZL=ZL1
      IS=IPS
      IIS = IIPS
      CALL ADYNDP(AB( 7),5,110000)
C1.10     UNSQUARE ZL AND CALCULATE DP (SAFE CUT VECTOR
C1.10    LENGTH BASED ON SURFACE WITH MOST CURVATURE)
  115 ZL = DSQRT(ZL)
      RC(IPS) = AAP
      RC(IDS) = BAP
      DP = DSQRT(Q4P*TAU(IS) * DABS(D1 - TAU(IS)))

C1.12     IF BEGINNING CUT VECTOR CANDIDATE BEING TESTED, STORE
C1.12    CURRENT RESULTS (BASED ON NORMALS AT TERMINUS OF CUT VECTOR)
C1.12    AND RETURN FOR CALCULATIONS BASED ON NORMALS AT ORIGIN OF
C1.12    CUT VECTOR
      IF(J12)116,116,117
  116 DPE=DP
      ZL2=ZL
      J=3
      J12=1
      CALL ADYNDP(AB( 9),5,110000)
      GO TO 101
C
C1.13     UNSQUARE RC1.  NO FURTHER USE FOR THIS VARIABLE.
  117 RC1 = DSQRT(RC1)
C
C1.14     COMPARE CUT VECTOR LENGHTS BASED ON NORMALS AT ORIGIN AND
C1.14    TERMINUS OF CUT VECTOR.  IF BEGINNING CUT VECTOR CANDIDATE
C1.14    NOT UNDER CONSIDERATION DPE IS RIDICULOUS--TRANSFER TO C1.15
      IF(DP-DPE)119,119,118
C1.15     RESTORE RESULTS BASED ON NORMALS AT TERMINUS
C1.15    OF CUT VECTOR CANDIDATE
  118 DP=DPE
      ZL=ZL2
      CALL ADYNDP(AB(11),5,110000)
C
C1.16     PRESERVE UNTRUNCATED DP FOR USE IN ANOTHER PROGRAM
  119 DPL=DP
C
C2.1      TRUNCATE DP SO AS TO LIE BETWEEN TAU AND DPMAX
      IF(DP-DPMAX)122,125,121
  122 IF(DP-TAU(IS))124,125,125
  124 DP=TAU(IS)
      CALL ADYNDP(AB(13),5,110000)
      GO TO 125
  121 DP=DPMAX
C
  125 IF(DP-ZL+TAU(IS))130,151,151
  155 IF(DP - QP6*DPI + TAU(IS))129,127,127
C2.9      CUT VECTOR CANDIDATE MUCH TOO LONG.  REDUCE IT TO .6 OF ITS
C2.9     CURRENT VALUE, SUBMIT TO ONE MORE TEST AND EXIT FAILING
  129 DP = QP6*DPI
      CALL ADYNDP(AB(15),5,110000)
      GO TO 127
C2.10     BYPASS FURTHER DP MODIFICATION AND EXIT AT ONCE IF CS INVOLVED
  130 IF(DP - DPI) 841,841,141
  841 DPI = DP/ZL
      GO TO 243
C
C2.11     IF ZL EXCEEDS DPI REDUCE DP BY A FACTOR DPI/ZL
  141 DPI=DPI/ZL
  243 IF(DPI - QP6)244,244,143
  244 DPI = QP6
  143 DP=DP*DPI
C
C2.14     REJECT CUT VECTOR CANDIDATE
  145 JDR=1
      I = DPCNT + QP01
      IF(I.EQ.10)  GO TO 146
      IF(I.GT.5) GO TO 201
      IF(ZL-DPSAVR) 160,201,201
  146 IF(JBR.EQ.0) DPSAVR = DP
  201 IS=KAP
      IIS = IKAP
      IF(K22222 .NE. 0) GO TO 99999
      IJKLMN = JBR + JDR
      IF((IJKLMN .EQ. 2) .AND. (DPCNT .LE. Q3P)) GO TO 157
99999 CONTINUE
      CALL ADYNDP(AB(17),3,111100)
      RETURN
C
C
C         TENTATIVELY ACCEPT CUT VECTOR (MUST PASS GOUGCK YET)
C2.16     CUT DP DOWN TO 2DPI IF IT EXCEEDS THIS NO.  THIS PREVENTS
C2.16    WILD FLUCUATIONS OF THE DP CAUSED BY RAPID CHANGE
C2.16    IN SURFACE CURVATURE ALSO PRESENTS POINT SPACING
C2.16    TO POST PROCESSOR ADAPTABLE TO FEED RATES.
  151 IF(DP - Q2P*DPI + TAU(IS))155,155,153
  153 DP = Q2P*DPI
C
C
      CALL ADYNDP(AB(19),5,110000)
  127 IF((JCKR.EQ.1).AND.(J24(IIPS).EQ.2).AND.(D2A.LT.Q9000P))GO TO 157
      IF(IGOUG)160,160,157
  157 IF((IJKLMN .EQ. 2) .AND. (DPCNT .LE. Q3P)) K22222 = 1
      CALL AGOUCK
C2.22     IF GOUGCK FAILS, REJECT CUT VECTOR AND REDUCE DP TO .75DP
      IF(JGR)159,160,159
  159 DP = QP75*DP
      CALL ADYNDP(AB(21),5,110000)
      GO TO 145
C
C2.23     ACCEPT CUT VECTOR CANDIDATE
  160 JDR=0
      GO TO 201
C
C
       END

