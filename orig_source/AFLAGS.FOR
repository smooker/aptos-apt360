      SUBROUTINE AFLAGS
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
      IMPLICIT REAL*8(A-H,O-Z)
       LOGICAL*1 LCLAS1(2400),GCL(4)
       INTEGER ISLASH/Z00000304/
       INTEGER*2 KLMENT(2400),KCL/0/,KSC/0/
       REAL*8 NAME,KRFSYS
       INTEGER DEBUG,SUM
      COMMON/A1COM/NAME,KRFSYS,SUM,JSUBER,NAMSUB,DEBUG,INDXPT,LOOP,IFINI
       COMMON/APRTAB/ISTARP,IENDP,NMOVE,NL,ITSQ,LINDX
      COMMON/AVST/VST(2750),PTPP(2225),CANON(2225)
       COMMON/AILMTB/ELMENT(600),ICLASS(600),JLMENT
      COMMON/APTPP/PT(300),INPTP,NW,JMODE,KLASS,KLASTP,IRECN,NPT,NPR
      COMMON/AMOTCM/PINT(30),IFURST,JPTIND,NOW,JSUB,KRESLT,KRSLT2,NWDS
     1,ITS,NEXT,MULTAX
      COMMON/ADATA1/ANODEF,BLANX,BLANKS,SYN,TLAXIS,DUMMY,PLENT,LOOPST
     1 ,LOOPND,MACRO,NTRMAC,NCALL,LAPTH,JAPTH,IPLUS,NCOMMA,IFF,IC(10),
     2 LLASS
       DIMENSION IPT(600)
       EQUIVALENCE (ICLASS(1),LCLAS1(1)),(ELMENT(1),KLMENT(1))
       EQUIVALENCE (PT(1),IPT(1))
       EQUIVALENCE (GCL(1),KCL),(GCL(3),KSC)
C
C...     JTEMP3 IS A NUMBER COUNTER
   10 JTEMP3=0
       IPT(1) = 6
       INPTP = 4
       NPT = 0
      JMODE=5
C...     PICK UP A PTPP ENTRY AND EVALUATE
   20  CALL APTLOD
C...     RESET PTPP STORING INDEX TO START
       INPTP = 4
C...     0=MINOR MODIFIER, 1=VOCABULARY,
C...     2=NUMBER, 3=SCALAR VARIABLE, 4=SURFACE, 5=STATEMENT I.D.
C...     6=UNDEFINED(MAY BE I.D.), 7=SUBSCRIPTED VARIABLE, 8=ERROR
            IF(JPTIND.NE.1) GO TO 4020
C...     CONVERT VOCABULARY CODE FOR BRANCHING
   70 JTEMP1=KRESLT/1000
       MAJOR = KRESLT
       ISUBST = KRSLT2
       IPT(5) = KRESLT
       IPT(6) = ISUBST
C...     TEST BRANCH SWITCH RANGE
            IF(JTEMP1.EQ.9) GO TO 1560
            IF(JTEMP1.NE.6) GO TO 4020
C
C...     6000 CODE FOUND
C
  780  JTEMP1 = 4*ISTARP - 3
       GCL(2) = LCLAS1(JTEMP1-2)
       GCL(4) = LCLAS1(JTEMP1-3)
            IF(ISUBST.GT.2) GO TO 900
C...     TEST FOR DEBUG OR DYNDMP
            IF(KCL.NE.15) GO TO 785
C...     YES - IS IT DYNDMP
            IF(KSC.EQ.2) GO TO 900
C...     TEST FOR TOLERANCE OR CUTTER
  785       IF(KCL.EQ.2) GO TO 900
C...     TEST FOR BEVELS
            IF(KSC.EQ.10) GO TO 900
C
C...    CUT,  DNTCUT,  2DCALC,  3DCALC,  NDTEST FOUND
       IPT(7) = 1
       IPT(8) = 0
C...     TEST FOR DNTCUT
            IF(KSC.NE.2) GO TO 788
C...     YES - IF IT HAS A PARAMETER, MUST BE 'PRINT'
            IF(ISTARP-JLMENT)  786, 4000, 800
C...     TEST FOR SLASH
  786       IF(ICLASS(ISTARP).NE.ISLASH) GO TO 4040
       GCL(2) = LCLAS1(JTEMP1+7)
            IF(KCL.NE.2) GO TO 3000
            IF(KLMENT(JTEMP1+7).NE.0) GO TO 3000
            IF(KLMENT(JTEMP1+5).NE.3) GO TO 3000
            IF(ISTARP+1-JLMENT)  4000, 810, 4000
C
C...     TEST FOR CUT
  788       IF(KSC.EQ.1) GO TO 790
C...     NO - TRY 2DCALC
            IF(KSC.EQ.8) GO TO 790
C...     ...3DCALC
            IF(KSC.EQ.9) GO TO 800
C...     MUST BE NDTEST
            IF(KSC.EQ.6) GO TO 810
      GOTO 4020
C...     CUT OR 2DCALC
  790  PT(5) = 0.0
      GOTO 820
C...     DNTCUT OR 3DCALC
  800  IPT(9) = 0
       IPT(10) = 1
      GOTO 820
C...     NDTEST OR DNTCUT/PRINT
  810  IPT(9) = 0
       IPT(10) = 2
  820 INPTP=6
      NPT=1
       GO TO 4980
C
C...     TOLERANCE, CUTTER, DYNDMP, DMILL, OR BEVELS
  900  INPTP = 4
       NPT = 0
            IF(ISTARP.GE.JLMENT) GO TO 4000
C...     TEST FOR SLASH - IF FOUND, MOVE SCAN INDEX PAST IT
            IF(ICLASS(ISTARP).NE.ISLASH) GO TO 4040
       ISTARP = ISTARP + 1
C...     SET FLAG TO SKIP COMMAS IN APTLOD
       ITSQ = 4
       CALL APTLOD
C...     TEST FOR VOCABULARY WORD
            IF(JPTIND.NE.0) GO TO 915
C...     YES - TEST FOR CUTTER STATEMENT - MAY START WITH 'OPTION'
            IF(ISUBST.EQ.6) GO TO 1200
C...     NO - IF NOT BEVELS OR DMILL, ERROR
            IF(KSC-10)  4000, 1120, 4000
C
  910  CALL APTLOD
  915       IF(JPTIND.EQ.2) GO TO 920
            IF(JPTIND.NE.3) GO TO 4000
  920  NPT = NPT + 1
            IF(ISTARP.LE.JLMENT) GO TO 910
            IF(KCL.NE.15) GO TO 925
            IF(KSC.EQ.2) GO TO 1320
  925       IF(ISUBST-6)  930, 1000, 4980
C
C...     TOLERANCE STATEMENT
  930       IF(NPT.GT.4) JSUBER = 129
            IF(NPT.GE.4) GO TO 950
       JTEMP2 = INPTP - NOW
       DO 940  I = NPT,3
       PT(INPTP) = PT(NOW)
       PT(INPTP+1) = PT(NOW+1)
            IF(JTEMP2.EQ.2) GO TO 940
       PT(INPTP+2) = PT(NOW+2)
  940  INPTP = INPTP + JTEMP2
  950  NPT = 4
C...     TEST FOR INTOL OR OUTTOL STATEMENT
            IF(ISUBST.EQ.4) GO TO 4980
            IF(ISUBST.EQ.5) GO TO 4980
C...     NO - IF NOT TOLER, SOMETHING WRONG
            IF(ISUBST.NE.2) GO TO 4020
C
C...     TOLER STATEMENT
C...     OUTPUT OUTTOL
  960  IPT(2) = INPTP - 2
       IPT(3) = 4
       IPT(4) = 0
       IPT(5) = 6000
       IPT(6) = 5
      INPTP=INPTP-1
      CALL APTPUT
C...     OUTPUT INTOL ZERO
       IPT(6) = 4
       IPT(7) = 1
       IPT(8) = 0
       PT(5) = 0.0
       DO 970  I = 3,7,2
       PT(I+3) = PT(I+1)
  970  PT(I+4) = PT(I+2)
      INPTP = 12
      GO TO 4994
C
C...     CUTTER STATEMENT
 1000       IF(NPT.LE.0) GO TO 1100
            IF(NPT.EQ.1) GO TO 4980
            IF(NPT.EQ.2) GO TO 4980
            IF(NPT.EQ.7) GO TO 4980
 1100  JSUBER = 129
       GO TO 4980
C
C...     BEVELS OR DMILL STATEMENT...
C...     MAKE SURE STATEMENT ONLY CONTAINS THE ONE PARAMETER
 1120       IF(ISTARP.LE.JLMENT) GO TO 4000
       NPT = 1
C...     TEST FOR DMILL
            IF(ISUBST.EQ.11) GO TO 1130
C...     NO - BEVELS - MODIFIER CAN ONLY BE 'OFF' OR 'ON'
            IF(KRESLT.EQ.71) GO TO 4980
            IF(KRESLT-72)  4020, 4980, 4020
C
C...     IT IS DMILL - MODIFIER MUST BE 'DSTAN', 'PSTAN', OR 'NOMORE'
 1130       IF((KRESLT.EQ.27).OR.(KRESLT.EQ.146)) GO TO 4980
            IF(KRESLT-53)  4020, 4980, 4020
C
C...     CUTTER/OPTION
 1200       IF(KRESLT.NE.144) GO TO 4020
 1210       IF(ISTARP.GT.JLMENT) GO TO 3000
       INPTP = 4
       CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 1220
            IF(JPTIND.NE.3) GO TO 4000
 1220       IF(ISTARP.GT.JLMENT) GO TO 3000
       CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 1250
      IF(JPTIND.EQ.3) GOTO 1250
            IF(JPTIND.NE.0) GO TO 4000
 1230  PT(NOW-1) = 3.0
       JTEMP1 = 2*NOW - 1
       IPT(JTEMP1) = 1
       IPT(JTEMP1+1) = 0
       PT(NOW+2) = PT(NOW)
       PT(NOW+1) = 0.0
       PT(NOW+3) = 0.0
       INPTP = NOW + 4
       NPT = 3
       GO TO 4980
C
 1250       IF(ISTARP.GT.JLMENT) GO TO 3000
       CALL APTLOD
       NPT = 3
            IF(JPTIND.EQ.2) GO TO 4980
            IF(JPTIND-3)  4000, 4980, 4000
C
C...     DYNDMP
 1320 IF(NPT.LT.2) GOTO 3000
      IF(NPT.GT.24) GOTO 3000
      IF((NPT/2*2).NE.NPT) GOTO 3000
      GOTO 4980
C...
C...     9000 CODE FOUND
C...
 1560       IF(ISUBST.LT.1) GO TO 4020
            IF(ISUBST.GT.8) GO TO 4020
       GO TO (1591,1575,1580,1580,1580,1570,1570,1572),ISUBST
C
C...     NOPS OR AUTOPS
 1570       IF(ISTARP.LE.JLMENT) JSUBER = 129
      GOTO 4980
C
C...     GOUGCK
 1572       IF(ISTARP.GE.JLMENT) GO TO 3000
       GO TO 1576
C
C...     MULTAX
 1575       IF(MULTAX.EQ.1) GO TO 9999
 1576  IPT(7) = 1
       IPT(8) = 0
       IPT(9) = 0
       IPT(10) = 1
       INPTP = 6
      NPT=1
C...     IF GOUGCK, SKIP TEST FOR MULTAX WITH NO PARAMETERS
            IF(ISUBST.EQ.8) GO TO 1578
            IF(ISTARP-JLMENT)  1578, 4000, 1577
 1577  MULTAX = 1
       GO TO 1600
C...     TEST FOR SLASH - IF FOUND, MOVE SCAN INDEX PAST IT
 1578       IF(ICLASS(ISTARP).NE.ISLASH) GO TO 4040
       ISTARP = ISTARP + 1
C...     SET FLAG TO SKIP COMMAS IN APTLOD
       ITSQ = 4
       CALL APTLOD
            IF(ISTARP.LE.JLMENT) GO TO 4000
C...     MUST BE VOCABULARY
            IF(JPTIND.EQ.0) GO TO 1579
            IF(JPTIND-8)  3000, 5000, 3000
C...     TEST FOR 'ON'
 1579       IF(KRESLT.EQ.71) GO TO 1600
      PT(5)=0.
C...     WAS NOT 'ON' - IF NOT 'OFF', ERROR
            IF(KRESLT.EQ.72) GO TO 1600
      GOTO 4000
C
C...     MAXDP, NUMPTS, OR THICK
 1580       IF(ISTARP.GE.JLMENT) GO TO 3000
C...     TEST FOR SLASH - IF FOUND, MOVE SCAN INDEX PAST IT
            IF(ICLASS(ISTARP).NE.ISLASH) GO TO 4040
       ISTARP = ISTARP + 1
C...     SET FLAG TO SKIP COMMAS IN APTLOD
       ITSQ = 4
 1582  CALL APTLOD
            IF(JPTIND.EQ.2) GO TO 1585
            IF(JPTIND.EQ.3) GO TO 1585
            IF(JPTIND.EQ.8) GO TO 1585
       JSUBER = 132
 1585  NPT = NPT + 1
            IF(ISTARP.LE.JLMENT) GO TO 1582
            IF(ISUBST.EQ.5) GO TO 1587
C
C...     MAXDP, OR NUMPTS
      IF ( NPT.EQ.1) GOTO 4980
      JSUBER=129
      NPT=1
      INPTP=6
      GOTO 1600
C
C...  THICK/THPS,THDS,THCS1,THCS2
 1587       IF(NPT.GT.4) JSUBER = 129
            IF(NPT.GE.4) GO TO 1600
C...     FILL UP PARAMETERS
       JTEMP1=INPTP-1
      DO 1590 I=NPT,4
       DO 1588 J=NOW,JTEMP1
       PT(INPTP)=PT(J)
 1588  INPTP=INPTP+1
 1590  CONTINUE
       NPT = 4
      GOTO 1600
C
C...     TLAXIS
 1591       IF(ISTARP.GE.JLMENT) GO TO 4020
C...     TEST FOR SLASH - IF FOUND, MOVE SCAN INDEX PAST IT
            IF(ICLASS(ISTARP).NE.ISLASH) GO TO 4040
       ISTARP = ISTARP + 1
C...     SET FLAG TO SKIP COMMAS IN APTLOD
       ITSQ = 4
       NPT = 1
       INPTP = 6
       CALL APTLOD
      IF(JPTIND.EQ.0) GOTO 1595
      IF(JPTIND.EQ.4) GOTO 1592
      IF(JPTIND.EQ.2) GOTO 1593
      IF(JPTIND.EQ.3) GOTO 1593
      GOTO 4000
C
C...     TLAXIS/VECT
 1592 XITEM4=1.
       CALL ASWICH(11)
      NPT=2
      GOTO 1599
C
C...     TLAXIS/X,Y,Z
 1593 XITEM4=1.
C
C...     CHECK FOR TLAXIS/1
            IF(ISTARP.GT.JLMENT) GO TO 15945
C...     MOVE FIRST SCALAR UP TO MAKE ROOM FOR ZEROED NAME, SUBSCRIPT
       JTEMP1 = INPTP - 1
      INPTP=10
       DO 15931  J = NOW,JTEMP1
       PT(INPTP) = PT(J)
15931  INPTP = INPTP + 1
       IPT(11) = 1
       IPT(12) = 0
       PT(7) = 0.0
       PT(8) = PT(6)
       PT(9) = 0.0
       JTEMP3 = 1
 1594  CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 15941
            IF(JPTIND.NE.3) GO TO 4000
15941  JTEMP3 = JTEMP3 + 1
            IF(ISTARP.LE.JLMENT) GO TO 1594
       NPT = 6
            IF(JTEMP3-3)  3000, 1599, 3000
C
C...     TLAXIS/1
15945       IF(PT(INPTP-1).NE.1.0) JSUBER = 132
       XITEM4 = 5.0
       INPTP = 6
      GOTO 1599
C
C...     TLAXIS/VOCABULARY
 1595  XITEM4 = 2.0
C...     TEST FOR NORMPS
       ITEM5 = 1
            IF(KRESLT.NE.4000) GO TO 15951
            IF(KRSLT2-32767)  4000, 15952, 4000
C...     NOT NORMPS - TRY NORMDS
15951  ITEM5 = 2
            IF(KRESLT.NE.87) GO TO 15953
C...     NORMPS OR NORMDS - TEST FOR FURTHER PARAMETERS
15952       IF(ISTARP.GT.JLMENT) GO TO 1596
       XITEM4 = 9.0
       GO TO 1597
C...     SEE IF MODIFIER IS PERPTO
15953  XITEM4 = 8.0
            IF(KRESLT.EQ.18) GO TO 1597
      XITEM4=4.
            IF(KRESLT.EQ.17) GO TO 1597
      XITEM4=3.
            IF(KRESLT.EQ.1) GO TO 1602
       ITEM5 = 3
C...     TRY TANDS (TLAXIS/TANDS)
       XITEM4 = 6.0
            IF(KRESLT.EQ.183) GO TO 15954
C...     IF NOT FAN (TLAXIS/FAN), ERROR
       XITEM4 = 7.0
            IF(KRESLT.NE.184) GO TO 4020
C...     TEST FOR ANOTHER PARAMETER FOLLOWING TANDS OR FAN
15954       IF(ISTARP.LE.JLMENT) GO TO 1597
C
C...     TLAXIS/NORMPS, NORMDS, TANDS, OR FAN
 1596  IPT(11) = 1
       IPT(12) = 0
       IPT(13) = 0
       IPT(14) = ITEM5
      INPTP=8
      NPT=2
            IF(ISTARP.LE.JLMENT) JSUBER = 129
      GOTO 1599
C
C...     TLAXIS/MODIFIER,LIST
 1597  INPTP = 6
       CALL APTLOD
       NPT = 2
            IF(XITEM4.LT.8.0) GO TO 1598
C...     TLAXIS/PERPTO, NORMPS, OR MORMDS, VECTOR...
C...     TEST FOR SURFACE - IF NOT, ERROR
            IF(JPTIND.NE.4) GO TO 4000
C...     PUT VECTOR TYPE CODE INTO ENTRY
       CALL ASWICH(11)
C...     TEST FOR MORE DATA
            IF(ISTARP.GT.JLMENT) GO TO 1599
       CALL APTLOD
       NPT = 3
C
C...     PARAMETER MUST BE A SCALAR
 1598       IF(JPTIND.EQ.2) GO TO 1599
            IF(JPTIND.NE.3) GO TO 4000
C
 1599  IPT(7) = 1
       IPT(8) = 0
      PT(5)=XITEM4
            IF(ISTARP.LE.JLMENT) JSUBER = 129
C...     RETURN
 1600 GOTO 4980
C
C...     TLAXIS/ATANGL
 1602  INPTP = 6
       CALL APTLOD
      IF(JPTIND.EQ.3) GOTO 1603
            IF(PT(INPTP-1).GT.2.0) JSUBER = 132
            IF(PT(INPTP-1).LT.1.0) JSUBER = 132
            IF(JPTIND.NE.2) GO TO 4000
 1603  CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 16031
            IF(JPTIND.NE.3) GO TO 4000
16031  NPT = 3
            IF(ISTARP.GT.JLMENT) GO TO 1599
       CALL APTLOD
      IF(JPTIND.EQ.4) GOTO 1610
      IF(JPTIND.EQ.2) GOTO 1620
      IF(JPTIND.EQ.3) GOTO 1620
            IF(JPTIND.NE.0) GO TO 4000
 1604       IF(ISTARP.GT.JLMENT) GO TO 4000
 1605  INPTP = NOW
       CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 1607
            IF(JPTIND.NE.3) GO TO 4000
 1607  NPT = 4
       GO TO 1599
C
 1610  CALL ASWICH(11)
      NPT=4
      GOTO 1599
C
 1620  DO 1621  J = NOW,INPTP
 1621  PT(J+4) = PT(J)
       INPTP = INPTP + 4
       JTEMP1 = 2*NOW - 1
       IPT(JTEMP1) = 1
       IPT(JTEMP1+1) = 0
       PT(NOW+1) = 0.0
       PT(NOW+2) = PT(NOW)
       PT(NOW+3) = 0.0
       JTEMP3 = 1
      NPT=8
 1622  CALL APTLOD
      IF(JPTIND.EQ.2) GOTO 1625
            IF(JPTIND.NE.3) GO TO 4000
 1625  JTEMP3 = JTEMP3 + 1
            IF(ISTARP.LE.JLMENT) GO TO 1622
            IF(JTEMP3-3)  3000, 1599, 3000
C
C...     ERROR MESSAGES
 3000 JSUBER=129
      GOTO 5000
C...     ILLEGAL FORMAT
 4000       IF(JPTIND.EQ.8) GO TO 5000
       JSUBER = 132
 4010 GO TO 5000
C...     IMPROPER VOCABULARY CODE
 4020 JSUBER=133
 4030 GO TO 5000
C...     MISSING SLASH
 4040  JSUBER = 155
       GO TO 5000
C
 4980  IPT(5) = MAJOR
       IPT(6) = ISUBST
 4990  IPT(3) = NPT
       IPT(4) = 0
 4994 IPT(2) = INPTP-2
 4995 INPTP=INPTP-1
 4999 JMODE=5
      CALL APTPUT
 5000 CONTINUE
 9999 RETURN
      END

