      SUBROUTINE ATFMVC(IT)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
      IMPLICIT REAL*8(A-H,O-Z)
      INTEGER TT
       COMMON /ATMATY/XMAT4(16),XMAT3(16),XMAT2(16),XMAT1(16),TMATX(16)
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
      COMMON/ADFSTO/DEFSTO(85),PARTNO(11)
      EQUIVALENCE (DEFSTO(1),KSTYP)
      TT=IT
      IF(TT)10,30,20
 10   TT=0
 20   X=DEFSTO(4)
      Y=DEFSTO(5)
      Z=DEFSTO(6)
      K=4
C     TRANSFORM RADIUS OF CIRCLE, CYLINDER AND SPHERE
      IF((KSTYP.NE.4).AND.(KSTYP.NE.5).AND.(KSTYP.NE.13)) GO TO 40
      I=10
      IF(KSTYP.EQ.13) I=7
      DET = TMATX(1)*((TMATX(6)*TMATX(11))-(TMATX(10)*TMATX(7)))
     C     -TMATX(2)*((TMATX(5)*TMATX(11))-(TMATX(7)*TMATX(9)))
     C     +TMATX(3)*((TMATX(5)*TMATX(10))-(TMATX(6)*TMATX(9)))
      DET = (DABS(DET))**(1.D0/3.D0)
      DEFSTO(I) = DEFSTO(I)*DET
      GO TO 40
 30   X=DEFSTO(7)
      Y=DEFSTO(8)
      Z=DEFSTO(9)
      K=K7
 40   DO 70 J=K1,9,4
      SUM=TMATX(J)*X+TMATX(J+1)*Y+TMATX(J+2)*Z
      IF(TT.EQ.0 ) GOTO 50
      DEFSTO(K)=SUM+TMATX(J+3)
      GOTO 60
 50   DEFSTO(K)=SUM
 60   K=K+K1
 70   CONTINUE
C     NORMALIZE VECTOR OF CYLINDER AND CONE
      IF(IT.NE.0) GO TO 90
      IF((KSTYP.NE.5).AND.(KSTYP.NE.8)) GO TO 90
      FAC = DEFSTO(7)*DEFSTO(7)+DEFSTO(8)*DEFSTO(8)+DEFSTO(9)*DEFSTO(9)
      IF(DABS(FAC-1.D0).LE.10.D-13) GO TO 90
      FAC = 1.D0/DSQRT(FAC)
      DO 80 K=7,9
      DEFSTO(K) = DEFSTO(K)*FAC
   80 CONTINUE
   90 RETURN
      END

