      SUBROUTINE APAREN
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
      IMPLICIT REAL*8(A-H,O-Z)
       LOGICAL*1 LCLAS1(2400),ITYPE1(2)
       REAL*8 NAME,KRFSYS
       INTEGER*2 ITYPE
       INTEGER DEBUG,SUM
C     PAREN ANALYZES AND EXTRACTS NESTING INFORMATION FROM STATEMENT
C     BETWEEN THE ARGUMENTS SUPPLIED
      COMMON/A1COM/NAME,KRFSYS,SUM,JSUBER,NAMSUB,DEBUG,INDXPT,LOOP,IFINI
      COMMON/APRTAB/ISTARP,IENDP,NMOVE,NL,ITSQ,LINDX
       COMMON/APARTB/ILPCNT,IRPCNT,LSTNST
      COMMON/AILMTB/ELMENT(600),ICLASS(600),JLMENT
       DIMENSION LMENT(1200)
       EQUIVALENCE (ICLASS(1),LCLAS1(1)),(ELMENT(1),LMENT(1))
       EQUIVALENCE (ITYPE,ITYPE1(1))
C
C     INITIALIZE
       LSTNST = 0
       ITYPE = 0
       NSTOPN = 0
       ILPCNT = 0
       IRPCNT = 0
       INDXY = ISTARP
       J = 4*ISTARP - 3
C
       DO 100  JK = ISTARP,IENDP
       ITYPE1(2) = LCLAS1(J+3)
            IF(ITYPE.NE.4) GO TO 90
       ITYPE1(2) = LCLAS1(J+2)
            IF(ITYPE.EQ.7) GO TO 50
            IF(ITYPE.NE.6) GO TO 90
C
C...     LEFT PARENTHESIS FOUND - COMPUTE INDEX TO TWO 4-BYTE
C...     ELMENT ENTRIES
       INDX2 = 2*INDXY - 1
C...     PUT INDEX TO PRECEDING NEST INTO LAST 4 BYTES OF ELMENT ENTRY
       LMENT(INDX2+1) = LSTNST
C...     SAVE INDEX TO THIS LATEST NEST
       LSTNST = INDXY
C...     RESET OPEN NEST POINTER TO THIS NEST
       NSTOPN = INDXY
C...     INCREMENT LEFT PARENTHESIS COUNTER
       ILPCNT = ILPCNT + 1
       GO TO 90
C
C...     RIGHT PARENTHESIS FOUND - INCREMENT ITS COUNTER
   50  IRPCNT = IRPCNT + 1
C...     DO WE HAVE AN OPEN NEST
            IF(NSTOPN.EQ.0) GO TO 90
C...     YES - PUT POINTER TO THIS RIGHT PAREN INTO ELMENT ENTRY
C...     FOR START OF THIS NEST
       INDX2 = 2*NSTOPN - 1
       LMENT(INDX2) = INDXY
C
C...     RESET OPEN NEST INDEX TO PREVIOUS NEST, IF THERE WAS ONE
   70  NSTOPN = LMENT(INDX2+1)
C...     IF OPEN NEST INDEX IS ZERO, ALL NESTS SO FAR HAVE BEEN
C...     CLOSED - GO TO CONTINUE SEARCH FOR NESTS
            IF(NSTOPN.EQ.0) GO TO 90
C
C...     ALL NESTS NOT YET CHECKED FOR CLOSURE - CHECK THIS ONE
       INDX2 = 2*NSTOPN - 1
            IF(LMENT(INDX2).NE.0) GO TO 70
C...     OPEN NEST INDEX PROPERLY RESET
C
   90  INDXY = INDXY + 1
  100  J = J + 4
C
       RETURN
       END

