      SUBROUTINE ADIAGM
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
C...  THIS ROUTINE PRINTS ERROR MESSAGES AND
C...  WRITES THE ERROR DIAGNOSTIC FILE FOR PASS THREE
C
      IMPLICIT REAL*8(A-H,O-Z)
       COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1 LOOP,IFINI
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
      EQUIVALENCE(TAPES4,ERRTAP),(POCTAP,PTPTAP)
      COMMON/A2CLS7/PPSEQ1,PPSEQ2,ENAME,EINAME,IEREC,ISN
      COMMON/A1PAS2/I,J,K,L,MOVLGE,KANMAX,ICANST,IOVREC,KANPTR,MDFTAB,
     1KANCNT,KAUX,KDFCNT,IDEFP,KPRCNT,MDFPRE,IPREP,KOVFLP,KSRFCT,KOVCNT,
     2LSCAN,IOVFLO,MAXCAN,IREF,ICANSC,NAMSTA,KANGO,LASPTP,ISUB,
     3LCOMP,LGEREC,IRECN,JREC,JNUM,KANCUR,KANCOT,KDFENT,KANPAR,LGELOC,
     4IDTMOV,ISPPRG,INDEXS,KPTP,KPTPCT,KLASTP,KLASCT,KPRNT
      INTEGER AEXTRA,AEXTRD,AMDTOA,AMAT0D,AEXCH
      COMMON/APROTP/PROTP(102),PROSAV(102),NOWCLT,LSTPSV,INCORE
     1,JGORIT,SAVMOT
C
C     WAS A VARIABLE SYMBOL INVOLVED
      IF(NOWCLT.EQ.0) GO TO 200
      NOWCLT = 0
      CALL ATAPOP(ERRTAP,1,IOFLAG)
  200 IF(ENAME.EQ.0.) GOTO 230
C     YES - INCLUDE IT IN THE DIAGNOSTIC MESSAGE
      WRITE(IOUTAP,260)PPSEQ1,PPSEQ2,ISN,JSUBER,ENAME,NAMSUB
 260  FORMAT(15H0***** CARD NO.2X,A6,A2,4H,ISNI5,15H,  ERROR NUMBERI5,9H
     1, NAME = A8,1H(I4,1H),10X,6H$$$$$$/1H )
      GOTO 250
 230  WRITE(IOUTAP,240)PPSEQ1,PPSEQ2,ISN,JSUBER
 240  FORMAT(15H0***** CARD NO.2X,A6,A2,4H,ISNI5,15H,  ERROR NUMBERI5,31
     1X,6H$$$$$$/1H )
C     WRITE ERROR FILE RECORD
 250  IEREC=IEREC+K1
 270  CALL ATAPWT(ERRTAP,IOFLAG,K3,IEREC,K1,ISN,K1,JSUBER,K1)
C     SET SYSTEM ERROR FLAG
      IWAVEN=K1
      LOOP = K1
      JSUBER=0
      ENAME=0.
      RETURN
      END

