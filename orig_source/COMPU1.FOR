      SUBROUTINE COMPU1
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
C********************************************************************
C
C...    COMPU1 COMPUTES THE ALTERED TOOL POSITION FOR VTLAXS.
C...    IT IS CALLED FROM COMPU AND COMPU2.
C...    THE TILT ANGLE IS PRORATED OVER THE TOTAL MOVE FROM
C...    VTLAXS/ON TO OFF, OR FROM VTLAXS/ON TO WCORN AND FROM
C...    WCORN TO VTLAXS/OFF.
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
       DIMENSION  IRR(1),ARR(1)
       EQUIVALENCE(IARROW,IRR(1))
       EQUIVALENCE(AMATI1(1,1),ARR(1))
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
       EQUIVALENCE(ITRCUT,LCLPRT)
      REAL*8 A5AXIS
      COMMON/A5AXIS/
     1ZP1   ,YP1   ,XP1   ,ZP2   ,YP2   ,XP2   ,ZP3   ,YP3   ,
     2XP3   ,ZP1B  ,YP1B  ,XP1B  ,ZP1F  ,YP1F  ,XP1F  ,ZP3F  ,
     3YP3F  ,XP3F  ,ZP3B  ,YP3B  ,XP3B  ,ZLM   ,YLM   ,XLM   ,
     4ZTA1  ,YTA1  ,XTA1  ,ZTA2  ,YTA2  ,XTA2  ,ZTA3  ,YTA3  ,
     5XTA3  ,ZDTA  ,YDTA  ,XDTA  ,ZTA2I ,YTA2I ,XTA2I ,ZCV1  ,
     6YCV1  ,XCV1  ,ZCV3  ,YCV3  ,XCV3  ,ZCV1P ,YCV1P ,XCV1P ,
     7ZCV3P ,YCV3P ,XCV3P ,ZCV1I ,YCV1I ,XCV1I ,ZCV3I ,YCV3I ,
     8XCV3I ,ZDCV  ,YDCV  ,XDCV  ,ZCP   ,YCP   ,XCP   ,ZCP1B ,
     9YCP1B ,XCP1B ,ZCP1F ,YCP1F ,XCP1F ,ZCP3B ,YCP3B ,XCP3B
      REAL*8 B5AXIS
      COMMON/B5AXIS/
     1ZCP3F ,YCP3F ,XCP3F ,ZDP   ,YDP   ,XDP   ,ZD01  ,YD01  ,
     2XD01  ,ZD03  ,YD03  ,XD03  ,ZPL1  ,YPL1  ,XPL1  ,ZPL3  ,
     3YPL3  ,XPL3  ,WCORN5,WCORN7,WCORN8,WTLXS6,TLNTH1,TLNTH2,
     4AI    ,ALPHA ,CSIGMA,CPHI  ,SH    ,CLAMDA,S1    ,S2    ,
     5S3    ,TS    ,GAMMA ,BETA  ,DELTA ,WCORN9,THETA ,S     ,
     6ZP2I  ,YP2I  ,XP2I
      REAL*4 A5FXIS
      COMMON/A5FXIS/
     1IP1   ,IP1I  ,IP2   ,IP2I  ,IP3   ,IP3I  ,IP1B  ,IP1BI ,
     2IP1F  ,IP1FI ,IP3F  ,IP3FI ,IP3B  ,IP3BI ,ILM   ,ILMI  ,IPS   ,
     3ICORN1,ICORN9,IFLAG ,IFLAG1,ICM   ,ICMI  ,II    ,IIII  ,IFG   ,
     4ITCONT,ITC1
      REAL*8 C5AXIS
      COMMON/C5AXIS/
     1Z1                  ,Z2                  ,ZSTART,YSTART,
     2XSTART,ZD    ,YD    ,XD    ,ZCV   ,YCV   ,XCV   ,ZDO   ,
     3YDO   ,XDO   ,ZCC   ,YCC   ,XCC   ,ZUN   ,YUN   ,XUN   ,
     4ZTR   ,YTR   ,XTR   ,ZTA   ,YTA   ,XTA   ,Z     ,STANG ,
     5ENDANG,DANG  ,CANG  ,DLNGTH,TLNGTH,CUTTER,TEST  ,CRADUS
      REAL*4 C5FXIS
      COMMON/C5FXIS/
     1IS    ,IR    ,IL    ,IE    ,JSUBER,IABOVE
C********************************************************************
      COMMON/TACHCK/XXXXTA,YYYYTA,ZZZZTA,CHINGX,CHINGY,CHINGZ
C
C...    PRORATE TILT ANGLE
      CANG=STANG+(DLNGTH/TLNGTH)*DANG
      TSIN=DSIN(CANG)
      TSIN=DSIN(CANG)
      TSIN1 =DABS(TSIN)
      TSIN1 =DABS(TSIN)
      TCOS=DCOS(CANG)
      CALL AVCROS(ZCV,ZUN,ZTR)
      CALL AVNORM(ZTR,ZTR,IER)
      IF(IER) 81,82,81
   81 JSUBER=37
C...    ERROR 37  - MACHINE ERROR.
      GO TO 40
   82 CONTINUE
C...    IS CANG .GT. 80 DEGREES
      IF(DABS(TCOS) -.1736D0) 5, 5, 90
90    CONTINUE
C...    CALCULATE XYZ COORDINATES OF NEW CUTTER POSITION
      IF(CRADUS)  100, 110, 100
100   CONTINUE
      Z = CRADUS*(1.0D0-TCOS)+(CUTTER-CRADUS)*TSIN1
      GOTO  120
110   CONTINUE
      Z =DABS(CUTTER*TSIN)
  120 IF(CANG*ZUN)  130, 150, 150
  130 IF(CRADUS)   140, 170, 140
  140 TEST=CUTTER*(TCOS-2.D0/TCOS+1.D0)-CRADUS*(TCOS-TSIN1+(TSIN1-1.D0)/
     1TCOS)
      GOTO 9
  150 IF(CRADUS)  160,  8, 160
  160 TEST = CRADUS*(TCOS-TSIN1+(TSIN1-1.D0)/TCOS)+CUTTER*(1.D0-TCOS)
      GOTO 9
  170 IF(IABOVE)  3,  6,  3
    3 Z = -Z
      GOTO 8
    5 JSUBER = 20
C...    ERROR 20- TILT ANGLE IS GREATER THAN 80 DEGREES.
      GOTO  40
    6 TEST = -(2.0D0*CUTTER/TCOS-CUTTER-CUTTER*TCOS)
      GOTO 9
    8 TEST = CUTTER*(1.0D0-TCOS)
    9 XDO = TEST*XTR
      YDO =TEST*YTR
      ZDO =TEST*ZTR
      XCC=X2+XDO
      YCC=Y2+YDO
      ZCC=Z2+Z
C...    CALCULATE IJK COMPONENTS OF NEW TLAXIS VECTOR
      XTR=TCOS*XTR
      YTR=TCOS*YTR
      IF(ZUN) 10, 20,20
   10 ZTR=TSIN
      CALL AVCROS(ZCV,ZTR,ZTA)
      GOTO 30
   20 ZTR=-TSIN
      CALL AVCROS(ZTR,ZCV,ZTA)
   30 CALL AVNORM(ZTA,ZTA,IER)
      IF((XXXXTA+YYYYTA+ZZZZTA) .NE. 0.D0) GO TO 99999
      XXXXTA = XTA
      YYYYTA = YTA
      ZZZZTA = ZTA
      GO TO 99997
99999 DIFXTA = XTA - XXXXTA
      DIFYTA = YTA - YYYYTA
      DIFZTA = ZTA - ZZZZTA
      IF(((DIFXTA*CHINGX).LT.0.D0).AND.(DABS(DIFXTA).GT.0.00001745D0))
     1 GO TO 99998
      IF(((DIFYTA*CHINGY).LT.0.D0).AND.(DABS(DIFYTA).GT.0.00001745D0))
     1 GO TO 99998
      IF(((DIFZTA*CHINGZ).LT.0.D0).AND.(DABS(DIFZTA).GT.0.00001745D0))
     1 GO TO 99998
      GO TO 99995
99998 WRITE(IOUTAP,99994)
      WRITE(IOUTAP,99996)
      WRITE(IOUTAP,99994)
99996 FORMAT(1H ,'** WARNING ... REVERSAL IN TOOL AXIS VECTOR COMPONENT(
     1S) DETECTED.       CHECK FOR INFLECTION IN CUTTER PATH.    **')
99994 FORMAT(1H ,'******************************************************
     1*************************************************************')
99995 IF (DIFXTA.GT.0.00000009D0) CHINGX = 1.D0
      IF (DIFYTA.GT.0.00000009D0) CHINGY = 1.D0
      IF (DIFZTA.GT.0.00000009D0) CHINGZ = 1.D0
      IF (DIFXTA .LT. -0.00000009D0) CHINGX= -1.0D0
      IF (DIFYTA .LT. -0.00000009D0) CHINGY= -1.0D0
      IF (DIFZTA .LT. -0.00000009D0) CHINGZ= -1.0D0
      XXXXTA = XTA
      YYYYTA = YTA
      ZZZZTA = ZTA
99997 CONTINUE
C...
      IF(IER)31,32,31
   31 JSUBER = 37
      GO TO 40
   32 CONTINUE
      X1=X2
      Y1=Y2
      Z1=Z2
   40 CONTINUE
      RETURN
       END

