      SUBROUTINE VTLAXS
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
C
C...    VTLAXS IS CALLED FROM ASECN3 WHEN A VTLAXS CLTAPE
C...    RECORD IS ENCOUNTERED.  CONTROL IS RETAINED UNTIL
C...    A VTLAXS/OFF IS ENCOUNTERED.
C...    VTLAXS ALTERS CLTAPE POINTS AND TOOL AXIS VECTORS
C...    BY PRORATING THE DIFFERENCE BETWEEN THE STARTING AND
C...    ENDING ANGLES ALONG THE SUM OF CUT VECTORS FOR
C...    SWARF CUTTING.  CORNER TRANSITION IS ACCOMPLISHED
C...    BY WCORN.
C********************************************************************
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
       DIMENSION  IRR(1),ARR(1)
       EQUIVALENCE(IARROW,IRR(1))
       EQUIVALENCE(AMATI1(1,1),ARR(1))
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
       EQUIVALENCE(ITRCUT,LCLPRT)
      REAL*8 A5AXIS
      COMMON/A5AXIS/
     1ZP1   ,YP1   ,XP1   ,ZP2   ,YP2   ,XP2   ,ZP3   ,YP3   ,
     2XP3   ,ZP1B  ,YP1B  ,XP1B  ,ZP1F  ,YP1F  ,XP1F  ,ZP3F  ,
     3YP3F  ,XP3F  ,ZP3B  ,YP3B  ,XP3B  ,ZLM   ,YLM   ,XLM   ,
     4ZTA1  ,YTA1  ,XTA1  ,ZTA2  ,YTA2  ,XTA2  ,ZTA3  ,YTA3  ,
     5XTA3  ,ZDTA  ,YDTA  ,XDTA  ,ZTA2I ,YTA2I ,XTA2I ,ZCV1  ,
     6YCV1  ,XCV1  ,ZCV3  ,YCV3  ,XCV3  ,ZCV1P ,YCV1P ,XCV1P ,
     7ZCV3P ,YCV3P ,XCV3P ,ZCV1I ,YCV1I ,XCV1I ,ZCV3I ,YCV3I ,
     8XCV3I ,ZDCV  ,YDCV  ,XDCV  ,ZCP   ,YCP   ,XCP   ,ZCP1B ,
     9YCP1B ,XCP1B ,ZCP1F ,YCP1F ,XCP1F ,ZCP3B ,YCP3B ,XCP3B
      REAL*8 B5AXIS
      COMMON/B5AXIS/
     1ZCP3F ,YCP3F ,XCP3F ,ZDP   ,YDP   ,XDP   ,ZD01  ,YD01  ,
     2XD01  ,ZD03  ,YD03  ,XD03  ,ZPL1  ,YPL1  ,XPL1  ,ZPL3  ,
     3YPL3  ,XPL3  ,WCORN5,WCORN7,WCORN8,WTLXS6,TLNTH1,TLNTH2,
     4AI    ,ALPHA ,CSIGMA,CPHI  ,SH    ,CLAMDA,S1    ,S2    ,
     5S3    ,TS    ,GAMMA ,BETA  ,DELTA ,WCORN9,THETA ,S     ,
     6ZP2I  ,YP2I  ,XP2I
      REAL*4 A5FXIS
      COMMON/A5FXIS/
     1IP1   ,IP1I  ,IP2   ,IP2I  ,IP3   ,IP3I  ,IP1B  ,IP1BI ,
     2IP1F  ,IP1FI ,IP3F  ,IP3FI ,IP3B  ,IP3BI ,ILM   ,ILMI  ,IPS   ,
     3ICORN1,ICORN9,IFLAG ,IFLAG1,ICM   ,ICMI  ,II    ,IIII  ,IFG   ,
     4ITCONT,ITC1
      REAL*8 C5AXIS
      COMMON/C5AXIS/
     1Z1                  ,Z2                  ,ZSTART,YSTART,
     2XSTART,ZD    ,YD    ,XD    ,ZCV   ,YCV   ,XCV   ,ZDO   ,
     3YDO   ,XDO   ,ZCC   ,YCC   ,XCC   ,ZUN   ,YUN   ,XUN   ,
     4ZTR   ,YTR   ,XTR   ,ZTA   ,YTA   ,XTA   ,Z     ,STANG ,
     5ENDANG,DANG  ,CANG  ,DLNGTH,TLNGTH,CUTTER,TEST  ,CRADUS
      REAL*4 C5FXIS
      COMMON/C5FXIS/
     1IS,IR,IL,IE,JSUBER,IABOVE,ISUBER
C********************************************************************
      DATA IBITS/ZFFFFFFFF/, MASK/ZFFFFFFFF/, IVTLON/0/
C...
      COMMON/TACHCK/XXXXTA,YYYYTA,ZZZZTA,CHINGX,CHINGY,CHINGZ
      XXXXTA = 0.D0
      YYYYTA = 0.D0
      ZZZZTA = 0.D0
      CHINGX = 0.D0
      CHINGY = 0.D0
      CHINGZ = 0.D0
       ARADS = 57.2957795131D0
C...    PROCESS VTLAXS/ON AND INITIALIZE VARIABLES          ***** 1*****
      JSUBER=0
      ICORN1 = 0
      IFLAG1 = 0
      IIII =K3
      JFLAG = 0
      IE = IRECNO+K1
      IF (I1.EQ.71) GO TO 18
      NURCNO = NURCNO+1
      IF (IVTLON.EQ.1) GO TO 1000
   10 JSUBER=15
C...    ERROR 15 - A VTLAXS/OFF COMMAND WAS GIVEN WITHOUT A
C...               PREVIOUS VTLAXS/ON COMMAND.
      GOTO 990
C     INCOMPLETE VTLAXS/ON STATEMENT
   15 JSUBER = 40
      NURCNO = NURCNO + 1
      GO TO 990
   18 IVTLON=1
      IF (NUMWDS.LT.6) GO TO 15
20    ITEST = IBITS
      LWTLXS=1
C...    GET STARTING ANGLE
      STANG = TAPSTO(3)/ARADS
      IR = IRECNO
C...    IS TILT RIGHT(24) OR LEFT
      IF(I2-24) 40,30,40
   30 STANG= -STANG
C...    STORE HALF CUTTER DIAMETER AND CORNER RADIUS
   40 CUTTER=.5D0*DABS(TAPSTO(4))
      CRADUS = TAPSTO(5)
      IF ((CRADUS-CUTTER).LE.1.D-12) GO TO 45
   41 JSUBER = 21
C...    ERROR 21 - CORNER RADIUS IS GREATER THAN THE CUTTER RADIUS.
      NURCNO = NURCNO + 1
      GOTO 990
45    CALL ASTORE(TAPSTO(6),8,IT,4)
C...    IS CUTTER ORIENTATION RIGHT(24) OR LEFT
      IF(IT-24) 50,60,50
   50 ZUN = -1.D0
      GOTO 70
   60 ZUN = 1.0D0
   70 YUN = 0.D0
      XUN = 0.D0
C...    LOOK FOR ZSMALL
      IF(NUMWDS-7)  67, 65, 65
 65   CALL ASTORE(TAPSTO(7),K8,IT,K4)
      IF(IT-40) 67,66,67
   66 IF(CRADUS)  5005,5010,5005
 5005 JSUBER = 22
C...    ERROR 22 - CORNER RADIUS MUST BE ZERO WHEN USING ZSMALL.
      NURCNO = NURCNO + 1
      GOTO 990
C...    SET IABOVE=1 FOR ZSMALL, =0 FOR NOT
 5010 IABOVE = 1
      GOTO 68
   67 IABOVE =0
   68 TLNGTH = 0.D0
      XD = 0.D0
      YD = 0.D0
      ZD = 0.D0
      IS = IBITS
      IF(MULTAX-1) 72,74,72
   72 JSUBER=19
C...    ERROR 19 - A MULTAX COMMAND WAS NOT GIVEN IN THE PROGRAM.
      NURCNO = NURCNO + 1
      GOTO 990
C...
C...
C...    SEARCH FOR PREVIOUS MOTION RECORD ON CLTAPE         ***** 2*****
   74 IL=IR
   80 IL = IL-1
      IF(IL)  140, 140, 85
 85    CALL ASERCH(CLTAPE,IL,IRETVR)
      IF(IRETVR) 100, 90,100
   90 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      NURCNO = NURCNO + 1
      GOTO 990
  100 CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,INSTR2,1,
     1TAPSTO,K0)
       CALL ASTORE(TAPSTO(1),8,I1,4)
      CALL ASTORE (TAPSTO(2),8,I2,4)
      IF(IRETVR) 120,110,110
  110 JSUBER = 35
C...    ERROR 35  - MACHINE ERROR.
      NURCNO = NURCNO + 1
      GOTO 990
C...    CHECK RECORD FOR TYPE - MOTION(5000),AUX(2000)
  120 IF(INSTR1-5000) 122,150,122
  122 IF(INSTR1-2000)130,124,130
C...    IS IT VTLAXS(1070)
  124 IF(INSTR2-1070)141,126,141
C...    CHECK FOR OFF(72)
  126 IF(I1 -72)  130,128,130
C...    PREVIOUS MOTION WAS IN VTLAXS SEQ. SET LWTLXS
  128 LWTLXS =0
C...    BACKSPACE ANOTHER RECORD ON CLTAPE
  130 IF(IL) 140,140, 80
  140 JSUBER= 18
C...    ERROR 18 - A VTLAXS COMMAND WAS GIVEN WITHOUT A
C...               PREVIOUS MOTION OR FROM COMMAND.
      NURCNO = NURCNO + 1
      GOTO 990
C...    IS IT INDEX(1039)
  141 IF(INSTR2-1039)130,142,130
  142 IF(I1-INDXNO(1))130,143,130
  143 IF(ICOPY)130,130,144
  144 IWAVEN = 1
      INDEXX = 0
      IPLOTR = 0
      ICLPRT = 1
      JSUBER = 31
C...    ERROR 31 - THE CURRENT COPY INDEX APPEARED BETWEEN A VTLAXS/ON
C...               AND THE MOTION JUST PRIOR TO THE VTLAXS/ON.
      NURCNO = NURCNO + 1
      GO TO 990
C...    MOTION RECORD FOUND. PROCESS IT
  150 I = INSTR2
      GOTO(130,130,160,180,200,200),I
C...    FROM
  160 XSTART=TAPSTO(3)+XD
      YSTART=TAPSTO(4)+YD
      ZSTART=TAPSTO(5)+ZD
      ITEST = IXOR(IS,MASK)
      IF (ITEST.NE.K0) GO TO 250
  170 IS = IRECNO
      II=3
      GOTO 250
C...    GODLTA
  180 XD = TAPSTO(3)+XD
      YD = TAPSTO(4)+YD
      ZD = TAPSTO(5)+ZD
      ITEST = IXOR(IS,MASK)
      IF (ITEST.NE.K0) GO TO 130
  190 IS = IRECNO
      II=3
      GOTO 130
C...    GOTO, CONT'D GOTO
200   ITEST = IXOR(IS,MASK)
      IF (ITEST.NE.K0) GO TO 240
C...    SAVE RECORD NO. AND COORDINATES
  230 IS = IRECNO
      II = NUMWDS - 5
240   XSTART=TAPSTO(NUMWDS-5)+XD
      YSTART=TAPSTO(NUMWDS-4)+YD
      ZSTART=TAPSTO(NUMWDS-3)+ZD
C...
C...
C...    START PROCESSING CLTAPE RECORDS FOLLOWING VTLAXS/ON ***** 3*****
C...    TO FIND TOTAL LENGTH OF CUT VECTORS AND TOTAL
C...    ANGLE CHANGE
  250 X1=XSTART
      Y1=YSTART
      Z1=ZSTART
      ICM = IS
      ICMI = II
      XLM = XSTART
      YLM = YSTART
      ZLM = ZSTART
      ILM = IS
      ILMI = II
      I=IR+1
      IX2 = IBITS
       CALL ASERCH(CLTAPE,I ,IRETVR)
      IF(IRETVR) 270,260,260
  260 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      NURCNO = NURCNO + 1
      GOTO 990
  270 CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,
     1TAPSTO,K0)
      CALL ASTORE (TAPSTO(1),8,I1,4)
      CALL ASTORE (TAPSTO(2),8,I2,4)
      IF (IRETVR) 290,282,280
  280 JSUBER = 35
C...    ERROR 35  - MACHINE ERROR.
      NURCNO = NURCNO + 1
      GOTO 990
C...  ERROR 15  END OF DATA BEFORE VTLAXS/OFF
  282 JSUBER=15
      NURCNO=NURCNO+1
      GO TO 990
  290 IF(INSTR1 -5000) 300,320,300
  300 IF(INSTR1 -2000) 270,310,270
C...    IS IT VTLAXS(1070),WCORN(1071),TRACUT(1038),COPY(1040)
  310 IF(INSTR2-1070)  315, 410, 315
  315 IF(INSTR2-1071)316,1100,316
  316 IF(INSTR2-1038)318,317,318
  317 JSUBER = 32
C...    ERROR 32 - TRACUT WAS GIVEN BETWEEN A VTLAXS/ON AND
C...               ITS CORRESPONDING VTLAXS/OFF.
      NURCNO = NURCNO + 1
      GO TO 321
  318 IF(INSTR2-1040) 270,319,270
  319 JSUBER = 33
C...    ERROR 33 - COPY WAS GIVEN BETWEEN A VTLAXS/ON AND
C...               ITS CORRESPONDING VTLAXS/OFF.
      NURCNO = NURCNO + 1
  321 IWAVEN = 1
      INDEXX = 0
      IPLOTR = 0
      ICLPRT = 1
      IE = IRECNO
      GO TO 990
C...    MOTION RECORD
  320 I = INSTR2
      GOTO(270,270,330,340,370,370),I
C...    FROM
  330 JSUBER=17
      NURCNO = NURCNO + 1
      GOTO 990
C...    GODLTA
  340 XD=TAPSTO(3)
      YD=TAPSTO(4)
      ZD=TAPSTO(5)
      JFLAG = 1
      ITEST = IXOR(IX2,MASK)
      IF (ITEST.NE.K0) GO TO 360
  350 X2=X1+XD
      Y2=Y1+YD
      Z2=Z1+ZD
      IX2=IRECNO
  360 XLM = X1
      YLM = Y1
      ZLM = Z1
      ILM = ICM
      ILMI = ICMI
      TLNGTH =TLNGTH+DSQRT(XD**2+YD**2+ZD**2)
      X1=X1+XD
      Y1=Y1+YD
      Z1=Z1+ZD
      ICMI=3
      ICM = IRECNO
      IF(IFLAG1)  365, 270, 365
  365 IFLAG1= 0
      XP3 = X1
      YP3 = Y1
      ZP3 = Z1
      IP3 = ICM
      IP3I = ICMI
      GOTO 270
C...    GOTO, CONT'D GOTO
370   JFLAG=1
      ITEST = IXOR(IX2,MASK)
      IF (ITEST.NE.K0) GO TO 390
C...    SAVE POINT JUST AFTER VTLAXS/ON
  380 X2=TAPSTO(3)
      Y2=TAPSTO(4)
      Z2=TAPSTO(5)
      IX2=IRECNO
C...    CALCULATE TOTAL LENGTH OF MOVES
  390 DO 400I=3,NUMWDS,6
      XD=TAPSTO(I)-X1
      YD=TAPSTO(I+1)-Y1
      ZD=TAPSTO(I+2)-Z1
      TLNGTH=TLNGTH+DSQRT(XD**2+YD**2+ZD**2)
      ILMI = ICMI
      XLM = X1
      YLM = Y1
      ZLM = Z1
      ILM = ICM
      X1=TAPSTO(I)
      Y1=TAPSTO(I+1)
      Z1=TAPSTO(I+2)
      ICMI = I
      ICM = IRECNO
      IF(IFLAG1)  395, 400, 395
  395 IFLAG1 = 0
      XP3 = X1
      YP3 = Y1
      ZP3 = Z1
      IP3 = ICM
      IP3I = ICMI
  400 CONTINUE
      GOTO 270
C...    IS THIS VTLAXS/OFF(72)
  410 IF(I1 -72) 420,430,420
  420 JSUBER=16
C...    ERROR 16 - TWO VTLAXS/ON COMMANDS GIVEN WITHOUT A
C...               VTLAXS/OFF BETWEEN THEM.
      NURCNO = NURCNO + 1
      GOTO 990
C...    VTLAXS/OFF. SAVE ENDING ANGLE
  430 ENDANG=TAPSTO(3)/ARADS
      IE =K1+IRECNO
C...    IS TILT RIGHT(24) OR LEFT
      IF(I2-24) 445,440,445
  440 ENDANG=-ENDANG
C...    HAS WCORN BEEN ENCOUNTERED. 0=NO
  445 IF(ICORN1)  446, 450, 446
C...    WAS THERE MOTION AFTER WCORN. 0=YES
  446 IF (IFLAG1) 456,4462,456
 4462 TLNTH2 = TLNGTH
      WTLXS6 = ENDANG
      ENDANG = WCORN5
C...    PROCESS THROUGH CORNER IN FP1P3
      CALL FP1P3
      IF(JSUBER)  447, 448, 447
  447 NURCNO = NURCNO + 1
      GOTO 990
  448 TLNGTH = TLNTH1
  450 DANG=ENDANG-STANG
      DLNGTH = 0.D0
      IF(JFLAG) 457, 455, 457
  455 JSUBER = 23
C...    ERROR 23 - NO MOTION BETWEEN A VTLAXS/ON AND VTLAXS/OFF.
      NURCNO = NURCNO + 1
      GOTO 990
  456 JSUBER = 30
C...    ERROR 30 - NO MOTION BETWEEN WCORN AND VTLAXS/OFF.
      NURCNO = NURCNO + 1
      GOTO 990
C...
C...
C...    PREPARE CLTAPE AND NUCLTP FOR POINT REVISION        ***** 4*****
C...
C...    UPDATE NUCLTP RECORD NUMBER TO MOTION JUST
C...    PRIOR TO VTLAXS/ON
  457 NURCNO = NURCNO - IR + IS + 1
C...    LOCATE CLTAPE TO MOTION RECORD JUST PRIOR TO VTLAXS/ON
       CALL ASERCH(CLTAPE,IS,IRETVR)
      IF(IRETVR) 470,460,460
  460 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      GOTO 990
C...    WRITE EOF ON NUCLTP
  470 CALL TAPEOP(NUCLTP,2,IRETVR)
      IF(IRETVR) 478,475,475
  475 JSUBER = 34
C...    ERROR 34  - MACHINE ERROR.
      GOTO 990
 478   CALL ASERCH(NUCLTP,NURCNO,IRETVR)
      IF (IRETVR) 490,475,475
C...    PUT NUCLTP IN WRITE MODE
  490 CALL BUFFTP(NUCLTP,1)
      CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,
     1TAPSTO,K0)
      CALL ASTORE(TAPSTO(1),8,I1,4)
      CALL ASTORE(TAPSTO(2),8,I2,4)
      IF(IRETVR) 510,500,500
  500 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      GOTO 990
  510 IF(INSTR1 -5000) 520,530,520
  520 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      GOTO 990
C...
C...
C...    CALCULATE VTLAXS REVISION OF POINT JUST PRIOR       ***** 5*****
C...    TO VTLAXS/ON
  530 X1=XSTART
      Y1=YSTART
      Z1=ZSTART
      TSIN=DSIN(STANG)
      TSIN1 =DABS(TSIN)
      TCOS=DCOS(STANG)
      XCV=X2-X1
      YCV=Y2-Y1
      ZCV=Z2-Z1
C...    GET CROSS PRODUCT OF FIRST CUT VECTOR AND
C...    VERTICAL TLAXIS VECTOR
      CALL AVCROS(ZCV,ZUN,ZTR)
C...    NORMALIZE IT
      CALL AVNORM(ZTR,ZTR,IER)
      IF (IER) 5012,5011,5012
 5012 JSUBER=37
C...    ERROR 37  - MACHINE ERROR.
      GO TO 990
 5011 CONTINUE
C...    SET NEW Z
      IF(CRADUS)  5020,5030,5020
 5020 Z = CRADUS*(1.0D0-TCOS) + (CUTTER-CRADUS)*TSIN1
      GOTO 5040
 5030 Z =DABS(CUTTER*TSIN)
C...    IS STARTING ANGLE .GT. 80 DEGREES
 5040 IF(TCOS - .1736D0) 535, 535, 5050
C...    DETERMINE TILT DIRECTION-SURFACE ORIENTATION COMBINATION
 5050 IF(STANG*ZUN)  532,5080,5080
C...    LEFT-LEFT OR RIGHT-RIGHT
  532 IF(CRADUS)  5070,5060,5070
 5060 IF(IABOVE)  533, 536, 533
 5070 TEST = CRADUS*(TCOS-TSIN1+(TSIN1-1.D0)/TCOS)-CUTTER*(TCOS-2.0D0/
     1TCOS+1.0D0)
      TEST = -TEST
      GOTO 539
C...    LEFT-RIGHT OR RIGHT-LEFT
 5080 IF(CRADUS)  5090, 538,5090
 5090 TEST = CRADUS*(TCOS-TSIN1+(TSIN1-1.0D0)/TCOS)+CUTTER*(1.0D0-TCOS)
      GOTO 539
C...    ZSMALL
  533 Z = -Z
      GOTO 538
  535 JSUBER = 20
C...    ERROR 20 - TILT ANGLE GREATER THAN 80 DEGREES.
      GOTO  990
C...    NOT ZSMALL
  536 TEST = -(2.0D0*CUTTER/TCOS-CUTTER-CUTTER*TCOS)
      GOTO 539
  538 TEST = CUTTER*(1.0D0-TCOS)
  539 XDO =TEST*XTR
      YDO =TEST*YTR
      ZDO =TEST*ZTR
      XCC=X1+XDO
      YCC=Y1+YDO
      ZCC=Z1+Z
      XTR=TCOS*XTR
      YTR=TCOS*YTR
      IF(ZUN) 552,554,554
  552 ZTR=TSIN
      CALL AVCROS(ZCV,ZTR,ZTA)
      GOTO 556
  554 ZTR=-TSIN
      CALL AVCROS(ZTR,ZCV,ZTA)
  556 CALL AVNORM(ZTA,ZTA,IER)
      IF(IER) 557,558,557
  557 JSUBER=37
C...    ERROR 37  - MACHINE ERROR.
      GO TO 990
  558 CONTINUE
C...  RESET FOR BEGINNING OF VTLAXIS SEQUENCE
      XXXXTA=0.D0
      YYYYTA=0.D0
      ZZZZTA=0.D0
      CHINGX=0.D0
      CHINGY=0.D0
      CHINGZ=0.D0
      I=INSTR2
      GOTO(540,540,550,590,630,630),I
  540 JSUBER = 38
C...    ERROR 38  - MACHINE ERROR.
      GOTO 990
C...    FROM
  550 IRECNO = NURCNO
      TAPSTO(3) = XCC
      TAPSTO(4) = YCC
      TAPSTO(5) = ZCC
      TAPSTO(6) = XTA
      TAPSTO(7) = YTA
      TAPSTO(8) = ZTA
C...    CHECK FOR TRACUT OR COPY
      CALL TRCPM(3)
      IF(JSUBER) 990,551,990
  551 CONTINUE
C...    WRITE ALTERED PRIOR POINT ON NUCLTP (FROM/PT)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 580,560,570
  560 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  570 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  580 CALL CLPRNT
      NURCNO=NURCNO+1
      GOTO 710
C...    GODLTA
  590 IRECNO = NURCNO
      TAPSTO(3) = TAPSTO(3)-XCC+X1
      TAPSTO(4) = TAPSTO(4)-YCC+Y1
      TAPSTO(5) = TAPSTO(5)-ZCC+Z1
      TAPSTO(6) = XTA
      TAPSTO(7) = YTA
      TAPSTO(8) = ZTA
C...    CHECK FOR TRACUT OR COPY
      CALL TRCPV(3)
      IF(JSUBER) 990,591,990
  591 CONTINUE
C...    WRITE ALTERED PRIOR POINT ON NUCLTP (GODLTA)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 620,600,610
  600 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  610 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  620 CALL CLPRNT
      NURCNO=NURCNO+1
      GOTO 710
C...    GOTO, CONTD GOTO
  630 IF(NUMWDS-8)675,675,635
C...    WAS PREVIOUS MULTI-POINT RECORD IN A VTLAXS SEQ. 0=YES
  635 IF(LWTLXS) 640,675,640
  640 NUMWDS=NUMWDS-6
       IRECNO=NURCNO
      DO 645 I=3,NUMWDS,6
C...    TRACUT-COPY CHECK
      CALL TRCPM(I)
      IF(JSUBER)990,641,990
  641 CONTINUE
  645 CONTINUE
C...    WRITE ALTERED PRIOR RECORD ON NUCLTP (GOTO)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 670,650,660
  650 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  660 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  670 CALL CLPRNT
      NURCNO=NURCNO+1
C...    SINGLE POINT OR MULTI-POINT WITH VTLAXS
 675  IRECNO = NURCNO
      TAPSTO(3) = XCC
      TAPSTO(4) = YCC
      TAPSTO(5) = ZCC
      TAPSTO(6) = XTA
      TAPSTO(7) = YTA
      TAPSTO(8) = ZTA
      NUMWDS = 8
C...    TRACUT-COPY CHECK
      CALL TRCPM(3)
      IF(JSUBER) 990,676,990
  676 CONTINUE
C...    WRITE ALTERED PRIOR POINT RECORD ON NUCLTP(GOTO)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 700,680,690
  680 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  690 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  700 CALL CLPRNT
      NURCNO=NURCNO+1
C...    COPY CLTAPE RECORDS THROUGH VTLAXS/ON
 710  CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,
     1TAPSTO,K0)
      CALL ASTORE(TAPSTO(1),8,I1,4)
      CALL ASTORE(TAPSTO(2),8,I2,4)
      IF(IRETVR) 730,720,720
  720 JSUBER = 35
C...    ERROR 35  - MACHINE ERROR.
      GOTO 990
C...    ARE WE PAST VTLAXS/ON RECORD
 730  IF(IRECNO-IR) 760,760,820
 760  IRECNO = NURCNO
C...    COPY RECORD
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 790,770,780
  770 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  780 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  790 CALL CLPRNT
      NURCNO=NURCNO+1
      GOTO 710
C...
C...
C...    PROCESS RECORDS AFTER VTLAXS/ON.                    ***** 6*****
 800  IIII = K3
      CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,
     1TAPSTO,K0)
      CALL ASTORE (TAPSTO(1),8,I1,4)
      CALL ASTORE(TAPSTO(2),8,I2,4)
      IF(IRETVR) 820,810,810
  810 JSUBER = 35
C...    ERROR 35  - MACHINE ERROR.
      GOTO 990
 820  IF(INSTR1-5000) 830,880,830
 830  IRECNO = NURCNO
C...    WRITE NON-MOTION RECORD ON NUCLTP
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 860,840,850
  840 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  850 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  860 CALL CLPRNT
      NURCNO=NURCNO+1
      IF(INSTR1-2000) 800,870,800
C...    IS IT VTLAXS(1070) OR INDEX(1039)
 870  IF(INSTR2-1070) 872,1000,872
 872  IF(INSTR2-1039) 800,873,800
C...    INDEX...TEST FOR NOMORE(53)
873   CALL ASTORE (TAPSTO(2),8,IT,4)
      IF(IT-53)800,874,800
  874 IF(ICOPY)800,800,875
  875 IF(I1 -INDXNO(1))800,876,800
 876   CALL ASERCH(CLTAPE,IRECNI,IRETVR)
      GO TO 1000
C...
C...    PROCESS A MOTION RECORD
  880 I=INSTR2
      GOTO(830,830,890,900,940,940),I
C...    FROM
  890 JSUBER= 17
C...    ERROR 17 - A FROM COMMAND WAS GIVEN BETWEEN A VTLAXS/ON
C...               COMMAND AND ITS CORRESPONDING VTLAXS/OFF COMMAND.
      GOTO 990
C...    GODLTA
  900 X2=X1+TAPSTO(3)
      Y2=Y1+TAPSTO(4)
      Z2=Z1+TAPSTO(5)
C...    CALCULATE NEW CUTTER LOCATION AND TLAXIS (GODLTA)
      CALL COMPU
      IF(JSUBER)   990, 902, 990
 902  IF(IRECNO) 903,800,905
 903  IRECNO = K1
      GOTO 940
 905  IRECNO = NURCNO
      TAPSTO(3) = TAPSTO(3)-XCC+X1
      TAPSTO(4) = TAPSTO(4)-YCC+Y1
      TAPSTO(5) = TAPSTO(5)-ZCC+Z1
      TAPSTO(6) = XTA
      TAPSTO(7) = YTA
      TAPSTO(8) = ZTA
C...    TRACUT-COPY CHECK
      CALL TRCPV(3)
      IF(JSUBER) 990,906,990
  906 CONTINUE
C...    WRITE REVISED POINT ON NUCLTP (GODLTA)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 930,910,920
  910 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  920 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  930 CALL CLPRNT
      NURCNO=NURCNO+1
      X1=X2
      Y1=Y2
      Z1=Z2
      GOTO 800
C...    GOTO, CONTD GOTO
  940 INUM=NUMWDS
      NUMWDS=8
      DO 980 I=IIII,INUM,6
      X2=TAPSTO(I)
      Y2=TAPSTO(I+1)
      Z2=TAPSTO(I+2)
C...    CALCULATE NEW CUTTER LOCATION AND TLAXIS (GOTO)
      CALL COMPU
      IF(JSUBER)  990, 942, 990
 942  IF(IRECNO) 943,800,945
 943  IRECNO = K1
      GOTO 940
 945  IRECNO = NURCNO
      TAPSTO(3) = XCC
      TAPSTO(4) = YCC
      TAPSTO(5) = ZCC
      TAPSTO(6) = XTA
      TAPSTO(7) = YTA
      TAPSTO(8) = ZTA
C...    TRACUT-COPY CHECK
      CALL TRCPM(3)
      IF(JSUBER) 990,946,990
  946 CONTINUE
C...    WRITE REVISED POINT ON NUCLTP (GOTO)
      CALL TAPEWT(NUCLTP,IRETVR,K4,IRECNO,K1,INSTR1,K1,INSTR2,K1,TAPSTO,
     1NUMWDS)
      IF(IRETVR) 970,950,960
  950 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  960 JSUBER = 36
C...    ERROR 36  - MACHINE ERROR.
      GOTO 990
  970 CALL CLPRNT
      NURCNO=NURCNO+1
      X1=X2
      Y1=Y2
      Z1=Z2
  980 CONTINUE
      GOTO 800
C...
C...
C...    ERROR OUTPUT AND NORMAL RETURN                      ***** 7*****
C...    LOCATE CLTAPE AT VTLAXS/ON+1,TRACUT,OR COPY
 990   CALL ASERCH(CLTAPE,IE,IRETVR)
       WRITE(IOUTAP,91)JSUBER
  91   FORMAT(49H0*****************  SECTION 3 5AXIS ERROR NUMBER ,I5,21
     1H  *******************)
      GO TO 1002
 1000 IVTLON = 0
 1002 NURCNO = NURCNO-1
      RETURN
C...
C...
C...    WCORN                                               ***** 8*****
 1100 IF(ICORN1)  1105, 1110, 1105
 1105 JSUBER = 24
C...    ERROR 24 - THERE IS MORE THAN ONE WCORN BETWEEN A
C...               VTLAXS/ON AND ITS VTLAXS/OFF.
      NURCNO = NURCNO + 1
      GOTO 990
C...    WAS THERE MOTION BETWEEN VTLAXS/ON AND WCORN. 0=NO
 1110 IF (JFLAG) 1113,1112,1113
 1112 JSUBER = 29
C...    ERROR 29 - NO MOTION BETWEEN VTLAXS/ON AND WCORN.
      NURCNO = NURCNO + 1
      GOTO 990
C...    PROCESS WCORN RECORD
 1113 IFLAG1= 1
      XP1 = XLM
      YP1 = YLM
      ZP1 = ZLM
      IP1 = ILM
      IP1I = ILMI
      TLNTH1 = TLNGTH
      TLNGTH = 0.0D0
      XP2 = X1
      YP2 = Y1
      ZP2 = Z1
      IP2 = ICM
      IP2I = ICMI
      ICORN1 = IRECNO
      WCORN8 = TAPSTO(5)
      WCORN5 = TAPSTO(2)/ARADS
      IF(I1-24) 1120,1115,1120
 1115 WCORN5 = -WCORN5
 1120 WCORN7 = DABS(TAPSTO(4))/ARADS
      CALL ASTORE(TAPSTO(3),8,IT,4)
      IF(IT-24)  1140, 1130, 1140
 1130 WCORN7 = -WCORN7
C...   CHECK IF ZSMALL WAS SPECIFIED ON VTLAXS/ON STATEMENT
 1140 IF (IABOVE.NE.1) GO TO 1141
C...   CHECK FOR WCORN/LEFT,,LEFT OR WCORN/RIGHT,,RIGHT
      IF (TAPSTO(1).EQ.TAPSTO(3)) GO TO 1141
C...   CHECK IF WCORN INITAL TILT ANGLE IS ZERO
      IF (TAPSTO(2).EQ.0.D0 .AND. WCORN7*ZUN.GE.0.D0) GO TO 1141
C...   CHECK IF WCORN TERMINAL TILT ANGLE IS ZERO
      IF (TAPSTO(4).EQ.0.D0 .AND. WCORN5*ZUN.GE.0.D0) GO TO 1141
C...   WCORN ERROR - ZSMALL EFFECT NOT SAME WHEN ENTERING AND
C...                 EXITING FROM CORNER
      JSUBER = 41
      NURCNO = NURCNO+1
      GO TO 990
 1141 IF (NUMWDS.GT.5) GO TO 1160
 1150 WCORN9 = 6.0D0
      GOTO 270
1160  WCORN9 = IDINT(DABS(TAPSTO(6)))
      IF(WCORN9 .LT. 3.0D0) WCORN9=3.0D0
       GO TO 270
      END
