       SUBROUTINE TYPE5 (KKK)
C  *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 0 ***
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
C...********************************************************************
C***********************************************************************
       DOUBLE PRECISION VUN

C... THIS SECTION WILL PROCESS THE POINTS RECORDS
C... IT WILL TRANSFORM THE POINTS IF A TRACUT OR COPY IS IN EFFECT
C... IT WILL ALSO PLOT THE TOOL PATH IF THE PLOTTING ROUTINES ARE IN
C... THE SYSTEM AND IF REQUESTED IT WILL PLOT THE TOOL AXIS VECTOR  FOR
C... A 5 AXIS PART PROGRAM
C... IS IT AN INDIRV OR INDIRP - IF SO IGNORE IT AND READ ANOTHER RECORD
  400  IF(INSTR2-K2)150,150,402
C... IS IT A GODLTA - IF SO CHECK FOR TRACUT OR COPY IF NOT GO TO POINTS
  402  IF(INSTR2-K4)430,404,430
C... IS TRACUT IN EFFECTIF SO TRANSFORM GODLTA  IF NOT CHECK FOR A COPY
  404        IF (ITRAFL-K1)                        406 ,  408 ,  406
C... IS A COPY IN EFFECT - IF SO TRANSFORM GODLTA VECTOR
  406        IF (ICOPY)                           1550 ,  410 ,  408
C... TRANSFORM GODLTA
  408  CALL TSFMVC (TMATRX,TAPSTO(K3),TAPSTO(K3))
C... HAS THE SECTN0 PLOT FLAG BEEN SET - IF NOT GO PRINT THIS RECORD
  410        IF (IPLOTR)                           150 ,  150 , 412
C... LET THE THE PLOT SUBROUTINES KNOW THERE IS A GO DLTA/ IN EFFECT
  412          IGODLT=K1
               JARROW=K1
C... PLOT THE GO DLTA VECTOR
               CALL PL3AXS (TAPSTO(K3))
C... IS 5 AXIS PLOTTING IN EFFECT - IF NOT CHECK FOR AN ARROW
             IF (IPL5AX)                          416  ,  416 , 414
C... SET SWITCH FOR NO ARROW BECAUSE TOOL AXIS IS BEING PLOTTED
  414          JARROW = K0
C... PLOT THE TOOL AXIS VECTOR
       CALL PL5AXS (TAPSTO(K3))
C... CHECK PLOT FLAGS TO SEE IF AN ARROW SHOULD BE PLOTED - IF NOT READ
  416        IF (IPLOTR)                          150  ,  150 , 418
C... IS A PLOT/ COMMAND IN EFFECT - IF NOT GO PRINT THIS RECORD
  418        IF (IDPLOT)                           150 ,  150 ,  420
C... IS AN ARROW WANTED
  420        IF (IARROW)                           150 ,  150 ,  422
C... HAS LINE GONE OFF  THE FRAME
  422        IF (ITRUNC)                           424 ,  424 ,  150
C... NO - PLOT AN ARROW
  424          JARROW= K1
               CALL ARROW
       GO TO   150
C... RECORD IS A GO TO POINT - CHECK FOR THREE OR FIVE AXIS
  430        IF (MULTAX)   432 ,  432 ,  450
C... IT IS 3 AXIS - CHECK FOR TRACUT
  432  DO 442 I=K3,NUMWDS,K3
       LL=I
             IF (ITRAFL)                           434 ,  434 ,  436
C... CHECK FOR COPY
  434        IF (ICOPY)                           1550 ,  438 ,  436
C... COPY OR TRACUT IS IN EFFECT THEN TRANSFORM THE POINTS
  436          CALL TSFMPT (TMATRX,TAPSTO(I),TAPSTO(I))
C... CHECK IF SECTN0 PLOT FLAG IS ON - IF IT IS THEN PLOT THE LINE
  438        IF (IPLOTR)                           442 ,  442 ,  439
C... SET THE ARROW SWITCH IN CASE LINE IS TRUNCATED AND PLOT THE LINE
C... IS AN ARROW WANTED
  439        IF (IARROW)                           441 ,  441 ,  440
C... YES - SET THE FLAG
  440          JARROW = K1
C... PLOT THE LINE SEGMENT
  441          CALL PL3AXS (TAPSTO(I))
  442  CONTINUE
C... CHECK FOR ARROW ON LAST POINT OF POINTS RECORD
       GO TO   480
C... POINTS ARE 5AXIS - PROCESS AND CHECK FOR COPY,TRACUT AND PLOT
  450  DO 460 I=K3,NUMWDS,K6
       LL=I
C... CHECK FOR A TRACUT - IF SO TRANSFORM POINTS AND TOOL AXIS VECTORS
             IF (ITRAFL)                           452 ,  452 ,  454
C... CHECK FOR COPY - IF SO TRANSFORM POINTS AND TOOL AXIS VECTORS
  452        IF (ICOPY)                           1550 ,  456 ,  454
C... COPY OR TRACUT IS IN EFFECT - TRANSFORM POINTS AND TOOL AXIS VECTOR
  454          CALL TSFMPT (TMATRX,TAPSTO(I),TAPSTO(I))
       CALL TSFMVC (TMATRX,TAPSTO(I+ 3),TAPSTO(I+ 3))
C... NORMALIZE  THE     TRANSFORMED VECTOR
       VUN=DSQRT(TAPSTO(I+ 3)*TAPSTO(I+ 3)+TAPSTO(I+ 4)*TAPSTO(I+ 4)+
     1 TAPSTO(I+ 5)*TAPSTO(I+ 5))
       TAPSTO(I+ 3)=TAPSTO(I+ 3)/VUN
       TAPSTO(I+ 4)=TAPSTO(I+ 4)/VUN
       TAPSTO(I+ 5)=TAPSTO(I+ 5)/VUN
C... IS THE SECTN0 PLOT FLAG SET - IF SO PLOT THE TOOL PATH
  456        IF (IPLOTR)                           460 ,  460 , 4561
C...  IS AN ARROWHEAD   WANTED
 4561        IF (IARROW)                          4571 , 4571 ,  457
C...  SET LOWER LEVEL   ARROW FLAG
  457          JARROW = K1
C...  PLOT TOOL END PATH
 4571          CALL PL3AXS (TAPSTO(I))
C... IS THE 5 AXIS PLOT IN EFFECT - IF SO PLOT THE TOOL AXIS VECTOR
             IF (IPL5AX)                           460 ,  460 ,  458
C... SET THE ARROW FLAG TO NOT PUT AN ARROW ON THE AXIS VECTOR
  458          JARROW = K0
C...  PLOT THE TOOL AXISVECTOR
               CALL PL5AXS (TAPSTO(I))
  460  CONTINUE
C... PUT AN ARROW ON THE LAST POINT OF RECORD OF POINTS IF PLOT IS ON
  480        IF (IPLOTR)                           150 ,  150 ,  482
C... IS A PLOT IN EFFECT - IF SO CHECK IF FIRST POINT-IF NOT GO PRINT
  482        IF (IDPLOT)                           150 ,  150 ,  484
C... DO NOT PUT AN ARROW ON THE FIRST POINT IN APLOT SEQUENCE.
  484        IF (IFIRST-K2)                        486 ,  490 ,  486
C... NOT FIRST POINT WITHIN A PLOT-SO CHECK IF ARROW IS REQUIRED
  486        IF (IARROW-K1)                        491 ,  488 ,  491
C... HAS ARROW BEEN PUT ON BY TRUNC
  488        IF (ITRUNC-K1)                        489 ,  491 ,  489
C... SET ARROW FLAG AND PLOT
  489          JARROW = K1
C...  PLOT THE ARROWHEAD
               CALL ARROW
       GO TO   491
C... TURN OFF FIRST POINT FLAG
  490          IFIRST = K0
C... IS 5AXIS PLOT ON - IF SO BE SURE VECTOR IS PUT ON LAST POINT
  491        IF(IPL5AX)                            150 ,  150 ,  492
C... SET FLAGS FOR A TOOL AXIS VECTOR BUT NO ARROW ON THE VECTOR
  492          JVECTR = K1
               JARROW = K0
C...  PLOT THE TOOL AXISVECTOR
               CALL PL5AXS (TAPSTO(LL))
  150  KKK=K1
       GO TO 9999
 1550  KKK=K2
 9999  RETURN
       END

