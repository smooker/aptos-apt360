      SUBROUTINE ALINE(N)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
C
C...  THIS ROUTINE CONTAINS LINE DEFINITIONS
C
      IMPLICIT REAL*8(A-H,O-Z)
       DIMENSION DEFANS(82)
       COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1 LOOP,IFINI
      COMMON/AVST/VST(7200)
      DIMENSION DEFTAB(1000)
       DIMENSION IDFTAB(2000)
      EQUIVALENCE(VST(7200),DEFTAB(1000))
       EQUIVALENCE (DEFTAB(1),IDFTAB(1))
      COMMON/ADFSTO/DEFSTO(85),PARTNO(11)
      EQUIVALENCE(DEFSTO(4),DEFANS(1))
      COMMON/ADFPRG/DEFPRG(16)
      DIMENSION TVEC(3),SVEC(3),XYNOR(3),C3(3),
     1TNOR(3),PUVEC(3),V(3),V1(3),PUNOR(3),AMBDA(3),ANS(3),
     2SVECN(3),XO(3),XLAR(3),XSML(3),YLAR(3),YSML(3)
      EQUIVALENCE(DEFPRG(16),TVEC(16),SVEC(16),XYNOR(16),C3(16),
     1TNOR(13),PUVEC(13),V(13),V1(13),PUNOR(10),AMBDA(10),ANS(10),
     2SVECN(7),XO(7),XLAR(4),XSML(4),YLAR(4),YSML(4))
C***********************************************************************
      SIN(Q) = DSIN(Q)
      COS(Q) = DCOS(Q)
      SQRT(Q) = DSQRT(Q)
      ABS(Q) = DABS(Q)
       GO TO (100,200,310,405,510,1120,705,810,900,1050,1160,101,
     1  3000,2000,1000,1090),N
C
C...  DEFPRE ROUTINE FOR FOLLOWING FORMAT
C...  L=LINE/XCOORD,YCOORD,ZCOORD,XCOORD,YCOORD,ZCOORD
C...  THIS ROUTINE IS LIMITED TO 7 PIECES OF DATA
C
  100 XYNOR(1)=0.0
      XYNOR(2)=0.0
      XYNOR(3)=1.0
      DO 110 J=1,3
      V1(J)=DEFTAB(J+1)-DEFTAB(J+4)
  110 CONTINUE
      CALL AGENPL(XYNOR,V1,DEFTAB(2))
       GO TO 3000
C
C...     LINE/X1,Y1,X2,Y2
C
  200 DEFTAB(6)= DEFTAB(5)
      DEFTAB(5)= DEFTAB(4)
      DEFTAB(4)= 0.0
      DEFTAB(7)= 0.0
      GO TO 100
C
C...     LINE/PT1,PT2
C
  310 DEFTAB(2)= DEFTAB(3)
      DEFTAB(3)= DEFTAB(4)
      DEFTAB(4)= DEFTAB(5)
      DEFTAB(5)= DEFTAB(7)
      DEFTAB(6)= DEFTAB(8)
      DEFTAB(7)= DEFTAB(9)
      GO TO 100
C
C...     LINE/PT1,RIGHT OR LEFT,TANTO,CIR1
C
C...  SET UP DATA REGION FOR COMPLIANCE WITH LINE05 ROUTINE
C
  405 DEFTAB(21)= DEFTAB(15)
      DEFTAB(20)= DEFTAB(14)
      DEFTAB(19)= DEFTAB(13)
      DEFTAB(18)= DEFTAB(12)
      DEFTAB(17)= DEFTAB(11)
      DEFTAB(16)= DEFTAB(10)
      DEFTAB(15)= DEFTAB(9)
      DEFTAB(12)=DEFTAB(6)
      DEFTAB(11)= DEFTAB(19)
      DEFTAB(10)= DEFTAB(20)
      DEFTAB(9) = DEFTAB(19)
      DEFTAB(8) = DEFTAB(19)
      DEFTAB(7) = DEFTAB(5)
      DEFTAB(6) = DEFTAB(4)
      DEFTAB(5) = DEFTAB(3)
      DEFTAB(2)=DEFTAB(12)
C
C...     LINE/RIGHT OR LEFT,TANTO,CIR1,RIGHT OR LEFT,TANTO,CIR2
C
  510       IF(IDFTAB(4)-8)  593, 515, 525
  515       IF(IDFTAB(24)-8)  593, 540, 520
  520       IF(IDFTAB(24)-24)  593, 545, 593
  525       IF(IDFTAB(4)-24)  593, 530, 593
  530       IF(IDFTAB(24)-24)  535, 540, 593
  535       IF(IDFTAB(24)-8)  593, 545, 593
  540 ASSIGN 556 TO K
      GO TO 550
  545 ASSIGN 557 TO K
  550 DO 555 J=1,2
      C3(J)=DEFTAB(J+14)-DEFTAB(J+4)
  555 CONTINUE
      C3(3)=0.0
      CALL ALNGTH(C3,C3LEN)
      IF(C3LEN) 595,595,5552
 5552 TESTA=C3LEN**2-(DEFTAB(11)-DEFTAB(21))**2
      IF(TESTA) 5553,5554,5554
 5553 IF(ABS(TESTA)-.00001) 5554,5554,595
 5554 IF(C3LEN-(DEFTAB(11)+DEFTAB(21))) 5555,5556,5556
 5555       IF(IDFTAB(4)-IDFTAB(24))  595, 5556, 595
 5556 SINALP=(DEFTAB(16)-DEFTAB(6))/C3LEN
      COSALP=(DEFTAB(15)-DEFTAB(5))/C3LEN
      GO TO K, (556,557)
  556 DEFTAB(11)=-DEFTAB(11)
  557 SINGAM=(DEFTAB(11)+DEFTAB(21))/C3LEN
      IF(SINGAM**2 .LT. 1.0) GO TO 558
      COSGAM = 0.
      GO TO 570
 558  COSGAM = SQRT( 1.0 - (SINGAM**2) )
            IF(IDFTAB(24)-8)  593, 570, 560
  560 COSGAM=-COSGAM
  570 DEFANS(1)= SINGAM*COSALP+COSGAM*SINALP
      DEFANS(2)= SINALP*SINGAM-COSGAM*COSALP
C...  DEFANS(3)= 0.0
      CALL ANORM(DEFANS,DEFANS)
      DEFANS(4)= DEFANS(1)*DEFTAB(15)+DEFANS(2)*DEFTAB(16)
     1           -DEFTAB(21)
       GO TO 3000
C
  593  JSUBER = 1003
       GO TO 3000
  595  JSUBER = 1005
       GO TO 3000
C
C...     LINE/INTOF,PLN1,PLN2
C
  101  XNUM = DEFTAB(4)*DEFTAB(11) - DEFTAB(9)*DEFTAB(6)
       YNUM = DEFTAB(5)*DEFTAB(11) - DEFTAB(10)*DEFTAB(6)
       CNUM = DEFTAB(7)*DEFTAB(11) - DEFTAB(12)*DEFTAB(6)
       DENOM = SQRT(XNUM**2+YNUM**2)
            IF(DENOM)  102, 595, 102
  102  DEFANS(1) = XNUM/DENOM
       DEFANS(2) = YNUM/DENOM
C...     DEFANS(3) = 0.0
       DEFANS(4) = CNUM/DENOM
       GO TO 3000
C
C...     LINE/PT1,PARLEL,LN1
C
  705  CALL APLAN(3)
       GO TO 3000
C
C...     LINE/PT1,PERPTO,LN1
C
  810 DEFANS(1)=-DEFTAB(9)
      DEFANS(2)= DEFTAB(8)
C...  DEFANS(3)= 0.0
      CALL ADOT(DEFTAB(3),DEFANS,DEFANS(4))
       GO TO 3000
C
C...     LINE/PARLEL,LN1,X- OR YLARGE OR SMALL,D
C
 900  IF(IDFTAB(16) .GT. 36) GO TO 593
      CALL APLAN(4)
       GO TO 3000
C
C...     LINE/ATANGL OR SLOPE,A,INTERC,X- OR YAXIS,B
C
C     TEST FOR YAXIS CODE
 1000       IF(IDFTAB(10).EQ.85) GO TO 1040
C     TEST FOR XAXIS CODE
            IF(IDFTAB(10).NE.84) GO TO 593
C
C     SET UP X AND Y COORDINATES
 1030  X = DEFTAB(6)
       Y = 0.0
      GOTO 1070
C
C     SET UP Y COORDINATE
 1040  Y = DEFTAB(6)
      GO TO 1060
C
C...     LINE/ATANGL OR SLOPE,A,INTERC,B
C
C     SET UP Y COORDINATE
 1050  Y = DEFTAB(5)
C     SET UP X COORDINATE
 1060  X = 0.0
C     SET UP POINT ANGLE FORMAT
 1070  DEFTAB(6) = DEFTAB(2)
       DEFTAB(7) = DEFTAB(3)
       DEFTAB(3) = X
       DEFTAB(4) = Y
       DEFTAB(5) = 0.0
      GOTO 1120
C
C...     LINE/PT1,ATANGL OR SLOPE,A,X- OR YAXIS
C
C     TEST FOR XAXIS CODE
 1090       IF(IDFTAB(16).EQ.84) GO TO 1120
C     TEST FOR YAXIS CODE
            IF(IDFTAB(16).NE.85) GO TO 593
C
C     SET UP YAXIS AS A LINE
 1110  DEFTAB(9) = 1.0
       DEFTAB(10) = 0.0
      GOTO 1130
C
C...     LINE/PT1,ATANGL OR SLOPE,A
C
C     SET UP XAXIS AS A LINE
 1120  DEFTAB(9) = 0.0
       DEFTAB(10) = 1.0
C
C     SET UP DATA FOR LINE
 1130  DEFTAB(11) = 0.0
       DEFTAB(12) = 0.0
C
C...     LINE/PT1,ATANGL OR SLOPE,A,LN1
C
C     TEST FOR SLOPE CODE
 1160       IF(IDFTAB(12).EQ.47) GO TO 1190
C     TEST FOR ATANGL CODE
            IF(IDFTAB(12).NE.1) GO TO 593
C
C     COMPUTE SINE AND COSINE OF ANGLE
 1180 DEFTAB(7) = DEFTAB(7)/57.29577951289617
       STHETA = SIN (DEFTAB(7))
       CTHETA = COS (DEFTAB(7))
      GOTO 1200
C
C     COMPUTE SINE AND COSINE OF ANGLE
 1190  STHETA = DEFTAB(7)
       CTHETA = 1.0
C
C     COMPUTE VECTOR NORMAL TO DESIRED LINE
 1200  DEFANS(1) = DEFTAB(9)*CTHETA - DEFTAB(10)*STHETA
       DEFANS(2) = DEFTAB(10)*CTHETA + DEFTAB(9)*STHETA
C
C     NORMALIZE VECTOR
 1210  CALL ANORM(DEFANS(1),DEFANS(1))
            IF(JSUBER.NE.0) GO TO 3000
C     CALCULATE DISTANCE FROM ORIGIN TO LINE
 1220  CALL ADOT(DEFANS(1),DEFTAB(3),DEFANS(4))
       GO TO 3000
C
C...     LINE/XAXIS OR YAXIS
C
C     TEST FOR XAXIS CODE
 2000       IF(IDFTAB(4).EQ.84) GO TO 2030
C     TEST FOR YAXIS CODE
            IF(IDFTAB(4).NE.85) GO TO 593
C
C     SET YAXIS AS A LINE
 2020  DEFANS(1) = 1.0
       GO TO 3000
C
C     SET UP XAXIS AS A LINE
 2030 DEFANS(2)=1.0
 3000  RETURN
       END

