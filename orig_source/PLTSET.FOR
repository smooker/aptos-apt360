       SUBROUTINE PLTSET
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 1 ***
C***********************************************************************
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
C...********************************************************************
C***********************************************************************
      DATA Q003HL/6H      /
      DATA Q004HL/6H* X * /
      DATA Q005HL/6H* Z * /
      DATA Q006HL/6H*  Y */
C...
C... THIS SECTION DETERMINES THE PLOT PARAMETERS AND SETS UP THE VIEW
C... REQUESTED.IT ALSO CHECKS THE PLOT COMMAND TO SEE IF ARROWS, TOOL
C... AXIS VECTORS OR PERSPECTIVE VIEWS HAVE BEEN REQUESTED.
C... IF ARROW WANTED SET IARROW TO 1- NORMAL CASE 1S IARROW = 1
C... IF TOOL AXIS VECTORS WANTED SET IPL5AX T0 1- NORMAL CASE IPL5AX=0
C... IF PERSPECTIVE WANTED SET IPERSP=1***THIS FEATURE IS NOT NOW
C... PROVIDED BUT THE HIGH LEVEL LOGIC IS PROVIDED
C...
C... IS SECTN0 PLOT FLAG SET - IF NOT THEN PRINT THE RECORD
 1600        IF (IPLOTR)                           150 ,  150 , 1602
C... IF IDPLOT IS 2 THEN A NESTED PLOT HAS BEEN READ-DO NOT PROCESS YET
 1602        IF (IDPLOT-K2)                       1604 ,  150 , 1604
C... IF IDPLOT IS LESS THAN 1 THEN PROCESS THE PLOT INSTRUCTIN.
C... IF IDPLOT IS EQUAL TO 1 THEN SAVE THE INDEX AND RECORD NUMBERS.
 1604        IF (IDPLOT-K1)                       1606 , 1700 , 1700
C... IDPLOT IS 0 SO SET FLAGS
C... SET IDPLOT TO 1 BECAUSE A PLOT OR OVPLOT HAS JUST BEEN READ.
 1606          IDPLOT = K1
C... SET FLAG TO INDICATE FIRST POINT WITHIN PLOT AREA.
               IFIRST = K1
C... SET THE LOW LEVEL PLOT FLAG TO ALLOW THE SUBROUTINE PLOT TO WORK.
               IPLOTI = K1
C... SAVE THE INDEX NUMBER FOR CHECKING IN THE INDEX SECTION.
C... IT IS USED TO TURN PRINTING ON AND OFF WHEN NESTED PLOTS ARE USED.
      PLTALL = TAPSTO(K1)
       IF(I1-51)1605,1607,1605
 1607 PLTALL = -1.0D+0
 1605 IPLOTX = PLTALL
C... IF IT IS AN OVPLOT THEN SKIP THE SETUP PROCEDURE. 1042 IS OVPLOT.
 1609  IF(INSTR2-1042)1608,150,1608
C... THE INSTRUCTION IS A PLOT - SET UP FRAME AND VIEW PARAMETERS.
 1608  PT0(K1)=TAPSTO(K3)
       PT0(K2)=TAPSTO(K4)
       PT0(K3)=TAPSTO(K5)
       PTU(K1)=TAPSTO(K6)
       PTU(K2)=TAPSTO(K7)
       PTU(K3)=TAPSTO(K8)
C... CHECK WHAT PLANE VIEW HAS BEEN REQUESTED.
C... IS IT XYPLAN.- IF IT IS GO SET IT UP.- IF NOT CHECK FOR YZPLAN.
       IF(I2-33)1730,1660,1610
C... IS IT YZPLAN - IF SO SET IT UP - IF NOT CHECK FOR ZXPLAN.
 1610  IF(I2-37)1611,1650,1611
C... IS IT ZXPLAN - IF SO SET IT UP - IF NOT CHECK FOR PERSPECTIVE.
 1611  IF(I2-41)1730,1640,1612
C... THE NEXT INSTRUCTION SHOULD TEST TAPSTO(2)  FOR THE MODIFIER PERSPC
 1612  GO TO   1614
C... SET IPERSP EQUAL TO 0 BECAUSE IT IS NOT OPERATIVE-SHOULD BE SET TO
C... ONE WHEN PERSPECTIVE IS CODED.
 1614          IPERSP = K0
C... CHECK THE FRAME PARAMETERS - IF DIFFERENCES ARE ZERO THEN ERROR
       IF(TAPSTO(K6)-TAPSTO(K3))1720,1720,1616
 1616  IF(TAPSTO(K7)-TAPSTO(K4))1720,1720,1618
 1618  IF(TAPSTO(K8)-TAPSTO(K5))1720,1720,1620
C... INITIALIZE FOR AN  XYPLAN VIEW
 1620          IPX = K1
               IPX = K2
               AN1 = (+Q003HL)
               AN2 = (+Q003HL)
       GO TO   1670
C... SET UP THE PARAMETERS FOR THE ZX PLANE VIEW-FIRST CHECK FRAME SIZE
 1640  IF(TAPSTO(K6)-TAPSTO(K3))1720,1720,1642
 1642  IF(TAPSTO(K8)-TAPSTO(K5))1720,1720,1644
C... IPX AND IPY ARE SUBSCRIPTS USED TO PICK TWO OF THE 3 COORDINATES
 1644          IPX = K1
               IPY = K3
C... THE FOLLOWING STATEMENTS ARE USED TO LABEL THE PLOT FRAME.
               AN1 = (+Q004HL)
               AN2 = (+Q005HL)
C... GO CHECK FOR 5AXIS AND ARROWS
       GO TO   1670
C... CHECK THE FRAME SIZE - IF 0 OR MINUS CONSIDER AN ERROR.
 1650  IF(TAPSTO(K7)-TAPSTO(K4))1720,1720,1652
 1652  IF(TAPSTO(K8)-TAPSTO(K5))1720,1720,1654
C... SET UP SUBSCRIPTS AND LABELS FOR THE YZ PLANE VIEW.
 1654          IPX = K2
               IPY = K3
               AN1 = (+Q006HL)
               AN2 = (+Q005HL)
C... GO CHECK FOR 5AXIS AND ARROWS.
       GO TO   1670
C... CHECK THE FRAME FOR XY - IF 0 MINUS CONSIDER AN ERROR.
 1660  IF(TAPSTO(K6)-TAPSTO(K3))1720,1720,1662
 1662  IF(TAPSTO(K7)-TAPSTO(K4))1720,1720,1664
C... SET UP SUBSCRIPTS AND LABELS FOR THE XY PLANE VIEW.
 1664          IPX = K1
               IPY = K2
               AN1 = (+Q004HL)
               AN2 = (+Q006HL)
C... IF THE NUMBER OF WORDS IN THE RECORD IS EQUAL TO OR GREATER THAN.
C... 12 THEN CHECK FOR 5 AXIS AND/OR ARROW.
C... IS 5AXIS AND/OR    ARROW REQUESTED
 1670  IF(NUMWDS-K9)1688,1676,1672
C... NUMWDS IS GREATER THAN 12 SO CHECK FOR ARROW - 0 = NO ARROW.
 1672  IF(TAPSTO(K10))1676,1674,1676
C... SET ARROW FLAG FOR NO ARROW.
 1674          IARROW = K0
       GO TO   1678
C... SET ARROW FLAG FOR ARROW - TESTED IN THE ARROW SUBROUTINE.
 1676          IARROW = K1
C... CHECK FOR 5AXIS PLOT.
 1678  IF(TAPSTO(K9))1680,1690,1680
C... CHECK IF NORMAL 5AXIS OR IF WE SHOULD CHANGE THE NUMBER OF VECTORS.
C... PER POINTS RECORD - NORMAL IS 10.
 1680  IF(TAPSTO(K9)-5.0)1684,1682,1684
C... SET COUNT FOR THE ITH POINT IN EACH RECORD.
 1682          ITHPNT = K9
       GO TO   1686
 1684  ITHPNT=TAPSTO(K9)
C... SET 5AXIS PLOT FLAG.
 1686          IPL5AX = K1
       GO TO   1692
C...    ARROW WANTED BUT NO 5 AXIS PLOT.
 1688          IARROW = K1
 1690          IPL5AX = K0
C... GO SET UP THE PARAMETERS FOR THE LOWER LEVEL ROUTINES.
 1692          CALL SETUPP
      IF(IPLOTI)                                  1694,150,1694
C... LABEL THE PLOT FRAME WITH THE VIEW LABELS.
 1694  CALL PRINTV (K6,AN1,100,K10)
       CALL PRINTV (K6,AN2,K10,100)
C... PARAMETERS ARE ALL SET FOR PLOTTING - GO PRINT THE RECORD.
       GO TO   150
C... A NESTED PLOT HAS BEEN FOUND -SET IDPLOT AND SAVE THE RECORD NUMBER
 1700          IDPLOT = K2
       IDPLSQ=IRECNO
C... RETURN TO PRINT THIS RECORD.
       GO TO   150
C... ERROR COMMENT AREA
 1720  WRITE (IOUTAP,1749)SEQNO(K1)
C... SET IPLOTI SO THIS FRAME WILL NOT BE PLOTTED.
 1725          IPLOTI = K0
C... GO PRINT THIS RECORD.
       GO TO   150
 1730  WRITE (IOUTAP,1748)SEQNO(K1)
       GO TO   1725
 1748 FORMAT(1H-15X,69H****** INCORRECT OR NO VIEW GIVEN IN A PLOT INSTR
     1UCTION ----CARD NO. 2A4,     4X,8H$$$$$$$$)
 1749 FORMAT(98H-LOWER CORNER OF PLOT FRAME IS ALGEBRAICLY LARGER THAN U
     1PPER CORNER. THIS FRAME DELETED. CARD NO. 2A4)
  150  RETURN
       END

