       SUBROUTINE ASEC2C (ISTX1,ISTX2)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 2 ***
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*4  AB
      COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
      COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,
     1TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
      COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
C... A2CMMN START
      COMMON/A2CMMN/ SP(3) ,SN(3)     ,TP(3)     ,TN(3)     ,SNK(3)    ,
     1SNL(3)    ,SPK(3)    ,SPL(3)    ,TNK(3)    ,TNL(3)    ,TPK(3)    ,
     2TPL(3)    ,PLNV(3)   ,CC(3)     ,U1(3)     ,CUTH(3)   ,SFVCT(3)  ,
     3VNDIR(3)  ,VMD(3)    ,VT(3)     ,TEE(3)    ,SLX(3)    ,DPLAN(3)  ,
     4S(1)      ,RC(1)     ,PLND(1)   ,TH(1)     ,CSD(1)    ,Z(1)      ,
     5EPS1(1)   ,EPS2(1)   ,EPS3(1)   ,EPS4(1)   ,EPS6(1)   ,EPS8(1)   ,
     6TAU(1)    ,TAU1(1)   ,TAU2(1)   ,STCK(1)   ,STCKN(1)  ,STCK1(1)  ,
     7STCK2(1)  ,COS1(1)   ,DPMX1(1)  ,CPLFL(1)  ,CPTST(1)  ,PLNCS(1)  ,
     8PLND1(1)  ,PLTST(1)  ,PAST(1)   ,SPAST(1)  ,ADCS(1)   ,H(1)      ,
     9CUTR(1) ,AFILLR(500) ,IAFL(1)   ,IPONTR(1) ,IFAR(1)   ,IPL(1)
      COMMON/A2CMMN/IUNFL(1),ISFTYP(1),ITLON(1)  ,ISVFL(1)  ,IFL4(1)   ,
     1IOP(1)    ,IOPSET(1) ,JIOPS(1)  ,NOTAN(1)  ,JENT(1)   ,JU1(1)    ,
     2ISIGCR(1) ,ITSEG(1)  ,JTLFLG(1) ,LOFS(1)   ,LIMFL(1)  ,ICSTR(1)  ,
     3JTN(1)    ,ICHKCT(1) ,J20(1)    ,J21(1)    ,J22(1)    ,J23(1)    ,
     4J24(1)    ,J50(1)    ,J51(1)    ,INDIR(1) ,IFILLR(209),TE(3)     ,
     5TEK(3)    ,TEL(3)    ,TES(3)    ,TA(3)     ,TAK(3)    ,TAL(3)    ,
     6PMOVE(3)  ,TI(3)     ,TIK(3)    ,TIL(3)    ,U2(3)     ,UVEC(3)   ,
     7VTEM(3)   ,CMOVE(3)  ,EX(3)     ,EY(3)     ,EZ(3)     ,VNUL(3)   ,
     8TM(3)     ,DIR(3)    ,AXIS(3)   ,AXIS1(3)  ,AXIS2(3)  ,AXIS3(3)  ,
     9REFPNT(3) ,RGT(3)    ,FWD(3)    ,UP(3)     ,ZLNORM(3) ,ZLPNT(3)
      COMMON/A2CMMN/TNDIR(3), VA(3)   ,TMVCMP(3) ,P1(3)     ,P2(3)     ,
     1PNT(3)    ,PNT1(3)   ,OLDU1(3)  ,OGLE(3)   ,RZERO(3)  ,TANMOT(3) ,
     2TLEND1(3) ,V(3)      ,CEND(3)   ,DELMOT(3) ,D2(3)     ,DNMOT(3)  ,
     3AX4(3)    ,A         ,B         ,C         ,RA        ,HI        ,
     4ALPHA     ,GAMMA     ,CAGL      ,SAGL      ,COM1      ,COM4      ,
     5COSTH     ,CTOCL     ,DIAM      ,DIF       ,DIFOUT    ,DINC      ,
     6DP        ,DPE       ,DPI       ,DPL       ,DPMAX     ,DP1       ,
     7DPCNT     ,DSMOV     ,D1        ,D2A       ,EL1       ,EL2       ,
     8FIPNT     ,FLIPCK    ,HAFDIA    ,HCHORD    ,OFFSET    ,PROD1     ,
     9PROD2     ,PSI       ,RADNO     ,RC1       ,RDRM      ,RDRN
      COMMON/A2CMMN/ RONE  ,RZEROL    ,SAVE1     ,SIUTH     ,TANGL     ,
     1THETA     ,ALP       ,EPS7      ,VAMAX     ,VL        ,ZDOTC     ,
     2ZGAMMA    ,ZIGN      ,ZL        ,ZL1       ,ZL2       ,ZNPTS     ,
     3TOLBND    ,CENDIS    ,CENLEN    ,CHORD     ,ABCD(2)   ,ACARD(2)  ,
     4SAVE(6)   ,CUTDAT(7) ,TEM(10)   ,TEMP(20)  ,TCDAT(260),QEQUIV(20),
     5IS        ,IIS       ,IT        ,IIT       ,IPS       ,IIPS      ,
     6IDS       ,IIDS      ,ICS       ,IICS      ,IGS       ,IIGS      ,
     7ICDEFL    ,ICDEFS    ,IAUTPS    ,IGO       ,ICRDCT    ,ICUT      ,
     8IGTFLG    ,INOPS     ,ISRCH     ,IOFSET    ,ISTRUP    ,I3DFLG    ,
     9MULOUT    ,MULTAX    ,NUMAX     ,NUMSFS    ,NUMSUR    ,IGOUG
      COMMON/A2CMMN/ IPDPL ,NUMDIM    ,IRSTRT    ,ICSCNT    ,I3        ,
     1I31       ,J         ,JA        ,JL        ,JS        ,JT        ,
     2KC        ,KND       ,KR        ,L         ,INCFS     ,NP        ,
     3IBEGIN    ,IFAR1     ,IK        ,INS1      ,ITNFLG    ,IVAMAX    ,
     4IWS       ,IIWS      ,IZ        ,NEXT1     ,NEXT2     ,NPTS      ,
     5NUMPT1    ,JAM       ,JAP       ,JTUSED    ,IFRL      ,N         ,
     6M         ,MDIC      ,JBR       ,JCKR      ,JCPR      ,JCR       ,
     7JDR       ,JGR       ,JMIN      ,JMINR     ,JPR       ,JPXR      ,
     8JTR       ,JCNT1     ,JCNT2     ,JCNT3     ,JSW       ,JTKF      ,
     9LISV      ,LSV       ,IPT       ,JFIND     ,IC        ,ICC
      COMMON/A2CMMN/  IL   ,K         ,NUMPTS    ,IAMDCT    ,IFL2      ,
     1J5        ,J6        ,JW6       ,J10       ,J12       ,J13       ,
     2J40       ,J43       ,J54       ,J103      ,PROBUF(100)          ,
     3CANSTO(2000) , IER   ,INSTR1    ,INSTR2    ,NWDS      ,ICL       ,
     4NREC      ,IRECNO    ,ITRFLG    ,NW        ,IDUMMY
C... A2CMMN END
      COMMON/A2DYDP/ KDYNFQ(12), NKFQ
      COMMON/A2CTDF/        TLHITE(1) ,TANHI(1)  ,TANLO(1)  ,UMAX(1)   ,
     1R1(1)     ,CORRAD(1) ,TCONT(1)  ,TLINC(65)
      DIMENSION  SINL(1), COSL(1), TLLDAT(1)
      EQUIVALENCE(SINL(1),TANHI(1)), (COSL(1),TANLO(1)), (TLLDAT(1),
     1TCONT(1))
      COMMON/A2FPC / Q15X01,QP9X01    ,QP6X01    ,QP5X01    ,QP4X01    ,
     1QP0001    ,QP001     ,QP01      ,QP1       ,Q1P       ,Q10P      ,
     2Q1000P    ,Q1PE5     ,Q1PE6     ,Q1PE10    ,Q1PE20    ,Q1PE30    ,
     3Q1PE36    ,Q1PE38    ,QP8X01    ,QP7X01    ,
     4QP4X09    ,QP9       ,QP99      ,QP995     ,QP997     ,QP999     ,
     5QP9999    ,QP4X95    ,QP5X95    ,QP6X9     ,QP7X9     ,
     6QP6X05    ,QP5X05    ,QP4X05    ,QP0005    ,QP005     ,QP05      ,
     7QP5       ,Q5P       ,                                 Q4X045    ,
     8QP0002    ,QP0047    ,QP017     ,Q1RAD     ,QP0349    ,QP125     ,
     9QP6       ,QP2       ,QP2499    ,QP25      ,QP3
      COMMON/A2FPC / QP7   ,QP75      ,QP8       ,QP866     ,Q1P01     ,
     1Q1P1      ,Q1P2      ,Q1P25     ,Q1P5      ,Q2P       ,Q2P5      ,
     2Q3P       ,Q3P5      ,Q4P       ,Q8P       ,Q11P      ,Q45P      ,
     3Q90P      ,Q130P     ,Q4500P    ,Q9000P    ,QP02      ,QNUL      ,
     4QPIE       ,QFIL(9)
C     *****
C     *****
C     *****
C...
C...
C...
       GOTO (7000,7300,9000,4000,10000,11000,11300,12000,14000),ISTX1
C
C     STARTUP
C     IS THERE A USABLE GO
 7300 IF(IGTFLG.GT.0) GOTO 7301
C     NO USABLE GO
      IGTFLG = 0
      ICSCNT = 0
      GO TO 200
C     YES, USABLE GO EXISTS
 7301 IGTFLG=0
      ISRCH = 1
C     RESET MODE FLAG + PROCEED
      GOTO 7000
C     SPECIAL PROGRAM - DO IT
11300 IGTFLG = 0
      ISRCH = 1
      GOTO 11000
C     4000 - TOOL POSITION
C     TLLFT,TLRGT,TLON,TLNDON,TLONPS,TLOFPS
 4000 GOTO(4001,4001,4003,4003,4005,4006),INSTR2
C
 4001 ISFTYP(IIDS)=1
      CTOCL = -Q1P
      IF(INSTR2.EQ.2) CTOCL = Q1P
      ITLON(IIDS)=1
      GOTO 200
C
 4003 ISFTYP(IIDS) = 3
      ITLON(IIDS) = 0
      CTOCL = QNUL
      GOTO 200
C
 4005 ISFTYP(IIPS) = 3
      ITLON(IIPS) = 0
      GOTO 200
C
 4006 ISFTYP(IIPS) = 1
      ITLON(IIPS) = 1
      GOTO 200
C     STARTUP - SET UP NO. OF SURFACES
 7000 CALL ASTOR(PROBUF(1),8,NUMSUR,2)
C     NO OFFSET. NO MULTICS
       ISTRUP = INSTR2
      IFL2 = 0
C     IF CUTTER NOT DEFINED ERROR
      IF(ICDEFL.EQ.0) CALL AERR(311)
C...
      CALL ARPDIS
C...
C     RESET
      ICSCNT = 0
      INDIR(IIPS) = 0
      INDIR(IIDS) = 0
      INDIR(IICS) = 0
      ISVFL(IIPS) = 0
      ISVFL(IIDS) = 0
      ISVFL(IICS) = 0
      GOTO 200
C
C     9000 - ARELEM PARAMETERS
 9000 GOTO(9010,9020,9030,9040,9050,9060,9070,9080),INSTR2
C
C      TOOL AXIS
 9010 ANS = PROBUF(1)
      K = ANS
      IF((K.LT.1).OR.(K.GT.5)) CALL AERR(2)
      GO TO (9011,9012,9013,9014,9015) ,K
C      TLAXIS/ SFVCT
 9011 CALL AVSTO(TA,TAK)
      CALL AVNORM(PROBUF(4),TA,IER)
      IF(IER.EQ.1) CALL AERR(3)
      MULTAX = 0
      NUMAX = 3
      ICC =0
      GO TO 200
C      NORMPS OR NORMDS
 9012 CALL ASTOR(PROBUF(2),8,K,4)
      IF((K.LT.1).OR.(K.GT.2)) CALL AERR(4)
      ICC = K
      MULTAX = 1
      NUMAX = 5
      GO TO 200
C      ATANGLE,K,ANG1(,SFVCT OR CUTANG,ANG2
 9013 ANS= PROBUF(2)
      K = ANS
      IF((K.LT.1).OR.(K.GT.2)) CALL AERR(5)
      ICC = K
      ALP = PROBUF(3)
      IF(DABS(ALP).GT.Q90P) CALL AERR(16)
      ALP = Q1RAD*ALP
      IF(NWDS.GT.3) GO TO 9113
      MULTAX = 3
      NUMAX = 5
      GAMMA = QNUL
      GO TO 200
 9113 IF(NWDS.GT.4) GO TO 9213
C      5 AXIS, GAMMA(CUTANG) GIVEN
      GAMMA = PROBUF(4)
      IF(DABS(GAMMA).GT.Q90P) CALL AERR(17)
      GAMMA = Q1RAD* GAMMA
      NUMAX = 5
      MULTAX = 3
      GO TO 200
C      VECTOR GIVEN, 4 AXIS
 9213 IF(NWDS.NE.8) CALL AERR(18)
      CALL AVNORM(PROBUF(6),AX4,IER)
      IF(IER.EQ.1) CALL AERR(19)
      MULTAX = 3
      NUMAX = 4
      GO TO 200
C      PARALLEL TO THE RELINGS OF A RULED SURFACE
 9014 ANS = PROBUF(2)
      ICC = ANS
      MULTAX = 2
      NUMAX = 5
      GO TO 200
C      TURN OFF THE MULTI AXIS MODE
 9015 MULTAX = 0
      ICC = 0
      NUMAX = 3
      GO TO 200
C
C     MULTAX
 9020 CALL ASTOR(PROBUF(1),8,K,2)
      IF(K.EQ.1)   GO TO 9021
      MULOUT = 0
      GO TO 2000
 9021 MULOUT = 1
      GOTO 2000
C     MAXDP
 9030 DPMAX=PROBUF(1)
      GOTO 200
C     NUMPTS
 9040 ANS = PROBUF(1)
      NUMPTS = ANS
      GOTO 200
C     THICK
 9050 DO 9051 K=1,NWDS
      I = 1 + (K-1)*LSV
 9051 TH(I) = PROBUF(K)
      GOTO 200
C     NOPS
 9060 INOPS = 1
      GOTO 200
C
C      AUTOPS
 9070 IAUTPS = 1
      INOPS = 0
      GOTO 200
C     GOUGE CHECK
 9080 CALL ASTOR(PROBUF(1),8,IGOUG,2)
      GO TO 200
C
10000   CONTINUE
      CALL AERR(88)
      GO TO 200
C     POCKET
11000  CALL APOCK
      GOTO 200
C
C
C     12000 CODE FOR USER SUPPLIED ROUTINES - DATA IN PROBUF
12000 CONTINUE
C     THE FOLLOWING CODE PROCESSES SPECIAL PROGRAM CALLS.A MAXIMUM OF 10
C     DIFFERENT PROGRAMS ARE PROVIDED IN THIS SCHEME. MORE MAY BE ADDED
C     AT USER OPTION.
C     25 PARAMETERS ARE ALLOWED FOR ANY GIVEN ROUTINE
C     IN ORDER TO HOOK IN SUCH A SPECIAL ROUTINE, THE USER MUST
C        1) REMOVE THE C FROM COLUMN 1 ON THE CODE FOLLOWING
C        2) PROVIDE FOR PROPER OVERLAY OF HIS DECK WITH THE REST OF THE
C            ARITHMETIC ELEMENT
C        3) BE SURE TO INCLUDE NAMED COMMON A2SPEC IN HIS DECK
C        4) STUFF THE ALPH-MERIC NAME OF HIS ROUTINE INTO ARRAY SPNAME
C          (THIS CAN MOST EASILY BE DONE IN A2CTRL)
C           NOTE...THE C IN COLUMN 1 MUST ALSO BE REMOVED FROM THE
C     NAMED COMMON A2NAME IN A2CTRL
C     COMMON/A2NAME/SPNAME(10)
C     COMMON/A2SPEC/VNAME(25),VVALUE(25)
C
C...  INSTR2 =1,2 PARAMETER VALUES ONLY OR PARAMETER NAMES AND VALUES
C
C     NWDS = TOTAL NO OF WORDS READ FROM PROTAPE INTO PROBUF...STARTS
C     WITH NAME OF ROUTINE TO BE CALLED
C     IF(NWDS.EQ.1) GO TO 12500
C     STORE PARAMETERS
C
C
C...  SEE IF JUST PARAMETERS OR NAMES ALSO GIVEN
C     GO TO (12020,12010), INSTR2
C
C     NAMES AND VALUES - STUFF NAME INTO ARRAY VNAME
12010 CONTINUE
C     DO 12015 I = 2,NWDS,2
C     K = I/2
C     CALL ASTOR(PROBUF(I),8,VNAME(K),8)
C     NOW STUFF VALUE
C
C     CALL ASTOR(PROBUF(I+1),8,VVALUE(K),8)
12015 CONTINUE
C     GO TO 12500
C
C...  JUST VALUES
C
12020 CONTINUE
C     DO 12025 I = 2,NWDS,1
C
C     STUFF VALUES
C
C     CALL ASTOR(PROBUF(I), 8,VVALUE(I),8)
C
12025 CONTINUE
C
C...  NOW CALL IN ROUTINE
C
12500 CONTINUE
C     CALL ASTOR(PROBUF(1), 8,AN,8)
C     DO 12510 I = 1,10
C     IF(AN.EQ.SPNAME(I)) GO TO 12550
12510 CONTINUE
C     CALL AERR(20)
12550 CONTINUE
C     GO TO (12610,12620,12630,12640,12650,12660,12670,12680,12690,12700
C    1),I
C
12610 CONTINUE
C     CALL XXXXXX
C     GO TO 200
12620 CONTINUE
C     CALL XXXXXX
C     GO TO 200
12630 CONTINUE
C     CALL
C     GO TO 200
12640 CONTINUE
C     CALL
C     GO TO 200
12650 CONTINUE
C     CALL
C     GO TO 200
12660 CONTINUE
C     CALL
C     GO TO 200
12670 CONTINUE
C     CALL
C     GO TO 200
12680 CONTINUE
C     CALL
C     GO TO 200
12690 CONTINUE
C     CALL
C     GO TO 200
12700 CONTINUE
C     CALL
C     GO TO 200
       GO TO 200
C     FINI
14000 IF(ISRCH.NE.2) GO TO 14001
      I = IVAMAX
      IVAMAX = 4
      CALL AERR(-9)
      IVAMAX = I
      IWAVEN = 2
      GO TO 14002
14001 NCLREC = NCLREC + 1
      CALL ATAPWT(CLTAPE,IER,4,NCLREC,1,INSTR1,1,INSTR2,1,PROBUF,0)
C     REWIND CLTAPE,PROTAPE
14002 CALL ATAPOP(CLTAPE,2,IER)
      CALL ATAPOP(CLTAPE,1,IER)
      CALL ATAPOP(PROTAP,1,IER)
      CALL ATAPOP(SRFTAP,1,IER)
      CALL ATAPOP(POCTAP,1,IER)
C     ZERO OUT IPS AS AN INITIALIZATION FLAG
      IPS = 0
C...
       CALL ACNTRL
C...
      GO TO 2200
  200  ISTX2= K1
      GO TO 2200
 2000  ISTX2 =K2
 2200 RETURN
       END

