       SUBROUTINE MSETUP (M,N)
C  *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 0 ***
C***********************************************************************
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
C...********************************************************************
C***********************************************************************
       GO TO (1250,1270,1280,1300,1400),M
C... NOTE...ALL MATRICES ARE STORED FROM CLTAPE COLUMNWISE
C... THIS SECTION SETS UP THE TRANSL PARAMETERS...
C... CHECK IF THE CORRECT NUMBER OF PARAMETERS ARE PRESENT
 1250  IF(NUMWDS-K6)1251,1252,1292
 1251  IF(NUMWDS-K5)1292,1252,1252
C... CHECK IF (N) IS ZERO OR MINUS
 1252  IF(TAPSTO(K6))1293,1253,1254
 1253  TAPSTO(K6)=1.0
C... SET UP THE TRANSL  MATRIX
 1254  DO 1260 I=K1,K3,K1
 1260  AMATRX(I,K4)=TAPSTO(I+ 2)
       AMATRX(K1,K1)=1.0
       AMATRX(K1,K2)=0.0
       AMATRX(K1,K3)=0.0
       AMATRX(K2,K1)=0.0
       AMATRX(K2,K2)=1.0
       AMATRX(K2,K3)=0.0
       AMATRX(K3,K1)=0.0
       AMATRX(K3,K2)=0.0
       AMATRX(K3,K3)=1.0
             COUNT(1)=TAPSTO(K6)
                  GO TO  1500
C***********************************************************************
C... THIS SECTION SETS UP THE XYROT PARAMETERS...
C... CHECK IF THE CORRECT NUMBER OF PARAMETERS ARE PRESENT
 1270  IF(NUMWDS-K4)1271,1272,1292
 1271  IF(NUMWDS-K3)1292,1272,1272
C... CHECK IF (N) IS ZERO OR MINUS
 1272  IF(TAPSTO(K4))1293,1273,1274
 1273  TAPSTO(K4)=1.0
C... SET UP THE XYROT   MATRIX
 1274  AMATRX(K1,K1)=DCOS (TAPSTO(K3)/57.29577951308232D+0)
       AMATRX(K1,K2)=-DSIN (TAPSTO(K3)/57.29577951308232D+0)
       AMATRX(K1,K3)=0.0
       AMATRX(K1,K4)=0.0
       AMATRX(K2,K1)=DSIN (TAPSTO(K3)/57.29577951308232D+0)
       AMATRX(K2,K2)=DCOS (TAPSTO(K3)/57.29577951308232D+0)
       AMATRX(K2,K3)=0.0
       AMATRX(K2,K4)=0.0
       AMATRX(K3,K1)=0.0
       AMATRX(K3,K2)=0.0
       AMATRX(K3,K3)=1.0
       AMATRX(K3,K4)=0.0
             COUNT(1)=TAPSTO(K4)
                  GO TO 1500
C********************************************************************
C... THIS SECTION SETS UP THE SAME PARAMETERS
C... CHECK IF THE CORRECT NUMBER OF PARAMETERS ARE PRESENT
 1280  IF(NUMWDS-K3)1281,1282,1292
 1281  IF(NUMWDS-K2)1292,1282,1282
C... CHECK IF (N) IS ZERO OR MINUS
 1282  IF(TAPSTO(K3))1293,1283,1284
 1283  TAPSTO(K3)=1.0
C... SET UP THE SAME    MATRIX
 1284  DO 1290 I=K1,K3,K1
       DO 1290 J=K1,K4,K1
 1290  AMATRX(I,J)=0.0
       AMATRX(K1,K1)=1.0
       AMATRX(K2,K2)=1.0
       AMATRX(K3,K3)=1.0
             COUNT(1)=TAPSTO(K3)
                  GO TO 1500
C... PRINT DIAGNOSTIC FOR INCORRECT NUMBER OF PARAMETERS IN A COPY
 1292  WRITE (IOUTAP,1296)SEQNO(K1),CSEQNO(K1)
       GO TO   1040
C... PRINT DIAGNOSTIC   FOR ZERO OR MINUS INDEX VALUE
 1293  WRITE (IOUTAP,1297)SEQNO(K1),CSEQNO(K1)
 1295  GO TO   1040
 1296 FORMAT(65H-***** INCORRECT NUMBER OF PARAMETERS IN THE COPY/...AT
     1CARD NO. A8   ,16H LAST CALL CARD A8   ,8H$$$$$$$$)
 1297 FORMAT(65H-***** THE (N) VALUE IN THE COPY/ IS MINUS...........AT
     1CARD NO. A8   ,16H LAST CALL CARD A8   ,8H$$$$$$$$)
C... THIS SECTION SETS UP THE MODIFY PARAMETERS...
C... SET UP THE MODIFY  MATRIX
 1300  K = 4
       DO 1310 I=K1,K3,K1
       DO 1310 J=K1,K4,K1
       K=K+K1
 1310          AMATRX(I,J) = TAPSTO(K)
       IF(TAPSTO(17)) 1293,1311,1312
 1311  TAPSTO(17) = 1.0
 1312  COUNT(1) = TAPSTO(17)
                   GO TO 1500
C***********************************************************************
C... THIS SECTION SETS UP THE MIRROR PARAMETERS...WHEN THERE IS ONE.....
C... PRINT DIAGNOSTIC   FOR USING A MIRROR      MODIFIER
 1400  WRITE (IOUTAP,1410)
 1410  FORMAT (53H-MIRROR,MIRROR ON THE WALL YOU ARE NOT ALLOWED AT ALL)
       ICLPRT=K1
  190  N=K1
       GO TO 9999
 1040  N=K2
       GO TO 9999
 1500  N=K3
       WORD = COUNT(1)
       J = WORD
       WORD = J
       COUNT(1) = WORD
       IF (COUNT(1).EQ.0.) COUNT(1) = 1.
 9999  RETURN
             END

