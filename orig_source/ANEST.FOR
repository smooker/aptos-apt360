       SUBROUTINE ANEST
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
C....
      IMPLICIT REAL*8(A-H,O-Z)
       REAL*8 INWORD,NAME,KRFSYS
       INTEGER DEBUG,SUM
       INTEGER LCLAS2*2(1200),LMENT4*4(1200)
       LOGICAL*1 LCLAS1(2400), ITYPE1(4)
       INTEGER*4 VST4(14400)
       INTEGER*2 ITYPE/0/,IPUNCT/0/
C
C...     THIS ROUTINE PROCESSES ALL ARITHMETIC ASSIGNMENT
C...     STATEMENTS AND NESTS
C... GENERATING THE CLASS 13 PTPP RECORD AND CALLING AEXPRS TO OUPUT THE
C..CLASS 12 PTPP RECORD.
C  **      ***         ***          ***           ***MB*****   *SJD**
      COMMON/A1COM/NAME,KRFSYS,SUM,JSUBER,NAMSUB,DEBUG,INDXPT,LOOP,IFINI
      COMMON/AMXTAB/MAXTAB,MAXVS1,MAXVS2,MAXPTP,MAXSCL,MAXVS,MAXVST,MXPT
     1PP,MXCAN,MXSRCN,MAXSLR,MAXELM,MAXPOT
      COMMON/AILMTB/ELMENT(600),ICLASS(600),JLMENT
      COMMON/APTPP/PT(300),INPTP,NW,JMODE,KLASS,KLASTP,IRECN,NPT,NPR
      COMMON/APRTAB/ISTARP,IENDP,NMOVE,NL,ITSQ,LINDX
       COMMON/ABREAK/NEXTNW,NRELCN,KANLCN,LOCSEQ,NEXTCN,NWONRD,LPLOCN,
     1 JSW4,ISN,K,MXLOOP,JSW2,JSAV,JSW1,MAXMV,MXNEST,INILL,KF
      COMMON/AVST/VST(2750),PTPP(2225),CANON(2225)
       COMMON/ADATA1/ANODEF,BLANX,BLANKS,SYN,TLAXIS,DUMMY,PLENT,LOOPST
     1 ,LOOPND,MACRO,NTRMAC,NCALL,LAPTH,JAPTH,IPLUS,NCOMMA,IFF,IC(10),
     2 LLASS
      COMMON/ASCALR/SCALR(180),ISCWS,NSURF,LOCTEM,IARGTP
       DIMENSION KPT(600)
       EQUIVALENCE (PT(1),KPT(1))
       EQUIVALENCE (ICLASS(1),LCLAS2(1),LCLAS1(1)),
     1 (ELMENT(1),LMENT4(1))
       EQUIVALENCE (VST(1),VST4(1))
       EQUIVALENCE (ITYPE,ITYPE1(3)),(IPUNCT,ITYPE1(1))
C
       ISCLOC = 0
C
C...     LIMITS OF SCALAR DEFINITION STATEMENT OR NEST
       IST = ISTARP
       IND = IENDP
C
C...     TEST FOR SUBSCRIPT ON SYMBOL BEING DEFINED
  510  NBEGIN = ISTARP + 1
       ICL1 = 4*NBEGIN - 3
      JSW3 = 2
C...     IF = SIGN IMMEDIATELY FOLLOWS SYMBOL, THERE IS NO SUBSCRIPT
       ITYPE1(2) = LCLAS1(ICL1+2)
            IF(IPUNCT.EQ.8) GO TO 550
C...     = SIGN NOT FOUND - IF ENTRY NOT SUBSCRIPT, ERROR
       ITYPE1(4) = LCLAS1(ICL1+3)
            IF(ITYPE.GE.7) GO TO 540
       JSUBER = 6134
       GO TO 998
C
C...     SKIP SUBSCRIPT
  540  NBEGIN = NBEGIN + 1
       ICL1 = ICL1 + 4
       JSW3 = 1
  550  ISTARP = NBEGIN
       ICL2 = 2*NBEGIN - 1
C
C...     TEST FOR NUMBER IMMEDIATELY FOLLOWING = SIGN
       ITYPE1(4) = LCLAS1(ICL1+7)
            IF(ITYPE.NE.3) GO TO 560
C...     YES - IS IT ONLY PARAMETER IN STATEMENT
            IF(NBEGIN+2.LT.IENDP) GO TO 560
C...     YES - PUT NUMBER INTO PT ARRAY, AND GO TO PROCESS SYMBOL
       PT(3) = ELMENT(IENDP-1)
       GO TO 570
C
C...     SET UP PTPP CLASS 12 RECORD HEADER
  560  KPT(1) = 12
C...     TEST FOR ENOUGH ROOM IN TEMP. STORAGE TABLE FOR NEST RESULT
            IF(ISCWS.LE.180) GO TO 565
       JSUBER = 62
       GO TO 2405
C
C...     PUT INDEX TO STORAGE FOR NEST RESULT INTO PTPP AND ELMENT
  565  KPT(3) = ISCWS
       KPT(4) = 0
       ISCLOC = ISCWS
       ISCWS = ISCWS + 1
C
C...     INITIALIZE STORING INDEX FOR COMPUTING EXPRESSION
       INPTP = 3
C...     SET FLAG TO ACCEPT COMPUTING OPERATORS
       ITSQ = 1
C...     PROCESS THE EXPRESSION IN THE STATEMENT OR NEST
       CALL AEXPRS
C
C...     THE ONLY VALUE FOR JSUBER AT THIS POINT IS 62 - TOO MANY
C...     SCALARS IN STORAGE - THE LIMIT IS 30 FOR A SINGLE STATEMENT
            IF(JSUBER.NE.0) GO TO 998
  570  NAME = ELMENT(IST)
      CALL AVS1CK(J)
      GO TO(2360,2280),JSW3
C
C...     UNSUBSCRIPTED VARIABLE
 2280  GO TO (2330,2370,2335,2380,2350,2320,2390,2320,2320),J
C...
C.. NO SUBSC. GIVEN FOR A VAR. THAT HAS APPREARED IN A RESERV STMT.
 2320 JSUBER=105
       GO TO 2405
C
C...  ENTER IN VST, UPDATE SCALAR VARIABLE COUNTER
 2330 CALL AVS1PT(J)
      IF (J.NE.2) GOTO 2335
C...  VST OVERFLOW PREVAILS
      JSUBER = 15
      GO TO 2405
C...
C.. VAR. ENTERED IN VST O.K. UPDATE SCALAR STORAGE TABLE
C...  IS THERE ROOM FOR THE FINAL RESULTS  OF THIS DEF.
 2335  MAXSCL = MAXSCL + 1
       ICL2 = 2*NAMSUB - 1
       VST4(ICL2+2) = 2
       VST4(ICL2+3) = MAXSCL
      IF(MAXSCL.LE.MAXSLR) GO TO 2350
C...
C.. PART PROG. CONTAINS MORE THAN 5,000 SCALAR DEFINITIONS
 2340 JSUBER = 14
      GO TO 2405
C
C...  SET UP DATA FOR PTPP CLASS 13
 2350  INPTP = 5
       J = 5
            IF(ISCLOC.NE.0) GO TO 2355
       INPTP = 6
       J = 7
 2355  KPT(J) = 2
       KPT(J+1) = 0
       KPT(J+2) = 0
       KPT(J+3) = NAMSUB
      GO TO 2430
C
C...  SUBSCRIPTED VARIABLE
 2360 GO TO(2370,2370,2380,2380,2370,2410,2390,2420,2400),J
C
C... SUBSCRIPT GIVEN FOR A VAR. NOT APPEARING IN A RESERV STMT, PRIOR
 2370 JSUBER=108
       GO TO 2405
C
C... VAR. SYMB. IS A PREVIOUSLY DEFINED STATEMENT I.D.
 2380 JSUBER = 251
       GO TO 2405
C
C... VARIABLE IS A M A C R O  NAME
 2390 JSUBER = 211
       GO TO 2405
C
C... SCALAR ARRAY CONTAINS A SURFACE OR VISA VERSA
 2400 JSUBER=106
 2405  SUM = 1
C...
C... OUTPUT NUMERIC SUBSCRIPT IF APPLICABLE
      IF(ITYPE.NE.8) GO TO 998
      PT(7) = ELMENT(IST+1)
      SUM = 9
      GO TO 998
C
C...  DIMENSIONED ONLY - SET AS A SCALAR
 2410  CALL APRFIX(1,IDUM)
       ICL2 = 2*NAMSUB - 1
       MAXSCL = MAXSCL + IABS(VST4(ICL2+3))
      IF(MAXSCL.GT.MAXSLR) GO TO 2340
C...  FINISH PTPP CLASS 13 RECORD AND OUTPUT IT
 2420  ISTARP = IST
       INPTP = 3
            IF(ISCLOC.EQ.0) INPTP = 4
       CALL APTLOD
C...     TEST FOR ERROR IN APTLOD
            IF(JSUBER.NE.0) GO TO 998
C
C
 2430  INPTP = INPTP - 1
       KPT(1) = 13
       KPT(2) = INPTP - 1
       KPT(3) = 0
       KPT(4) = ISCLOC
       JMODE = 5
      CALL APTPUT
C
  998  ISTARP = IST
       IENDP = IND
       RETURN
       END

