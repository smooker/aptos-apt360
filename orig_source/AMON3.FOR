      SUBROUTINE AMON3
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
C
      IMPLICIT REAL*8(A-H,O-Z)
       REAL*8 INWORD,NAME,MACNAM,KRFSYS
       INTEGER DEBUG,SUM
      INTEGER*4 IVST(5500)
      LOGICAL*1 ICLS1(2400)
C          COMMON  STORAGE
C               *          *          *          *          *
      COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
      COMMON/A1COM/NAME,KRFSYS,SUM,JSUBER,NAMSUB,DEBUG,INDXPT,LOOP,IFINI
      COMMON/AMXTAB/MAXTAB,MAXVS1,MAXVS2,MAXPTP,MAXSCL,MAXVS,MAXVST,MXPT
     1PP,MXCAN,MXSRCN,MAXSLR,MAXELM,MAXPOT
      COMMON/AILMTB/ELMENT(600),ICLASS(600),JLMENT
      COMMON/AINPOT/INWORD(14),MORE,IFIRST
      COMMON/ASCALR/SCALR(180),ISCWS,NSURF,LOCTEM,IARGTP
      COMMON/AVST/VST(2750),PTPP(2225),CANON(2225)
      COMMON/ABREAK/NEXTNW,NRELCN,KANLCN,LOCSEQ,NEXTCN,NWONRD,LPLOCN,
     1 JSW4,ISN,K,MXLOOP,JSW2,JSAV,JSW1,MAXMV,MXNEST,INILL,KF
      COMMON/AMACRO/LIMCAN,LMDW,NITEMS,JWHAT,MACREC,MACVST,MACERR
      COMMON/APTPP/PT(300),INPTP,NW,JMODE,KLASS,KLASTP,IRECN,NPT,NPR
      COMMON/AMCSTF/MACNAM(5),MACCUR,MACLCN(5),MACRD,MACSTR(5),NMACVR
     1 ,NUMIDS,IDLOCN,MACIDS(5),ISVID
      COMMON/ADATA1/ANODEF,BLANX,BLANKS,SYN,TLAXIS,DUMMY,PLENT,LOOPST
     1,LOOPND,MACRO,NTRMAC,NCALL,LAPTH,JAPTH,IPLUS,NCOMMA,IFF,IC(10),
     2 LLASS
      EQUIVALENCE (ICLASS(1),ICLS1(1)) , (VST(1),IVST(1))
C
  460       IF(JLMENT.LE.2) GO TO 600
      IF(ICLS1(8) .NE. 4) GO TO 600
  470 IF(ICLS1(7) .NE. 7) GO TO 600
  480  K = 3
      IAT = ICLS1(4)
  490 GO TO(520,500,530,510),IAT
  500 JSUBER=17
      GO TO 998
  510 JSUBER=78
      GO TO 998
  520 NAME=ELMENT(1)
      GO TO 540
  530 A=ELMENT(1)
       CALL AIFUN8(A,NAME)
C
C...     SEE IF THERE ALREADY ARE ENTRIES IN VST FOR THIS SYMBOL
  540  CALL AVS1CK(J)
            IF(NAMSUB.EQ.0) GO TO 570
C...     YES - SEE IF PREVIOUS USAGE WAS AS A STATEMENT LABEL
            IF(J.EQ.3) GO TO 560
            IF(J.EQ.4) GO TO 560
C...     PREVIOUSLY DEFINED SYMBOL BEING USED AS STATEMENT ID
       JSUBER = 3
       SUM = 1
       GO TO 998
C...     YES - SEE IF PREVIOUS USAGE WAS WITHIN THIS LOOP OR MACRO
  560       IF(NAMSUB.LT.IDLOCN) GO TO 570
C...     DOUBLY-DEFINED STATEMENT ID
       JSUBER = 6
       SUM = 1
      GO TO 998
C
C...     ANY PREVIOUS USAGE NOT WITHIN THIS LOOP OR MACRO - PUT
C...     ENTRY FOR THIS ID INTO VST
C...     TEST FOR ROOM FOR IT
  570       IF(MAXVS1+MAXVS2+2.LE.MAXVST) GO TO 575
C...     VST FULL - NO ROOM FOR THIS ENTRY - ERROR
       JSUBER = 15
       SUM = 1
       GO TO 998
C
  575  MAXVS1 = MAXVS1 + 2
       VST(MAXVS1) = NAME
C
      NAMSUB = MAXVS1
C...
  580 ISB = 2*(NAMSUB+1) - 1
      IVST(ISB) = 8
      IVST(ISB+1) = 0
      JSUBER = 0
       NUMIDS = NUMIDS + 1
            IF(NWONRD.LE.0) GO TO 998
  590 JSUBER=201
      SUM = 1
      GO TO 998
  600  K = 1
  998 RETURN
      END

