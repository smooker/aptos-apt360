      SUBROUTINE AGTSUB
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
      IMPLICIT REAL*8(A-H,O-Z)
       INTEGER*2 KNCLUS,KARGPN,KARG(2)
       DIMENSION PTPP(7200),CANON(7200)
       DIMENSION IVST(14400),IPTPP(14400),ICANON(14400)
       COMMON/A1COM/REFSYS,NAME,NAME1,JSUBER,JSV,NAMSUB,KDBUG,INDXPT,
     1 LOOP,IFINI
      COMMON/AVST/VST(7200)
      EQUIVALENCE(VST(1),PTPP(1),CANON(1))
       EQUIVALENCE (VST(1),IVST(1),IPTPP(1),ICANON(1))
      COMMON/ASCALR/SCALR(180),ISCWS,NSURF,LOCTEM,IARGTP
      COMMON/A2CLS7/PPSEQ1,PPSEQ2,ENAME,EINAME,IEREC,ISN
      COMMON/A1PAS2/I,J,K,L,MOVLGE,KANMAX,ICANST,IOVREC,KANPTR,MDFTAB,
     1KANCNT,KAUX,KDFCNT,IDEFP,KPRCNT,MDFPRE,IPREP,KOVFLP,KSRFCT,KOVCNT,
     2LSCAN,IOVFLO,MAXCAN,IREF,ICANSC,NAMSTA,KANGO,LASPTP,ISUB,
     3LCOMP,LGEREC,IRECN,JREC,JNUM,KANCUR,KANCOT,KDFENT,KANPAR,LGELOC,
     4IDTMOV,ISPPRG,INDEXS,KPTP,KPTPCT,KLASTP,KLASCT,KPRNT
       EQUIVALENCE (IARGTP,KNCLUS,KARG(1)),(KARGPN,KARG(2))
C
C**** THIS ROUTINE OBTAINS THE SUBSCRIPT VALUE FOR A VARIABLE. THE PTPP
C     INDEX,THE VARIABLE INDXPT, AND THE VARIABLE NAMSUB ARE THE INPUT.
C     NAMSUB=0,1,2, OR 3.
C     =0, NO SUBSCRIPT.
C     =1, SUBSCRIPT IS FLOATING POINT VARIABLE LOCATED IN PTPP(INDXPT+1)
C     =2, THE FIRST 4 BYTES OF PTPP(INDXPT)   CONTAIN THE VST INDEX OF
C        THE SUBSCRIPT.
C     =3, THE HIGH ORDER 4 BYTES OF PTPP(INDXPT)   CONTAIN THE SCALR
C        TABLE INDEX OF THE SUBSCRIPT.
C     NAMSUB IS SET EQUAL TO THE SUBSCRIPT VALUE AND INDXPT IS UPDATED.
C*******                    ****       ****                      *******
C
C...     SEE WHETHER OR NOT WE HAVE A SUBSCRIPT
      IF ( NAMSUB.EQ.0 ) GOTO 140
C
       KINDXP = 2*INDXPT - 1
C...     GET INDEX TO SUBSCRIPT LOCATION FOR ALL BUT NUMERIC SUBSCRIPT
       K = IPTPP(KINDXP)
C       GET VST INDEX OF SYMBOL BEING SUBSCRIPTED
      IV = IPTPP(KINDXP+1)
       GO TO (20,40,30,60),NAMSUB
C
C  20 SUBSCRIPT RESIDES IN PTPP(INDXPT+1)
  20  INDXPT = INDXPT + 1
      ADUM = PTPP(INDXPT)
       GO TO 50
C
C  30 SUBSCRIPT RESIDES IN SCALR(K)
   30 ADUM = SCALR(K)
       GO TO 50
C
C  40 K CONTAINS THE VST INDEX OF THE SUBSCRIPT
  40  K = K+1
       KTM = 2*K - 1
C     CHECK FOR DEFINED SCALAR VARIABLE
            IF(IVST(KTM).EQ.2) GO TO 45
C
C     SUBSCRIPT NOT DEFINED SCALAR - ERROR
   42  K = K - 1
      ENAME=VST(K)
      NAMSUB=0
      JSUBER=83
       GO TO 140
C
   45  NAMSUB = IVST(KTM+1)
       KTM = 2*NAMSUB - 1
            IF(ICANON(KTM+1).NE.9) GO TO 48
            IF(ICANON(KTM).EQ.0) GO TO 42
   48  ADUM = CANON(NAMSUB)
            IF(KDBUG.EQ.0) GO TO 50
       WRITE (6,500) CANON(NAMSUB)
  500  FORMAT (8H0 AGTSUB,Z20)
   50  NAMSUB = ADUM
C
   52  INDXPT = INDXPT + 1
C       GET MAXIMUM SIZE OF RESERV ARRAY
   55  IVTEM = 2*IV - 1
      IK = IABS(IVST(IVTEM+3))
C       DOES NAMSUB EXCEED THE SIZE
      IF (NAMSUB.GT.IK) GO TO 110
C       IS NAMSUB ZERO OR NEGATIVE
      IF (NAMSUB.LT.1) GO TO 110
       GO TO 150
C
C...     SUBSCRIPT IS AN INCLUSIVE FORMAT
C...     DETERMINE WHETHER OR NOT THIS IS THE FIRST ENCOUNTER
C...     WITH THIS SUBSCRIPT, AND, IF SO, WHETHER OR NOT THIS
C...     TYPE OF SUBSCRIPT IS ACCEPTABLE AT PRESENT
   60       IF(KNCLUS-1)  100, 65, 75
C
C...     INITIAL ENCOUNTER, WHICH IS ACCEPTABLE - COMPUTE
C...     INDEX TO REFERENCE WORD FOR ARGUMENT LIST DATA BLOCK
   65  JTEMP1 = 2*(K+ICANST-1) - 1
C...     MAKE SURE DATA BLOCK IS INCLUSIVE SUBSCRIPT FORMAT
            IF(ICANON(JTEMP1+1).NE.4) GO TO 105
C...     PICK UP INDEX TO SUBSCRIPT DATA BLOCK
       LOCSUB = 2*ICANON(JTEMP1) + 1
C...     SET CONTROL FLAG TO INDICATE INCLUSIVE SUBSCRIPT IN PROCESS
       KNCLUS = 2
C
C...     IF FINAL SUBSCRIPT NOT GIVEN, SET TO SIZE OF ARRAY
            IF(ICANON(LOCSUB+1).NE.0) GO TO 70
C...     PICK UP INDEX TO VST ENTRY FOR SYMBOL
       JTEMP1 = 2*IPTPP(KINDXP+1) - 1
C...     GET SIZE OF ARRAY, AND PUT IT INTO SUBSCRIPT DATA BLOCK
       ICANON(LOCSUB+1) = IABS(IVST(JTEMP1+3))
C...     IF SUBSCRIPT INCREMENT IS NEGATIVE, REVERSE LIMIT
C...     VALUES IN DATA BLOCK
   70       IF(ICANON(LOCSUB+2))  72, 100, 80
   72  JTEMP1 = ICANON(LOCSUB)
       ICANON(LOCSUB) = ICANON(LOCSUB+1)
       ICANON(LOCSUB+1) = JTEMP1
       GO TO 80
C
C...     INCREMENT SUBSCRIPT VALUE (IN STARTING LIMIT LOCATION)
   75  ICANON(LOCSUB) = ICANON(LOCSUB) + ICANON(LOCSUB+2)
C...     PUT SUBSCRIPT VALUE INTO NAMSUB
   80  NAMSUB = ICANON(LOCSUB)
C...     COMPARE NEXT SUBSCRIPT VALUE WITH LIMIT TO DETERMINE
C...     WHETHER OR NOT THIS VALUE IS THE LAST ONE
            IF(ICANON(LOCSUB+2)*(ICANON(LOCSUB)+ICANON(LOCSUB+2)
     1 -ICANON(LOCSUB+1)).GT.0) GO TO 85
C
C...     THIS IS NOT LAST SUBSCRIPT VALUE - SET INDXPT BACK TO
C...     START OF THIS ENTRY
       INDXPT = INDXPT - 1
       GO TO 55
C
C...     LAST SUBSCRIPT - CLEAR CONTROL FLAG
   85  KNCLUS = 0
       GO TO 52
C
C
  100  JSUBER = 103
       GO TO 140
  105  JSUBER = 109
       GO TO 140
  110 JSUBER = 104
       INDXPT = INDXPT + 1
       GO TO 140
C
  140  INDXPT = INDXPT + 1
       KNCLUS = 0
  150  RETURN
C
       END

