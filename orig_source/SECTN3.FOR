       SUBROUTINE  SECTN3
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4,MODIFICATION 4 ***
      IMPLICIT REAL*8 (A-H,O-Z)
C***********************************************************************
       DOUBLE PRECISION   APOSTP,ATAPTB
       REAL*8 PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,TAPES1,TAPES2,
     1 TAPES3,TAPES4,PPNAME
       INTEGER PUNTAP
       COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
       COMMON/ATAPTB/PROTAP,CANTAP,CLTAPE,POCTAP,PLOTAP,SRFTAP,
     1 TAPES1,TAPES2,TAPES3,TAPES4,INTAPE,IOUTAP,PUNTAP
       COMMON/ASISTM/IPTNLY,ITRCUT,IWAVEN,KFLAG1,LTVMIT,NCLREC,NOPOST,
     1 NOPLOT,NUMPST,NUMPTR,ICLPRT,INDEXX,IPLOTR,KFLAGS(9)
       COMMON/APOSTP/PPNAME(20)
      COMMON/A3FXD1/AMATI1(4,4),AMATI2(4,4),AMATI3(4,4),AMATRX(3,4),
     1AMTR(36),AN1,AN2,ANAME,AX,AX0,AXVEC(3),AY,AY0,CNTM(36),CNTMAT(3,4)
     2,CONT(3),COUNT(3),CSEQNO(1),DELX,DELY,DX,DY,F0,ORIGIN(3),PARRAY
     3(20),PARTNO(12),PNT(3),PPRINT(12),PPT(6),PT0(3),PTT(6),PTU(3),
     4SEQNO(1),SUB(5),SUB4(6),TAPSTO(250),TITL(8),TL,TMATRX(3,4),
     5TNTM(36),TOOLNG,TRAMAT(3,4),VEC(3),WORD,X0,X1,X2,X3,XNEW,
     6Y0,Y1,Y2,Y3,YNEW
      DIMENSION IRR(1),ARR(1),IDAC(2)
      EQUIVALENCE (IARROW,IRR(1)),(TAPSTO(1),IDAC(1))
       EQUIVALENCE(AMATI1(1,1),ARR(1))
      REAL*8 MOTION
      COMMON/A3FXD2/MOTION(8)
      COMMON/A3FXI1/IARROW,I1,I2,ICLWAS,ICOPY,IDPLOT,IDPLSQ,IFIRST,
     1IGODLT,INDN,INSTR1,INSTR2,IND2TB(160),INDOFF,INDTAB(160),
     2INDXNO(3),IPERSP,IPL5AX,IPLOTI,IPLOTX,IPLWAS,IPX,IPY,IRECNI(3),
     3IRECNO,IRECTP,IRET,IRETVR,ISUBSC,ISWMAC,ISWNOC,IT,
     4ITHPNT,ITRAFL,ITRUNC,JARROW,JCLPRT,JCOPY,JPTSW,
     5JSW,JTYPSW,JVECTR,KCLPRT,KCOPY,MAXCOP,MULTAX,
     6NCAMRA,NK,NNTAB,NRECNO,NTAB,NUMWDS,NURCNO,NX,NX0,
     7NX1,NX2,NX4,NX5,NXP,NY,NY0,NY1,NY2,NY4,NY5,NYP,
     8IFALMS,IWARMS,INTSEQ
       REAL*8 NUCLTP
      EQUIVALENCE   (NUCLTP,TAPES2)
       EQUIVALENCE(ITRCUT,LCLPRT)
C...********************************************************************
      DATA Q000HL/6HPARTNO/
      DATA Q001HL/6H NOT G/
      DATA Q002HL/6HIVEN  /
      DATA Q003HL/6H      /

C...  PRINT WHAT SECTION THIS IS
    1  WRITE (IOUTAP,2)
    2  FORMAT(19H1.....SECTION 3....)
       DO 2003 I=1,580
 2003 ARR(I) = 0.D0
      DO 2004  I=1,392
 2004  IRR(I) = 0
             IF(ITRCUT) 2006,2006,2005
 2005        INDEXX=K1
 2006  F0=0.0D+0
       LCLPRT=K0
       IWARMS=K0
       IFALMS=K0
C...   ZERO INDEX ARRAYS
       DO 7 I=K1,160
       IND2TB(I)=K0
    7  INDTAB(I)=K0
C...  TEST FOR CLPRNT FLAG
       IF(ICLPRT)11,12,6
   11  ICLPRT=K1
       JCLPRT=K0
       GO TO 12
    6  JCLPRT=K1
       KCLPRT=K1
       LCLPRT=K2
   12  IPLTR=IPLOTR
             PARTNO(1)  = (+Q000HL)
             PARTNO(2)  = (+Q001HL)
             PARTNO(3)  = (+Q002HL)
       DO 10  I = 4,12
   10         PARTNO(I) =  (+Q003HL)
C...  HAS THERE BEEN A SECTION II ERROR
       IF(IWAVEN)3,4,3
C...  SAVE INDEXX IN INDOFF AND TURN INDEXX OFF
    3  INDOFF=INDEXX
       INDEXX=K0
       WRITE (IOUTAP,2009)
 2009  FORMAT (' ***** NO TRANSFORMATION OR COPY HAS BEEN PERFORMED DUE
     XTO ERRORS --- CHECK PRINTOUT FOR ERROR COMMENTS.')
C...  IS THERE A TRACUT OR COPY IN EFFECT - IF SO DELAY PLOTTING
    4  IF(INDEXX)8,8,5
C...  SET FLAGS
    5  IPLWAS=IPLOTR
       IPLOTR=K0
    8            ICOPY = K0
                 IRECNO = K0
                 NURCNO = K0
       COUNT(K1)=F0
                 NTAB = K1
      NNTAB=K1
                 MAXCOP = K3
                 IPLOTI = K0
                 IDPLOT = K0
                 ICLWAS = K0
                 ITRAFL = K0
                 MULTAX = K0
      NCAMRA=K0
                 IFIRST = K0
                 IGODLT = K0
                 IARROW = K0
                 IPL5AX = K0
                 JVECTR = K0
                 TOOLNG = 5.0D0
             IPERSP= K0
      JJJJ=K0
C... REWIND CLTAPE
       CALL TAPEOP (CLTAPE,K1,IRET)
C... CONNECT A BUFFER   FOR READING THE CLTAPE
       CALL BUFFTP (CLTAPE,K2)
C... WILL THERE BE A TRACUT OR COPY - IF SO CREATE A NEW CLTAPE
             IF (INDEXX)            20,40,20
C... REWIND NUCLTP- A   TRACUT OR COPY IS TO BE DONE
   20  CALL TAPEOP (NUCLTP,K1,IRET)
C... CONNECT A BUFFER   FOR WRITING THE NUCLTP
       CALL BUFFTP (NUCLTP,K1)

C********************************************************************
C... READ A RECORD FROM THE CLTAPE
   40  CALL TAPERD(CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,
     1 INSTR2,K1,TAPSTO,K0)
       CALL ASTORE (TAPSTO(K1),K8,I1,K4)
       CALL ASTORE (TAPSTO(K2),K8,I2,K4)

C********************************************************************
C... WAS THE RETURN FROMTAPERD ALL RIGHT
       IF(IRETVR) 120,70,50
   50  WRITE (IOUTAP,60)
   60  FORMAT(//' ***** READ ERROR IN SECTN3 ON CLFILE')
C...  TURN OFF FLAG FOR POSTPROCESSING
       KFLAGS(5)=0
C... PREPARE FOR END OF FILE EXIT FROM SECTN3
C... REWIND CLTAPE
   70  CALL TAPEOP (CLTAPE,K1,IRET)
C... HAS THERE BEEN A TRACUT OR COPY - IF SO PUTEOF ON NEW CLTAPE
   90       IF (INDEXX)             92,110,92
C... WRITE END-OF.FILE  ON NUCLTP
   92  CALL TAPEOP (NUCLTP,K2,IRET)
C... REWIND NUCLTP
       CALL TAPEOP (NUCLTP,K1,IRET)
C... MAKE NUCLTP INTO   CLTAPE
                   CALL TAPECH (CLTAPE,NUCLTP)



C***********************************************************************
C... THIS IS THE LOGICAL END OF THE CLTAPE PROCESSOR. RETURN TO SYSTEM
C... CONTROL
C... SHOULD PLOTTING BE DONE AFTER A TRACUT OR  COPY
  110        IF (IPLWAS)            112,112,113
C... NO - END UP
  112  WRITE (IOUTAP,111)
C... HAS THERE BEEN PLOTTING - IF SO THEN CLEAR PLOT SYSTEM BUFFERS
       IF(IPLOTR-K1)117,114,117
C... CLEAR PLOT BUFFERS AND GET A NEW FRAME
  114  CALL FRAMEV
  111  FORMAT  (14H-END OF SECTN3)
C... HAS THERE BEEN AN ARELEM ERROR - IF SO THEN PRINT STATEMENT
  117  IF (IWAVEN) 93,93,2010
 2010  WRITE (IOUTAP,2009)
      IF (IFALMS) 93,93,115
C... YES-PRINT WARNING  TO PART PROGRAMMER
C... HAS THERE BEEN AN ARELEM- WARNING ERROR- IF SO PRINT STATEMENT
 93          IF(IWARMS) 115,118,115
  115  WRITE (IOUTAP,116)IFALMS,IWARMS
  116 FORMAT (//' ***** CHECK CLTAPE PRINTOUT FOR PROGRAM ERROR COMMENTS
     1*****NO OF SECTION 2 FAILURES ARE ',I5,' WARNINGS ARE ',I5)
C... SET INDEXX TO ITS  PREVIOUS STATE
                  INDEXX = INDOFF
C... RETURN TO APT SYSTEM CONTROL
 118  IPLOTR=IPLTR
       IF (IWAVEN-K2) 119,109,119
 109   IWAVEN=K0
 119   CALL ACNTRL
C... INDEXX IS ON AND   PLOTTING IS WANTED SO
C... INITIALIZE TO TURN OFF TRACUT,COPY AND CL  PRINTING
  113            IPLOTR = IPLWAS
       IPLWAS=K0
      ICLPRT=0
       INDEXX=K0
       ITRAFL=K0
C... REWIND THE NUCLTP  AND PROCESS IT FOR      PLOTTING
       GO TO   8
C***********************************************************************
  120 IF (INSTR1.NE.1000) GO TO 121
      INTSEQ = INSTR2
      SEQNO(1) = TAPSTO(2)
      GO TO 125
C...  IS THIS CLPRNT/- IF SO SET PRINT FLAGS
  121 IF (INSTR1.EQ.13000) GO TO 678
C... IS THIS MULTAX - IF SO SET THE MULTAX FLAG
      IF (INSTR1.EQ.9000) GO TO 310
C... WILL THERE BE A TRACUT OR COPY
  125  IF(INDEXX-K1)130,131,130
C... WILL THERE BE A PLOT - IF SO THEN ENTER SECTN3
C...                        IF NOT A TRACUT,COPY,OR PLOT THE MAYBE CLPRT
  130  IF(IPLOTR-K1)191,131,191
  131  IF(ICLPRT-K1)140,132,140
  132  IF(JCLPRT-K1)140,133,140
 133   IF(KCLPRT)140,134,140
 134   CALL CLPRNT
       NRECNO=IRECNO
C... COMPUTE IRECTP FOR MAJOR RECORD TYPE
  140  IRECTP=INSTR1/1000
C********************************************************************
C... BRANCH ACCORDING TO RECORD TYPE
      GO TO (150,600,210,150,400,1800,150,150,310,150,150,150,150,150),
     1IRECTP

C... THIS IS THE COMMON RETURN POINT FOR ALL SECTIONS OF THE CLTAPE
C... PROCESSOR AND THE POINT AT WHICH THE NEW RECORDS ARE WRITTEN ON
C... THE NUCLTP AND PRINTED IF ICLPRT = 1.
C... IS TRACUT OR COPY  IN EFFECT
  150  IF(INDEXX-K1)190,160,190
C... INCREMENT THE RECORD NUMBER
  160  NURCNO=NURCNO+K1
C... WRITE A RECORD ON THE NEW CLTAPE
       CALL TAPEWT (NUCLTP,IRETVR,       K4,NURCNO,K1,INSTR1,K1,
     1 INSTR2,K1,TAPSTO,NUMWDS)
C... WAS THE RETURN FROMTAPEWT ALL RIGHT
               IF (IRETVR)  190,170,50
C... END OF TAPE BRANCH - WRITE COMMENT
  170  WRITE (IOUTAP,180)
  180  FORMAT(49H END OF NUCLTP SENSED BEFORE THIS RECORD WRITTEN.)
               GO TO 70

C... YES - CHECK FOR    CLPRNT
 190   IF(KCLPRT)191,202,191
  191  IF(ICLPRT-K1)202,192,202
  192  IF(JCLPRT-K1)202,200,202
C... PRINT THE PRESENT RECORD IF ICLPRT IS ON
  200     CALL CLPRNT
                  NRECNO = IRECNO
C... GO READ ANOTHER RECORD FROM CLTAPE
C... IS THIS RECORD FINI - IF SO CHECK FOR A PLOT IN EFFECT BY GOING TO
C... THE INDEX/N AREA.
C... IS THIS A FINI
  202  IF(INSTR1-14000)40,205,40
C... MAKE INTO AN ALL
C...  STORE AN INDEX/-1 IN INDEX TABLES
  205  TAPSTO(K1)=-1.0D+0
         GO TO          900
C... END OF MAIN SECTION OF CLPROS CONTROL......
C***********************************************************************

C... SETUP INFORMATION FOR CIRCLE SURFACE TYPE MACHINE INTERPOLATION..

C... IS THIS RECORD A CIRCLE - IF NOT READ ANOTHER RECORD
  210  IF(I2-K4)300,230,212
C.. . IS THIS RECORD A CYLINDER, IF SO TREAT AS CIRCLE
  212  IF(I2-K5)300,230,300
C... IS THERE A COPY OR TRACUT IN EFFECT - IF SO TRANSFORM THE CENTER
C... POINT AND VECTOR OF THE CIRCLE
C... IS COPY IN EFFECT
  230        IF (ICOPY)240,240,250
C... IS TRACUT IN EFFECT
  240  IF(ITRAFL-K1)300,250,300
C... YES-TRANSFORM THE  CENTER
  250  CALL TSFMPT (TMATRX,TAPSTO(K6),TAPSTO(K6))
C... TRANSFORM THE VECTOR
       CALL TSFMVC (TMATRX,TAPSTO(K9),TAPSTO(K9))
C... GET SCALE FACTOR IF ANY AND TRANSFORM THE RADIUS
      PS=(TMATRX(1,1)*TMATRX(2,2)*TMATRX(3,3))+
     1(TMATRX(1,2)*TMATRX(2,3)*TMATRX(3,1))+
     2(TMATRX(1,3)*TMATRX(2,1)*TMATRX(3,2))-
     3(TMATRX(1,3)*TMATRX(2,2)*TMATRX(3,1))-
     4(TMATRX(1,1)*TMATRX(2,3)*TMATRX(3,2))-
     5(TMATRX(1,2)*TMATRX(2,1)*TMATRX(3,3))
       DUMMY=(DABS(PS))**(1.D0/3.D0)
       IF(DUMMY.LE.1.00001D0) GO TO 300
       TAPSTO(12)=TAPSTO(12)*(DUMMY)
  300  GO TO 150
C***********************************************************************

C...  IF MULTIPLE AXIS IS USED THIS SECTION WILL SET MLTFLG = 1.
C... IS THIS A MULTAX
  310  IF(INSTR2-K2)321,318,321
 318   IF(I1) 319,319,320
 319   MULTAX=K0
       GO TO 321
C... YES - SET FLAG
  320            MULTAX = K1
  321  IF(ICLPRT-K1)330,322,330
  322  IF(JCLPRT-K1)330,323,330
 323   IF(KCLPRT)330,324,330
 324   CALL CLPRNT
       NRECNO=IRECNO
  330             GO TO  150
C***********************************************************************
  400  CALL TYPE5 (KKK)
C... PRINT THIS RECORD
       GO TO (150,1550),KKK


C... THIS IS THE END OF THE POINTS RECORD BRANCH....
C***********************************************************************

C... THIS SECTION SENSES THE TRACUT,INDEX,COPY, AND PLOT...
C... SUBTYP 1038 IS TRACUT ,1039 IS INDEX,1040 IS COPY,1041 IS PLOT,
C... 1042 IS OVPLOT AND 1047 IS CAMERA
  600  JSW=INSTR2-1037
C...  IS THIS A VTLAXS/ COMMAND
       IF(INSTR2-1070)601,627,601
C... IS JSW POSITIVE
  601        IF (JSW)               150,150,602
C... YES-IS JSW LESS    THAN ELEVEN
 602  IF(JSW-K10)605,605,150
C... GO TO (TRACUT,INDEX,COPY,PLOT,OVPLOT,LETTER,PPRINT,PARTNO,CAMERA )
  605   GO TO (700,900,950,610,610,620,630,650,150,660),JSW
C... IS SECTN 0 PLOT FLAG ON - IF NOT GO READ A RECORD.
  610  IF(IPLOTR-K1)150,1600,150
C... IS THIS THE INNER PLOT OF A NEST - IF SO GO READ A RECORD.
  620        IF (IDPLOT-K2)                       625  , 150  , 625
C... LETTER - SET UP PARAMETERS FOR THE FOLLOWING PPRINT.
 625   WORD=TAPSTO(4)
       N=WORD
       XV=TAPSTO(K1)
       NX=NXV(XV)
       YV=TAPSTO(K2)
       NY=NYV(YV)
      JJJJ=K1
           GO TO        150
C...  PROCESS THE VTLAXS
  627 IF (IPTNLY.GE.0) GO TO 628
      IF ((IRECNO+IPTNLY).LE.0) GO TO 150
      IPTNLY = -IPTNLY
  628 IF(IPLOTR.NE.0) GO TO 150
      CALL VTLAXS
       GO TO   202
C... IS THIS THE INNER PLOT OF A NEST - IF SO GO READ A RECORD.
  630        IF (IDPLOT-K2)                        632 , 150  , 632
C... PPRINT - SAVE THE BCD TEXT.
  632  DO 635 I=K1,NUMWDS,K1
  635  PPRINT(I)=TAPSTO(I)
C... IS A PLOT IN EFFECT - IF NOT GO READ A RECORD.
       IF(IPLOTR-K1)150,640,150
C... HAS THERE BEEN A LETTER - IF SO THEN PLOT THE BCD TEXT.
 640  IF(JJJJ)                                    645,150,645
  645    CALL   PRINTV  (N,PPRINT,NX,NY)
      JJJJ=K0
          GO TO         150
C... SAVE THE PARTNO BCD TEXT - TO BE PLOTTED IN THE SETUPP SUBROUTINE
  650  DO 655 I=K1,NUMWDS,K1
  655  PARTNO(I)=TAPSTO(I)
          GO TO         150
C...   IS THE MODIFIER BOTH
C... CAMERA - IS THE MODIFIER BOTH(83). - IF SO SET NCAMRA TO BOTH CAMRA
  660  IF(I1-83)665,670,665
C... NO  - SET FOR ONE  CAMERA
 665   WORD=TAPSTO(1)
       NCAMRA=WORD
             GO TO       150
C... YES - SET FOR BOTH CAMERAS
  670     NCAMRA = K3
       GO TO 150
C***********************************************************************
  678 KHOLD=KFLAGS(7)
      KFLAGS(7)=1
      IF((IDAC(2).EQ.1).AND.(INSTR2.EQ.5)) GOTO 40
      KFLAGS(7)=0
       IF((TAPSTO(1).EQ.0.D0).AND.(INSTR2.EQ.5)) GO TO 40
      KFLAGS(7)=KHOLD
      CALL PRTSET (KKK)
       GO TO (40,125),KKK
C***********************************************************************
  700 IF (IPTNLY.GE.0) GO TO 710
      IF ((IRECNO+IPTNLY).LE.0) GO TO 150
      IPTNLY = -IPTNLY
  710 CALL TRACUT(KKK)
      GO TO 150
C***********************************************************************

C... THIS SECTION PROCESSES THE INDEX INSTRUCTION...
C... IT ALSO SETS PLOT FLAGS AND TESTS TO SEE IF THE PRESENT INDEX IS
C...   FOR A PLOT
C...    NOTE... INDEX STORED IN TABLE AS FIXED PT AND TESTED FIXED
C...    NOTE... INDEX RECORD NO STORED IN TABLE AS FIXED
C...  IS THE INDEX TABLE FULL
C...  INDEX/N,NOMORE,  COMPLETES COPY,  NOMORE = 53
 900   WORD=TAPSTO(1)
       IT=WORD
       IF(I2-53)9000,9200,9000
 9200 IF(IPLOTR)                                  9202,9202,150
 9202 IF(NNTAB-160)                               9210,947,947
C     SEE IF INDEX/N,M IS IN IND2TB
 9210  DO 9220 I=K1,NNTAB,K2
       IF(IT-IND2TB(I))9220,9250,9220
 9220 CONTINUE
       IND2TB(NNTAB)=IT
       IND2TB(NNTAB+ 1)=IRECNO
      NNTAB=NNTAB+K2
      GO TO 9011
C     IS THIS INDEX/I,NOMORE LEGITIMATE.  IF YES, GO TO 9251
 9250 IF (IRECNO-IND2TB(I+1)) 9016,9251,9016
C     IS THE INDEX/I,NOMORE FOR THE COPY IN EFFECT.  IF YES, GO TO 9230
 9251 IF (IT-INDXNO(1)) 150,9230,150
C     IF NOT THE SAME, MUST BE NORMAL COPY
 9230  CALL ASERCH (CLTAPE,IRECNI(K1),IRET)
      GO TO 150
C     NOTE....INDEX STORED IN TABLE AS FIXED PT, AND TESTED FIXED
C     NOTE....INDEX RECORD NUMBER STORED IN TABLE AS FIXED
 9000 IF(NTAB-160)                  901,947,947
C... NO - SEARCH THE    TABLE FOR SAME VALUE
  901  DO 9010 I=K1,NTAB,K2
C... COMPARE INDEX NO.  WITH TABLE
       IF(IT-INDTAB(I))9010,9014,9010
 9010  CONTINUE
       GO TO 9017
C...   CHECK FOR DUPLICATE INDEX NUMBERS ON FIRST PASS ONLY
 9014  IF(IPLOTR-1)9015,9011,9011
 9015  IF(IRECNO-INDTAB(I+1))9016,9011,9016
 9016 IF (IPTNLY.GE.0) GO TO 9019
      IF ((IRECNO+IPTNLY).LE.0) GO TO 150
      IPTNLY = -IPTNLY
 9019 WRITE (IOUTAP,9018)
 9018  FORMAT (36H DUPLICATE INDEX NUMBERS NOT ALLOWED    /)
       GO TO 945
C... NOT FOUND SO SAVE
 9017  INDTAB(NTAB)=IT
       INDTAB(NTAB+ 1)=IRECNO
                    NTAB = NTAB +K2
C... IS PLOT REQUESTED
 9011        IF (IPLOTR)            946,946,902
C... IS A PLOT NOW IN   EFFECT
  902  IF(IDPLOT-K1)910,920,905
C... DOES THIS INDEX NO.AGREE WITH PREVIOUS PLOTCOMMAND NO.
  905  IF(IPLOTX-IT)910,935,910
C... DOES THIS REC. NO. AGREE WITH LAST ONE     PRINTED
  910  IF(NRECNO-IRECNO)915,915,940
C... IS CLPRNT WANTED
  915        IF (ICLPRT)            917,916,917
C... TURN PRINTING ON
  916            ICLPRT = ICLWAS
  917  ICLWAS=K0
         GO TO          946
C... DOES THIS REC. NO. AGREE WITH LAST ONE     PRINTED
  920  IF(NRECNO-IRECNO)925,925,930
C... IS CLPRNT WANTED
  925        IF (ICLPRT)            927,926,927
C... TURN PRINTING ON
  926            ICLPRT = ICLWAS
  927  ICLWAS=K0
          GO TO         942
C... HAS PRINT BEEN OFF
  930        IF (ICLWAS)            933,932,933
  932            ICLWAS = ICLPRT
  933  ICLPRT=K0
          GO TO         942
C... HAS PRINT BEEN OFF
  935        IF (ICLWAS)            938,936,938
C... RESTORE PRINTING   MODE
  936            ICLWAS = ICLPRT
C... TURN PRINTING OFF
  938  ICLPRT=K0
C... TURN PLOT FRAME OFF
       IDPLOT=K0
C... GO FIND NESTED PLOTCOMMAND
       CALL ASERCH (CLTAPE,IDPLSQ,IRET)
C...  IS THIS A FINI
       IF(INSTR1-14000)150,40,150
C...  IS ICLWAS ZERO
  940        IF (ICLWAS)            943,941,943
C...  SAVE ICLPRT AND   TURN IT OFF
  941            ICLWAS = ICLPRT
  943  ICLPRT=K0
         GO TO          946
C...  IS THIS INDEX/    FOR A PLOT/
  942  IF(IPLOTX-IT)946,944,946
C...  TURN OFF PLOT     FLAGS
  944  IDPLOT=K0
       IPLOTI=K0
C... IS THIS A FINI
  946  IF(INSTR1-14000)150,70,150
C... INDEX TABLE FILLED TURN OFF PLOT AND COPY  TURN ON CLPRNT
  947  WRITE (IOUTAP,948)
  948  FORMAT(85H- THE INDEX TABLE HAS OVERFLOWED. TOO MANY INDEX/N INST
     1RUCTIONS IN THIS PART PROGRAM.)
  945           IWAVEN = K1
                IPLWAS = K0
                IPLOTR = K0
                ICLPRT = K1
                ICLWAS = K0
                INDEXX = K0
C... IS THIS A FINI
      IF(INSTR1-14000) 9208,9209,9208
C... ADJUST INDEX TABLE AND PROCEED WITH FINI
 9209 NNTAB=NNTAB-K2
       GOTO 9210
 9208 IF (JCLPRT) 951,951,949
 949   IF(KCLPRT)150,150,952
  951  JCLPRT=K1
  952  KCLPRT=K0
       GO TO 200
C***********************************************************************
C... THIS SECTION PROCESSES THE COPY INSTRUCTION.THE PROGRAM IS SETUP
C... TO PERFORM THREE LEVELS OF NESTED COPIES. THE ONLY LIMITATION ON
C... THIS IS MAXCOP AND THE AMOUNT OF STORAGE PROVIDED FOR AMATRX,CNTMAT
C... COUNT,INDXNO AND IRECNI.
C... FOR EACH ADDITIONAL NEST AMATRX AND CNTMAT EACH MUST BE INCREASED
C... BY 12. COUNT,INDXNO, AND IRECNI EACH MUST BE INCREASED BY 1...
C... ALSO MAXCOP MUST BE INCREASED BY 1..
C... AMATRX IS THE MATRIX DEFINED BY EACH COPY AS IT IS SENSED AND IS
C... SET UP BY XYROT,SAME OR MODIFY INSTRUCTIONS.
C... CNTMAT IS THE CURRENT RESULTANT COPY MATRIX.
C...
C... TRAMAT IS THE MATRIX CREATED BY A TRACUT INSTRUCTION.
C... COUNT IS THE NUMBER OF TIMES A COPY IS TO LOOP.
C... TMATRX IS THE COMBINATION OF ALL MATRICES PRESENTLY IN EFFECT.
C... INDXNO IS THE NUMBER OF THE COPY JUST SETUP(ITPSTO(4)).
C... IRECNI IS THE RECORD NUMBER OF THE CURRENT  COPY.
C... IRECNO IS THE RECORD NUMBER OF THE INSTRUCTION JUST READ.

  950 IF (IPTNLY.GE.0) GO TO 953
      IF ((IRECNO+IPTNLY).LE.0) GO TO 150
      IPTNLY = -IPTNLY
C... IS A COPY OR TRACUTWANTED
  953 IF (INDEXX-1) 150,955,150
C... IS A COPY IN EFFECT
955   IF (I2.EQ.29.AND.TAPSTO(6).EQ.0.0D0) GO TO 956
      IF (I2.EQ.34.AND.TAPSTO(4).EQ.0.0D0) GO TO 956
      IF (I2.EQ.54.AND.TAPSTO(3).EQ.0.0D0) GO TO 956
      IF (I2.EQ.55.AND.TAPSTO(17).EQ.0.0D0) GO TO 956
      IF (ICOPY)  1550,1030,960
956   WRITE (IOUTAP,957)
957   FORMAT(' ****FOLLOWING COPY NOT PERFORMED  N EQUALS ZERO****')
      GO TO 150
C... HAS THE MAXIMUM    NUMBER OF COPIES BEEN   EXCEEDED
  960        IF (MAXCOP - ICOPY)    980,970,970
C... IS THIS THE CORRECT COPY
  970  IF(IRECNO-IRECNI(K1))1000,1100,1000
C... TOO MANY NESTED    COPIES
  980  WRITE (IOUTAP,990)
       GO TO 945
  990  FORMAT(46H TOO MANY NESTED COPIES                       )
C... NO....THEN PUSH DOWN
C... THIS SECTION IS THE PUSH DOWN FOR AMATRX,CNTMAT,COUNT AND INDXNO...
C... AND IRECNI
C... MORE THAN ONE COPY PUSHDOWN MATRICES
 1000  JCOPY=ICOPY*K12
       DO 1010 I=K1,JCOPY,K1
       KCOPY=JCOPY-I+K1
       AMTR(KCOPY+ 12)=AMTR(KCOPY)
       TNTM(KCOPY+ 12)=TNTM(KCOPY)
 1010  CNTM(KCOPY+ 12)=CNTM(KCOPY)
C... MORE THAN ONE COPY PUSHDOWN FLAGS
       DO 1020 I=K1,ICOPY,K1
       KCOPY=ICOPY-I+K1
       COUNT(KCOPY+ 1)=COUNT(KCOPY)
       CONT(KCOPY+ 1)=CONT(KCOPY)
       INDXNO(KCOPY+ 1)=INDXNO(KCOPY)
 1020  IRECNI(KCOPY+ 1)=IRECNI(KCOPY)
 1030  ICOPY=ICOPY+K1
C... FIND TRANSL, XYROT, SAME, MODIFY, OR MIRROR IN THAT ORDER
C... IS THIS A TRANSL
       IF(I2-29)1040,1250,1035
C... IS THIS A XYROT
 1035  IF(I2-34)1060,1270,1060
C... INCORRECT MODIFIER IN A COPY
 1040  WRITE (IOUTAP,1050)
C... TURN OFF COPY,PLOT,TRACUT-TURN ON CLPRNT
 1041  GO TO 945
 1050  FORMAT(41H-INCORRECT MODIFIER IN A COPY INSTRUCTION)
C... IS THIS A SAME
 1060  IF(I2-54)1070,1280,1070
C... IS THIS A MODIFY
 1070  IF(I2-55)1080,1300,1080
C... IS THIS A MIRROR
 1080  IF(I2-56)1090,1400,1090
 1090             GO TO 1040
C***********************************************************************
C... PROPER COPY HAS BEEN FOUND
 1100  COUNT(1) =COUNT(1)-1.0D0
       CONT(1)=CONT(1)+1.0D0
C... HAS THE PRESENT COPY LOOP BEEN COMPLETED.
 1110  IF(COUNT(K1))1115,1112,1150
C...  IS THERE MORE THANONE COPY
 1112  IF(ICOPY-K1)1550,1113,1120
C... IS A TRACUT IN     EFFECT
 1113  IF(ITRAFL-K1)1145,1114,1145
C... MOVE THE TRACUT    MATRIX
 1114          CALL MATMOV (TRAMAT,TMATRX)
          GO TO         1145
C... NO. OF TIMES THRU  THIS COPY WOULD EXCEED  (N).
 1115  WRITE (IOUTAP,1116)
 1116  FORMAT (104H-THE NO. OF TIMES THRU THIS COPY WOULD EXCEED (N),CHE
     1CK PART PROGRAM FOR ILLEGAL TRANSFER INTO COPY LOOP)
 1117  WORD=COUNT(1)
       IT=WORD
       WRITE (IOUTAP,1118)IT,INDXNO(K1),SEQNO(K1),CSEQNO(K1)
 1118  FORMAT (9H COUNT =  I5,9HINDXNO = I5, 9HCARD NO. A8 ,
     119HLAST CALL CARD NO. A8)
C... TURN OFF COPY,PLOT,TRACUT - TURN ON CLPRNT
       IWAVEN=K1
       INDEXX=K0
       IPLOTR=K0
       ICLPRT=K1
                  GO TO  70
C... YES.---THEN PUSH UP AMATRX,CNTMAT,COUNT,INDXNO, AND IRECNI.
 1120  JCOPY=ICOPY*K12
       DO 1130 I=K1,JCOPY,K1
       AMTR(I)=AMTR(I+ 12)
       TNTM(I)=TNTM(I+ 12)
 1130  CNTM(I)=CNTM(I+ 12)
      CALL MATMOV (AMTR(1),AMATRX)
      CALL MATMOV (CNTM(1),CNTMAT)
      CALL MATMOV (TNTM(1),TMATRX)
      IF (ICOPY.EQ.2) GO TO 1134
      CALL MULTM (CNTM(1),CNTM(13),TMATRX)
      GO TO 1136
 1134 CALL MATMOV (CNTM(1),TMATRX)
 1136 IF (ITRAFL.NE.1) GO TO 1138
      CALL MULTM (TMATRX,TRAMAT,TMATRX)
 1138 DO 1140 I=1,ICOPY,1
       COUNT(I)=COUNT(I+ 1)
       CONT(I)=CONT(I+ 1)
       INDXNO(I)=INDXNO(I+ 1)
 1140  IRECNI(I)=IRECNI(I+ 1)
 1145  ICOPY=ICOPY-K1
C... IS CLPRNT WANTED
       IF(ICLPRT)1146,150,1146
 1146  IF(JCLPRT)1147,150,1147
C... YES-PRINT WHAT COPYTHIS IS
 1147  WORD = TAPSTO(1)
       IT = WORD
       WRITE (IOUTAP,1247) IT
                  GO TO 150
C... NO....THEN UPDATE TMATRX
C... IS THIS A SAME
 1150  IF(I2-54)1160,1170,1160
C... NO-UPDATE MATRICES
 1160             CALL  MULTM (AMATRX,TMATRX,TMATRX)
 1170             CALL  MULTM (AMATRX,CNTMAT,CNTMAT)
 1175 CALL MATMOV (AMATRX,AMTR(1))
      CALL MATMOV (CNTMAT,CNTM(1))
      CALL MATMOV (TMATRX,TNTM(1))
C... SEARCH FOR THE     MATCHING INDEX NO.
      DO 1180 I=1,NTAB,2
       IF(INDXNO(K1)-INDTAB(I))1180,1200,1180
 1180  CONTINUE
C... ERROR EXIT
       WRITE (IOUTAP,1190)INDXNO(K1)
 1190  FORMAT (7H INDEX/  I6,13H NOT DEFINED.  )
C... TURN OFF PLOT,COPY,TRACUT-TURN ON CLPRNT
       GO TO 945
C... THIS IS THE PROPER INDEX----GO FIND IT ON THE CLTAPE...
 1200     CALL ASERCH   (CLTAPE,INDTAB(I+1),IRET)
      INDN=INDXNO(K1)
C...  IS CLPRNT WANTED
       IF(ICLPRT-K1)1245,1211,1245
 1211  IF(JCLPRT-K1)1245,1212,1245
 1212  IF(KCLPRT-K1)1220,1215,1220
 1215     CALL CLPRNT
       NRECNO=IRECNO
C...  IS THIS THE START OF A COPY
 1220        IF (CONT(1))           1230,1240,1230
C...PRINT-THIS COMPLETESPASS NO.--- THRU THIS   COPY
 1230 WORD=CONT(1)
       IT=WORD
       WRITE (IOUTAP,1249)IT,INDN
          GO TO         1245
C...PRINT-THIS STARTS   PASS NO. 1  THRU THIS   COPY
 1240  WRITE (IOUTAP,1248)INDN
C...  READ THE NEXT     CLTAPE RECORD
 1245  CALL TAPERD (CLTAPE,IRETVR,NUMWDS,K4,IRECNO,K1,INSTR1,K1,
     1 INSTR2,K1,TAPSTO,K0)
       CALL ASTORE (TAPSTO(K1),K8,I1,K4)
       CALL ASTORE (TAPSTO(K2),K8,I2,K4)
 1247  FORMAT (1H0,15X,26H***** THIS COMPLETES COPY/  I4,5H*****  )
 1248  FORMAT(1H0,15X,62H***** THIS STARTS PASS NO.   1. THRU THIS COPY,
     1 BACK TO INDEX/  I4,5H*****  )
 1249  FORMAT (1H0,15X,30H***** THIS COMPLETES PASS NO.  I4,31H THRU THI
     1S COPY,BACK TO INDEX/   I4,5H*****  )
C***********************************************************************
       GO TO 321
C***********************************************************************
 1250  CALL MSETUP (K1,I)
       GO TO 1499
 1270  CALL MSETUP (K2,I)
       GO TO 1499
 1280  CALL MSETUP (K3,I)
       GO TO 1499
 1300 CALL MSETUP (K4,I)
       GO TO 1499
 1400  CALL MSETUP (K5,I)
 1499  GO TO (190,1040,1500),I
C... THE TRANSL,XYROT,SAME,MODIFY,OR MIRROR TYPE COPY HAS BEEN SET UP...
 1500  IRECNI(K1)=IRECNO
       WORD=TAPSTO(1)
       INDXNO(1)=WORD
       CONT(1)=0.0D0
                   CALL MATMOV(AMATRX,CNTMAT)
                   CALL MATMOV (CNTMAT,TMATRX)
C... IS THERE MORE THAN ONE COPY IN EFFECT
       IF(ICOPY-K1)1530,1530,1510
C... UPDATE THE TMATRX IF THERE IS MORE THAN ONE COPY IN EFFECT
 1510  DO 1520 I=K2,ICOPY,K1
       CALL MULTM (TMATRX,CNTM( 12*I- 11),TMATRX)
 1520  CONTINUE
C... IS A TRACUT IN     EFFECT
 1530  IF(ITRAFL-K1)1175,1540,1175
C... UPDATE TMATRX IF THERE IS A TRACUT IN EFFECT
 1540             CALL  MULTM (TMATRX,TRAMAT,TMATRX)
            GO TO   1175
C... PRINT DIAGNOSTIC   FOR ERROR IN COPY LOGIC
 1550  WRITE (IOUTAP,1590)
       WORD=COUNT(1)
       IT=WORD
       WRITE (IOUTAP,1591)IT,INDXNO(K1), SEQNO(K1)
       WRITE (IOUTAP,1592)((CNTMAT(I,J),J=K1,K4),I=K1,K3)
       WRITE (IOUTAP,1593)((TMATRX(I,J),J=K1,K4),I=K1,K3)
            GO TO       70
 1590  FORMAT (33H-***** ERROR IN COPY LOGIC ******)
 1591  FORMAT (9H COUNT =    I4, 9HINDXNO = I5,9H SEQNO = 2A4)
 1592  FORMAT (5H1CNTM/(1H012X,4D16.7))
 1593  FORMAT (7H1TMATRX/(1H012X,4D16.7))
 1600  CALL PLTSET
       GO TO 150
C... THIS SECTION WILL SAVE THE CUTTER LENGTH TO BE USED IF THERE IS
C... 5 AXIS PLOTTING. IF THE LENGTH IS ZERO IN THE CUTTER COMMAND THEN
C... SET IT TO 5.
C... IS THIS A CUTTER   COMMAND
 1800 IF (INSTR2.NE.6) GO TO 150
      IF (NUMWDS.EQ.7) GO TO 1850
      IF (NUMWDS.EQ.1) GO TO 1840
      IF (TAPSTO(2).LE.5.0D0) GO TO 1840
      TOOLNG = TAPSTO(2)
      GO TO 150
C... SET TO 5 INCH      LENGTH
 1840          TOOLNG = 5.0D0
       GO TO   150
C... CUTTER LENGTH HAS BEEN SPECIFIED - SAVE IT.
 1850  TOOLNG=TAPSTO(K7)
       GO TO   150
       END

