      SUBROUTINE APREPD(JBR)
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 2, MODIFICATION 1 ***
C
C
      IMPLICIT REAL*8(A-H,O-Z)
      COMMON/AVST/VST(7200)
      DIMENSION DEFTAB(1000)
      EQUIVALENCE(VST(7200),DEFTAB(1000))
      DIMENSION D(1000)
      EQUIVALENCE (DEFTAB(1),D(1))
C               *          *          *          *          *
      DIMENSION SMAT(12)
      COMMON/APRBRK/SMAT,XXXX1,XXXX2,XXXX3,XXXX4,ANS1,ANS2,ANS3,
     1 KTR,KWORD,JMOD2,JMOD1,INKX,KMOVE,L1,L2,KFRNT,KADD,KADD1
C***********************************************************************
C     DEFINE FUNCTIONS
      CRV(Q000FL)=50.0*(Q000FL-CENTER)/CURVRG+51.50001
      CRVA(Q001FL,Q002FL,Q003FL)=-(4.0*Q001FL+2.0*Q002FL)/(Q003FL*DSQRT(
     1(1.0+Q001FL**2)**3))
      SMAL(Q004FL)=DSIGN( DMAX1(DABS(Q004FL),1.D-9),Q004FL)
      TAN1(Q005FL,Q006FL)=(Q005FL-Q006FL)/(1.0+Q005FL*Q006FL)
      TAN2(Q007FL,Q008FL)=(Q007FL+Q008FL)/SMAL(1.0-Q007FL*Q008FL)
      DERV(Q009FL)=DSQRT((1.0+Q009FL*Q009FL)*(1.0+Q009FL*Q009FL)*(1.0+Q0
     109FL*Q009FL))
      CURV(Q010FL,Q011FL,Q012FL,Q013FL,Q014FL,Q015FL)=-(4.0*Q012FL+2.0*Q
     1013FL)/(Q015FL*                 DERV(Q012FL))-(2.0*Q010FL+4.0*Q011
     2FL)/(Q014FL*DERV(Q011FL))
      SLOPE(Q016FL,Q017FL,Q018FL,Q019FL,Q020FL,Q021FL)=(((Q018FL-Q016FL)
     1**2+(Q019FL-Q017FL)**2)                *(Q021FL-Q017FL)-((Q020FL-Q
     2016FL)**2+(Q021FL-Q017FL)**2)*(Q019FL-Q017FL))/SMAL(((Q018FL-Q016F
     3L)**2+      (Q019FL-Q017FL)**2)*(Q020FL-Q016FL)-((Q020FL-Q016FL)**
     42+(Q021FL-Q017FL)**2)*(Q018FL-Q016FL))
      ATAN(Q050FL) = DATAN(Q050FL)
C
C...  DEFINE TANF SO THAT ITS MAXIMUM MAGNITUDE IS 10**9
C
      TAN(Q022FL)=DSIN(Q022FL)/(DSIGN( DMAX1(DABS(DCOS(Q022FL)),1.D-9)
     1 ,DCOS(Q022FL)))
      SOMEPI=3.1415926535897932
      HALFPI=SOMEPI*.5
      GO TO (1075,1087,3000),JBR
C
C
C
C...  TRANSFORM IF NECESSARY AND CONVERT TO
C...  NEW SYSTEM IF NECESSARY .
C
 1075 GOTO(1076,1076,1079,1083,1076,1076),JMOD1
C
C...  RTHETA , NOZ , XYZ , THETAR ROUTINE
C
 1076 IF(KTR)1077,2000,1077
 1077 INKX=1
      XXXX1=D(KADD1)
      XXXX2=D(KADD1+1)
      XXXX3=0.0
      XXXX4=1.0
 3000 ANS1=XXXX1*SMAT(1)+XXXX2*SMAT(2)+XXXX3*SMAT(3)
     1+XXXX4*SMAT(4)
      ANS2=XXXX1*SMAT(5)+XXXX2*SMAT(6)+XXXX3*SMAT(7)
     1+XXXX4*SMAT(8)
      ANS3=XXXX1*SMAT(9)+XXXX2*SMAT(10)+XXXX3*SMAT(11)
     1+XXXX4*SMAT(12)
      GOTO(3001,3002,3003,3004,4001,4002),INKX
 3001 D(KADD1)=ANS1
      D(KADD1+1)=ANS2
      IF(IDEFTB(KADD1+2)+1)1078,2000,1078
 1078 D(KADD1+2)=(SMAT(5)+SMAT(6)*D(KADD1+2))/SMAL(SMAT(1)+SMAT(2)*D(KAD
     1D1+2))
      GOTO2000
C
C...  NOY ROUTINE
C
 1079 IF(KTR)1080,1082,1080
 1080 INKX=2
      XXXX1=D(KADD1+1)
      XXXX2=0.0
      XXXX3=D(KADD1)
      XXXX4=1.0
      GOTO3000
 3002  D(KADD1+1) = ANS1
       D(KADD1) = ANS3
      IF(IDEFTB(KADD1+2)+1)1081,1082,1081
 1081 D(KADD1+2)=(SMAT(3)+SMAT(1)*D(KADD1+2))/SMAL(SMAT(11)+SMAT(9)*D(K
     1ADD1+2))
 1082 SAV1=D(KADD1+1)
      SAV2=D(KADD1)
      D(KADD1)=D(2)*SAV1+D(4)*SAV2
      D(KADD1+1)=D(5)*SAV1+D(7)*SAV2
      IF(IDEFTB(KADD1+2)+1)3078,2000,3078
 3078 AGEOLD = ATAN(D(KADD1+2))+HALFPI
      D(KADD1+2) = TAN(AGEOLD)
      GOTO2000
C
C...  NOX ROUTINE
C
 1083 IF(KTR)1084,1086,1084
 1084 INKX=3
      XXXX1=0.0
      XXXX2=D(KADD1)
      XXXX3=D(KADD1+1)
      XXXX4=1.0
      GOTO3000
 3003 D(KADD1)=ANS2
      D(KADD1+1)=ANS3
      IF(IDEFTB(KADD1+2)+1)1085,1086,1085
 1085 D(KADD1+2)=(SMAT(10)+SMAT(11)*D(KADD1+2))/SMAL(SMAT(6)+SMAT(7)*D(K
     1ADD1+2))
 1086 SAV1=D(KADD1)
      SAV2=D(KADD1+1)
      D(KADD1)=D(3)*SAV1+D(4)*SAV2
      D(KADD1+1)=D(6)*SAV1+D(7)*SAV2
      GOTO2000
C
C...  XYZ ROUTINE
C
 1087 IF(IDEFTB(KADD)-3001)1088,1089,1088
 1088 D(KADD1)=D(KADD)
      D(KADD1+1)=D(KADD+1)
      D(KADD1+2)=D(KADD+2)
      KFRNT=KFRNT-3
      GOTO1097
 1089 D(KADD1)=D(KADD+1)
      D(KADD1+1)=D(KADD+2)
      D(KADD1+2)=D(KADD+3)
      KFRNT=KFRNT-4
C
C...  TRANSFORM POINT AND SLOPE. CONVERT TO
C...  U-V COORDINATE SYSTEM.
C
 1097 IF(KTR)1098,1099,1098
 1098 INKX=4
      XXXX1=D(KADD1)
      XXXX2=D(KADD1+1)
      XXXX3=D(KADD1+2)
      XXXX4=1.0
      GOTO3000
 3004 D(KADD1)=ANS1
      D(KADD1+1)=ANS2
      D(KADD1+2)=ANS3
 1099 SAV1=D(KADD1)
      SAV2=D(KADD1+1)
      SAV3=D(KADD1+2)
      D(KADD1)=D(2)*SAV1+D(3)*SAV2+D(4)*SAV3
      D(KADD1+1)=D(5)*SAV1+D(6)*SAV2+D(7)*SAV3
      D(KADD1+2)=AFULL8(0,-1)
 2000 JBR = 1
      GO TO 2500
 4001 JBR = 2
      GO TO 2500
 4002 JBR = 3
 2500 RETURN
      END

