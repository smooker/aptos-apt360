      SUBROUTINE AMON10
C     *** THIS PROGRAM LAST MODIFIED FOR VERSION 4, MODIFICATION 3 ***
C
      IMPLICIT REAL*8(A-H,O-Z)
       REAL*8 INWORD,NAME,IDIS,MACNAM,KRFSYS
       INTEGER*2 ITYPE,IPUNCT
       LOGICAL*1 LCLAS1(2400), ITYPE1(4)
       INTEGER DEBUG,SUM
       INTEGER ISLASH/Z00000304/,ICOMMA/Z00000904/
C     THIS PROGRAM PROCESSES VOCABULARY CLASSES ONE THRU TEN
C          COMMON  STORAGE
C               *          *          *          *          *
      COMMON/A0CON/K0,K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,IBLANK
      COMMON/A1COM/NAME,KRFSYS,SUM,JSUBER,NAMSUB,DEBUG,INDXPT,LOOP,IFINI
      COMMON/AMXTAB/MAXTAB,MAXVS1,MAXVS2,MAXPTP,MAXSCL,MAXVS,MAXVST,MXPT
     1PP,MXCAN,MXSRCN,MAXSLR,MAXELM,MAXPOT
      COMMON/AILMTB/ELMENT(600),ICLASS(600),JLMENT
      COMMON/AINPOT/INWORD(14),MORE,IFIRST
      COMMON/ASCALR/SCALR(180),ISCWS,NSURF,LOCTEM,IARGTP
      COMMON/APARTB/ILPCNT,IRPCNT,ILVCNT
      COMMON/APRTAB/ISTARP,IENDP,NMOVE,NL,ITSQ,LINDX
      COMMON/AVST/VST(2750),PTPP(2225),CANON(2225)
      COMMON/ABREAK/NEXTNW,NRELCN,KANLCN,LOCSEQ,NEXTCN,NWONRD,LPLOCN,
     1 JSW4,ISN,K,MXLOOP,JSW2,JSAV,JSW1,MAXMV,MXNEST,INILL,KF
      COMMON/AMACRO/LIMCAN,LMDW,NITEMS,JWHAT,MACREC,MACVST,MACERR
      COMMON/APTPP/PT(300),INPTP,NW,JMODE,KLASS,KLASTP,IRECN,NPT,NPR
      COMMON/AMCSTF/MACNAM(5),MACCUR,MACLCN(5),MACRD,MACSTR(5),NMACVR
     1 ,NUMIDS,IDLOCN,MACIDS(5),ISVID
      COMMON/ADATA1/ANODEF,BLANX,BLANKS,SYN,TLAXIS,DUMMY,PLENT,LOOPST
     1 ,LOOPND,MACRO,NTRMAC,NCALL,LAPTH,JAPTH,IPLUS,NCOMMA,IFF,IC(10),
     2 LLASS
      COMMON/AKLAS7/PPSEQ1,PPSEQ2,IDIS,IISN,IDVST,KFK
       DIMENSION IPT(600)
       DIMENSION LMENT4(1200)
       EQUIVALENCE (PT(1),IPT(1))
       EQUIVALENCE (ITYPE,ITYPE1(3)),(IPUNCT,ITYPE1(1))
       EQUIVALENCE (ICLASS(1),LCLAS1(1))
       EQUIVALENCE (ELMENT(1),LMENT4(1))
C
       ICL1 = 4*(K+1) - 3
       IPUNCT = 0
C
C...     BRANCH ON CLASS OF VOCABULARY WORD WHICH BEGINS STATEMENT
       GO TO (2470,2550,2550,2565,2595,2605,2610,2755,2760,3150),KLASS
C
C...     VOCAB. CLASS 1 - FIXED FIELD STATEMENT
 2470 CALL ATBLKP(INWORD(1),N,1)
      ELMENT(1) = INWORD(1)
            IF(N.NE.0) GO TO 2520
C
C...  MUST BE IN COLS. 1-6
      JSUBER=21
      GOTO 998
C
C...     BRANCH ON VOCABULARY SUBTYPE TO APPROPRIATE PROCESSING
 2520 GO TO(2530,60,2540,2540,2540),KLASTP
C
C...  PROCESS TITLES
 2530  KFK = 1
      CALL ACLAS7
      CALL AINOUT
      GO TO 60
C
C...  PROCESS PARTNO, INSERT, PPRINT
 2540  KFK = 2
      CALL ACLAS7
      CALL APARAM
      GO TO 60
C
C...     ARELEM PARAMETERS (VOCAB. CLASSES 2 AND 3)
 2550  CALL AFLAGS
      GO TO 60
C
C...     INPUT/OUTPUT COMMANDS (VOCAB. CLASS 4)
 2565 GO TO(2570,2580,2580),KLASTP
C
C...  PROCESS READ
 2570 CALL AREAD
C... PTPP CLASS 2 RECORDS WHERE PROCESSED BY ERROR LOOP IN SUBRTN AREAD
      RETURN
C
C...  PROCESS PUNCH, PRINT
 2580  CALL AINOUT
      GO TO 60
C
C...     PROCESS OBTAIN (VOCAB. CLASS 5)
 2595  CALL AOBTAN
      GO TO 60
C
C...     PROCESS ZSURF (VOCAB. CLASS 6)
C...     TEST FOR DATA IN STATEMENT FOLLOWING SLASH
 2605       IF(K+2.GT.JLMENT) GO TO 3410
C...     YES - MAKE SURE SLASH FOLLOWED VOCABULARY WORD
       ITYPE1(2) = LCLAS1(ICL1+2)
            IF(IPUNCT.NE.3) GO TO 3400
       CALL AHELPR(INILL)
C...     TEST FOR ERROR IN AHELPR
            IF(JSUBER.NE.0) GO TO 998
C...     INITIALIZE INDEXES, AND MOVE DATA IN STATEMENT TO PTPP
       ISTARP = K + 2
       INPTP = 2
       CALL APTLOD
C...     TEST FOR ERROR IN APTLOD
            IF(JSUBER.NE.0) GO TO 998
C...     IF NOT END OF STATEMENT, ERROR
            IF(ISTARP.LE.JLMENT) GO TO 3410
C...  OUTPUT CLASS 16 PTPP RECORD FOR ZSURF
       INPTP = INPTP - 1
       IPT(1) = 16
       IPT(2) = INPTP - 1
       JMODE = 5
      CALL APTPUT
       GO TO 60
C
C...     SPECIAL PROGRAM CALL (VOCAB. CLASS 7)
 2610       IF(ICLASS(INILL+2).EQ.1) GO TO 2630
 2620 JSUBER= 12345
      GO TO 998
 2630  ISTARP = INILL + 5
      CALL ACCALL
      GO TO 60
C
C...     PROCESS REFSYS (VOCAB. CLASS 8)
C...     TEST FOR DATA IN STATEMENT FOLLOWING SLASH
 2755       IF(K+2.GT.JLMENT) GO TO 3410
C...     INITIALIZE INDICES, AND MOVE DATA IN STATEMENT TO PTPP
       ISTARP = K + 2
       INPTP = 2
       CALL APTLOD
C...     TEST FOR ERROR IN APTLOD
            IF(JSUBER.NE.0) GO TO 998
C...     IF NOT END OF STATEMENT, ERROR
            IF(ISTARP.LE.JLMENT) GO TO 3410
C...     TEST STATEMENT ENTRY FOR VARIABLE SYMBOL OR VOCABULARY
       ITYPE1(2) = LCLAS1(ICL1+7)
            IF(IPUNCT-2)  2758, 2757, 2756
 2757       IF(IPT(6).EQ.53) GO TO 2761
C...  SHOULD HAVE BEEN VOCABULARY WORD NOMORE
 2756 JSUBER = 651
      GOTO 998
C...  PREPARE PTPP CLASS 4 RECORD
 2761  IPT(1) = 4
       IPT(2) = 1
       PT(2) = 0.0
       INPTP = 2
       GO TO 2759
 2758  INPTP = INPTP - 1
       IPT(1) = 4
       IPT(2) = INPTP - 1
 2759  JMODE = 5
      CALL APTPUT
       GO TO 60
C
C...     'IF' STATEMENT (VOCAB. CLASS 9)
 2760       IF(LOOP.NE.0) GO TO 2780
C...  IF STATEMENT ALLOWED ONLY IN A LOOP OR MACRO
 2770 JSUBER=407
      GO TO 998
 2780  N = INILL + 1
       NEXT = 4
       JTEMP1 = 4*N - 3
       ITYPE1(2) = LCLAS1(JTEMP1+3)
C...  CHECK CONTENTS OF IF EXPRESSION AND SETUP PTPP WORDS I,J,K,L
       GO TO (2820,2790,2800,2790,2810),IPUNCT
C
 2790 JSUBER=402
      GO TO 998
C
C...  FLOATING POINT NUMBER
 2800  J = 0
       K = 0
      EM=ELMENT(N)
      GO TO 2920
C
C...  EXPRESSSION
 2810  I = 3
       J = 0
       K = 0
       JTEMP1 = 2*N - 1
       L = LMENT4(JTEMP1+1)
      GO TO 2910
C
C...  VARIABLE SYMBOL
 2820 NAME=ELMENT(N)
      CALL AVS1CK(J)
            IF(J.EQ.5) GO TO 2840
            IF(J.NE.8) GO TO 2790
C
C...  CHECK FOR SUBSCRIPT
 2840  I = 2
      L=NAMSUB
            IF(ICLASS(N+1).EQ.8) GO TO 2880
       JTEMP1 = 2*N - 1
       K = LMENT4(JTEMP1+3)
            IF(ICLASS(N+1).EQ.9) GO TO 2890
            IF(ICLASS(N+1).NE.7) GO TO 2900
C...     SUBSCRIPT IS A VARIABLE SYMBOL
       J = 2
       GO TO 2925
C
C...  SUBSCRIPT IS A NUMBER
 2880  J = 1
       K = 0
      EM=ELMENT(N+1 )
      GO TO 2920
C
C...  SUBSCRIPT IS AN EXPRESSION
 2890  J = 3
       GO TO 2925
C
C...  NO SUBSCRIPT
 2900  J = 0
       K = 0
 2910  N = N + 1
      GO TO 2930
C
 2920  NEXT = 5
 2925  N = N + 2
C...  PTPP WORDS FOR CONTENTS OF IF EXPRESSION
      PT(4)= EM
 2930  IPT(3) = I
       IPT(4) = J
       IPT(5) = K
       IPT(6) = L
       NID = 0
 2940       IF(ICLASS(N).EQ.3) GO TO 2960
 2950 NAME=ELMENT(N)
      GO TO 2970
C
C...  NUMERIC STATEMENT ID
 2960 A=ELMENT(N)
      CALL AIFUN8(A,NAME)
C
C...  IS ID ALREADY IN VST
 2970 CALL AVS1CK(J)
      IF(JSUBER .NE. 0)  RETURN
C...     IF ID NOT WITHIN PRESENT LOOP OR MACRO, ERROR
            IF(NAMSUB.LT.IDLOCN) GO TO 3242
            IF(J.NE.1) GO TO 3010
C
C...  ERROR
 2980 JSUBER = 403
      SUM = 1
      GO TO 998
C
C...  UPDATE PTPP REFERENCES TO THIS ID
 3010 JF = NAMSUB
 3020  NID = NID + 1
      GO TO(3030,3040,3050),NID
C
C...  FIRST ID
 3030 KB1 = JF
      GO TO 3060
C...  SECOND ID
 3040 KB2 = JF
      GO TO 3060
C...  THIRD ID
 3050 KB3 = JF
 3060  N = N + 1
      IF(N.GE.JLMENT)GO TO 3120
C...     TEST FOR COMMA PRECEDING NEXT ID
            IF(ICLASS(N).EQ.ICOMMA) GO TO 3100
C...  FORMAT ERROR
 3080 JSUBER=78
      GO TO 998
C
 3100  N = N + 1
            IF(NID-3)  2940, 3300, 3300
C
 3120       IF(NID.NE.3) GO TO 3300
C
C...  OUTPUT PTPP CLASS 11 RECORD
 3140  IPT(1) = 11
       IPT(2) = NEXT + 1
       JTEMP1 = 2*NEXT - 1
       IPT(JTEMP1) = 0
       IPT(JTEMP1+1) = KB1
       IPT(JTEMP1+2) = 0
       IPT(JTEMP1+3) = KB2
       IPT(JTEMP1+4) = 0
       IPT(JTEMP1+5) = KB3
       JMODE = 5
       INPTP = NEXT + 2
      CALL APTPUT
      GO TO 60
C
C...     PROCESS 'JUMPTO' (VOCAB. CLASS 10)
 3150       IF(LOOP.NE.0) GO TO 3170
 3160 JSUBER=407
      GO TO 998
 3170  N = INILL + 1
            IF(ICLASS(N).NE.ISLASH) GO TO 3400
C
 3200  N = N + 1
            IF(ICLASS(N).EQ.1) GO TO 3220
            IF(ICLASS(N).EQ.3) GO TO 3230
 3210 JSUBER=403
      GO TO 998
C
C...  VARIABLE SYMBOL ID
 3220 NAME=ELMENT(N)
      GO TO 3240
C
C...  NUMERIC ID
 3230 A=ELMENT(N)
      CALL AIFUN8(A,NAME)
C
C...  IS ID ALREADY IN VST
 3240 CALL AVS1CK(J)
      IF(JSUBER.NE.0)  RETURN
C...     IF ID NOT WITHIN PRESENT LOOP OR MACRO, ERROR
            IF(NAMSUB.GE.IDLOCN) GO TO 3245
 3242  JSUBER = 406
       SUM = 1
       GO TO 998
C
 3245  GO TO (2980,3250,3290,3290),J
 3250  JSUBER = 3
      SUM = 1
      GO TO 998
C
 3290 IF(N.EQ.JLMENT)GO TO 3310
 3300 JSUBER= 409
      SUM = 1
      GO TO 998
C
C...     OUTPUT CLASS 10 PTPP RECORD
 3310  IPT(1) = 10
       IPT(2) = 1
       IPT(3) = 0
       IPT(4) = NAMSUB
       INPTP = 2
       JMODE = 5
      CALL APTPUT
      GO TO 998
C
C...     FORMAT ERROR - NO SLASH FOUND
 3400  JSUBER = 155
       GO TO 998
C
C...     INCORRECT AMOUNT OF DATA IN STATEMENT
 3410  JSUBER = 129
C
   60  CONTINUE
C
  998  RETURN
       END

